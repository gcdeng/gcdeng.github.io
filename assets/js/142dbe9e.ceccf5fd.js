"use strict";(self.webpackChunkgcdeng_github_io=self.webpackChunkgcdeng_github_io||[]).push([[8206],{3905:function(e,t,n){n.d(t,{Zo:function(){return i},kt:function(){return k}});var a=n(7294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function u(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var l=a.createContext({}),s=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},i=function(e){var t=s(e.components);return a.createElement(l.Provider,{value:t},e.children)},p={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,l=e.parentName,i=u(e,["components","mdxType","originalType","parentName"]),d=s(n),k=r,f=d["".concat(l,".").concat(k)]||d[k]||p[k]||o;return n?a.createElement(f,c(c({ref:t},i),{},{components:n})):a.createElement(f,c({ref:t},i))}));function k(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,c=new Array(o);c[0]=d;var u={};for(var l in t)hasOwnProperty.call(t,l)&&(u[l]=t[l]);u.originalType=e,u.mdxType="string"==typeof e?e:r,c[1]=u;for(var s=2;s<o;s++)c[s]=n[s];return a.createElement.apply(null,c)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},2740:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return u},contentTitle:function(){return l},metadata:function(){return s},toc:function(){return i},default:function(){return d}});var a=n(3117),r=n(102),o=(n(7294),n(3905)),c=["components"],u={slug:"react-hooks",title:"React Hooks \u7e3d\u6574\u7406\u7b46\u8a18",description:"\u5b78\u7fd2 React Hooks \u6642\u6574\u7406\u7684\u4e00\u4e9b\u7b46\u8a18\uff0c\u5167\u5bb9\u6db5\u84cb\u6240\u6709\u5e38\u7528\u7684Hook\u4f7f\u7528\u6559\u5b78\u53ca\u958b\u767c\u4e0a\u53ef\u4ee5\u6ce8\u610f\u53ef\u80fd\u8e29\u96f7\u7684\u5730\u65b9\u3002\u66f4\u65b0\u5230React 18\u65b0\u589e\u7684Hooks\u3002",image:"/img/2022-05-02-react-hooks/lautaro-andreani-xkBaqlcqeb4-unsplash.jpg",authors:"ericdeng",tags:["react.js"],keywords:["react","react-hooks","\u6559\u5b78","\u7b46\u8a18"]},l=void 0,s={unversionedId:"React/2022-05-02-react-hooks",id:"React/2022-05-02-react-hooks",isDocsHomePage:!1,title:"React Hooks \u7e3d\u6574\u7406\u7b46\u8a18",description:"\u5b78\u7fd2 React Hooks \u6642\u6574\u7406\u7684\u4e00\u4e9b\u7b46\u8a18\uff0c\u5167\u5bb9\u6db5\u84cb\u6240\u6709\u5e38\u7528\u7684Hook\u4f7f\u7528\u6559\u5b78\u53ca\u958b\u767c\u4e0a\u53ef\u4ee5\u6ce8\u610f\u53ef\u80fd\u8e29\u96f7\u7684\u5730\u65b9\u3002\u66f4\u65b0\u5230React 18\u65b0\u589e\u7684Hooks\u3002",source:"@site/docs/React/2022-05-02-react-hooks.md",sourceDirName:"React",slug:"/React/react-hooks",permalink:"/series/React/react-hooks",tags:[{label:"react.js",permalink:"/series/tags/react-js"}],version:"current",frontMatter:{slug:"react-hooks",title:"React Hooks \u7e3d\u6574\u7406\u7b46\u8a18",description:"\u5b78\u7fd2 React Hooks \u6642\u6574\u7406\u7684\u4e00\u4e9b\u7b46\u8a18\uff0c\u5167\u5bb9\u6db5\u84cb\u6240\u6709\u5e38\u7528\u7684Hook\u4f7f\u7528\u6559\u5b78\u53ca\u958b\u767c\u4e0a\u53ef\u4ee5\u6ce8\u610f\u53ef\u80fd\u8e29\u96f7\u7684\u5730\u65b9\u3002\u66f4\u65b0\u5230React 18\u65b0\u589e\u7684Hooks\u3002",image:"/img/2022-05-02-react-hooks/lautaro-andreani-xkBaqlcqeb4-unsplash.jpg",authors:"ericdeng",tags:["react.js"],keywords:["react","react-hooks","\u6559\u5b78","\u7b46\u8a18"]},sidebar:"mySidebar",previous:{title:"[Javascript] \u6df1\u5165\u4e86\u89e3\u4e8b\u4ef6\u8ff4\u5708(Event Loop)\uff0cMacrotask\u8ddfMicrotask\u662f\u4ec0\u9ebc\uff1f",permalink:"/series/Javascript/javascript-deep-dive-into-event-loop"},next:{title:"Prerender.io\u5982\u4f55\u5e6b\u52a9CSR\u7684SEO - \u539f\u7406\u4ecb\u7d39\u8207\u4f7f\u7528\u6559\u5b78",permalink:"/series/web-frontend-development/solve-seo-problems-with-prerenderio"}},i=[{value:"React Hook \u4f7f\u7528\u898f\u5247",id:"react-hook-\u4f7f\u7528\u898f\u5247",children:[],level:2},{value:"useState",id:"usestate",children:[{value:"Functional updates",id:"functional-updates",children:[],level:3},{value:"\u60f0\u6027\u521d\u59cb state",id:"\u60f0\u6027\u521d\u59cb-state",children:[],level:3},{value:"Batching of state updates",id:"batching-of-state-updates",children:[],level:3}],level:2},{value:"useEffect",id:"useeffect",children:[{value:"Effect function",id:"effect-function",children:[],level:3},{value:"Cleaning up an effect",id:"cleaning-up-an-effect",children:[],level:3},{value:"Timing of effects",id:"timing-of-effects",children:[],level:3},{value:"Conditionally firing an effect",id:"conditionally-firing-an-effect",children:[],level:3},{value:"\u7e3d\u7d50\u5e38\u898b\u7684\u56db\u500b\u4f7f\u7528\u60c5\u5883",id:"\u7e3d\u7d50\u5e38\u898b\u7684\u56db\u500b\u4f7f\u7528\u60c5\u5883",children:[],level:3}],level:2},{value:"useContext",id:"usecontext",children:[{value:"<code>React.createContext</code>",id:"reactcreatecontext",children:[],level:3},{value:"<code>Context.Provider</code>",id:"contextprovider",children:[],level:3}],level:2},{value:"useMemo",id:"usememo",children:[],level:2},{value:"useCallback",id:"usecallback",children:[],level:2},{value:"Memorized Hook",id:"memorized-hook",children:[],level:2},{value:"useReducer",id:"usereducer",children:[{value:"\u5982\u4f55\u521d\u59cb\u5316",id:"\u5982\u4f55\u521d\u59cb\u5316",children:[],level:3},{value:"useReducer \u8ddf Redux \u4e0d\u540c\u4e4b\u8655",id:"usereducer-\u8ddf-redux-\u4e0d\u540c\u4e4b\u8655",children:[],level:3}],level:2},{value:"useRef",id:"useref",children:[{value:"\u5e38\u898b\u7684\u4f7f\u7528\u60c5\u5883",id:"\u5e38\u898b\u7684\u4f7f\u7528\u60c5\u5883",children:[],level:3}],level:2},{value:"useLayoutEffect",id:"uselayouteffect",children:[],level:2},{value:"useDeferredValue",id:"usedeferredvalue",children:[],level:2},{value:"useTransition",id:"usetransition",children:[],level:2},{value:"useId",id:"useid",children:[],level:2},{value:"Reference",id:"reference",children:[],level:2}],p={toc:i};function d(e){var t=e.components,u=(0,r.Z)(e,c);return(0,o.kt)("wrapper",(0,a.Z)({},p,u,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("p",null,"\u5b78\u7fd2 React Hooks \u6642\u6574\u7406\u7684\u4e00\u4e9b\u7b46\u8a18\uff0c\u5167\u5bb9\u6db5\u84cb\u6240\u6709\u5e38\u7528\u7684 Hook \u4f7f\u7528\u6559\u5b78\u53ca\u958b\u767c\u4e0a\u53ef\u4ee5\u6ce8\u610f\u53ef\u80fd\u8e29\u96f7\u7684\u5730\u65b9\u3002"),(0,o.kt)("p",null,"\u66f4\u65b0\u5230 React 18 \u65b0\u589e\u7684 Hooks\u3002"),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"lautaro-andreani-xkBaqlcqeb4-unsplash.jpg",src:n(2240).Z})),(0,o.kt)("h2",{id:"react-hook-\u4f7f\u7528\u898f\u5247"},"React Hook \u4f7f\u7528\u898f\u5247"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u53ea\u80fd\u5728 React function component \u6216\u662f\u81ea\u5b9a\u7fa9\u7684 hook \u4e2d\u4f7f\u7528\uff0c\u4e0d\u80fd\u5728\u4e00\u822c\u7684 JavaScript function \u4e2d\u4f7f\u7528\u3002"),(0,o.kt)("li",{parentName:"ol"},"\u53ea\u80fd\u5728 React function component ",(0,o.kt)("strong",{parentName:"li"},"\u6700\u4e0a\u5c64"),"\u76f4\u63a5\u547c\u53eb\uff0c\u4e0d\u80fd\u5728\u689d\u4ef6\u5f0f\u3001\u8ff4\u5708\u6216\u5de2\u72c0\u51fd\u5f0f\u5167\u547c\u53eb hook\uff0cReact \u4f7f\u7528\u9019\u500b\u898f\u5247\u4f86\u4fdd\u8b49\u6bcf\u6b21 render \u6642\u547c\u53eb hook \u7684\u9806\u5e8f\u90fd\u662f\u4e00\u6a23\u7684\u3002")),(0,o.kt)("h2",{id:"usestate"},"useState"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"const [state, setState] = useState(initialState);\n")),(0,o.kt)("p",null,"useState \u6703\u56de\u50b3\u7576\u524d\u7684 state \u4ee5\u53ca\u53e6\u4e00\u500b\u7528\u4f86\u66f4\u65b0 state \u7684 setState function\u3002"),(0,o.kt)("p",null,"\u5982\u679c\u662f\u7b2c\u4e00\u6b21 render\uff0cstate \u7684\u503c\u6703\u662f initialState\uff0c\u5982\u679c\u662f\u5728\u5f8c\u7e8c\u7684 render\uff0cinitialState \u4e0d\u6703\u88ab\u4f7f\u7528\uff0cstate \u6703\u662f\u6700\u8fd1\u4e00\u6b21\u66f4\u65b0\u7684 state \u503c\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"setState(newState);\n")),(0,o.kt)("p",null,"setState function \u63a5\u6536\u65b0\u7684 state value\uff0c\u547c\u53eb\u4e4b\u5f8c\u6703\u5c07 re-render task \u52a0\u5165 queue \u4e2d\uff0c\u5c07\u5728\u4e0b\u4e00\u6b21 batch re-render \u6642\u66f4\u65b0\u5143\u4ef6\u7684\u72c0\u614b\u3002"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Note"),(0,o.kt)("br",{parentName:"p"}),"\n","React guarantees that\xa0",(0,o.kt)("inlineCode",{parentName:"p"},"setState"),"\xa0function identity is stable and won\u2019t change on re-renders. This is why it\u2019s safe to omit from the\xa0",(0,o.kt)("inlineCode",{parentName:"p"},"useEffect"),"\xa0or\xa0",(0,o.kt)("inlineCode",{parentName:"p"},"useCallback"),"\xa0dependency list."),(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("inlineCode",{parentName:"p"},"setState")," \u7684\u8a18\u61b6\u9ad4\u4f4d\u7f6e(reference identity)\u4e0d\u6703\u56e0\u70ba re-render \u800c\u6539\u8b8a\uff0c\u6240\u4ee5\u50b3\u905e\u7d66\u5176\u4ed6\u5b50\u5143\u4ef6\u4e5f\u4e0d\u6703\u9020\u6210\u5b50\u5143\u4ef6 re-render\u3002")),(0,o.kt)("h3",{id:"functional-updates"},"Functional updates"),(0,o.kt)("p",null,"\u5982\u679c\u8981\u8a08\u7b97\u65b0\u7684 state \u9700\u8981\u4f9d\u8cf4\u5148\u524d\u7684 state \uff0c\u4f60\u53ef\u4ee5\u900f\u904e\u50b3\u905e\u4e00\u500b function \u5230 \xa0",(0,o.kt)("inlineCode",{parentName:"p"},"setState")," \u4f86\u66f4\u65b0\u3002\u8a72 function \u6703\u63a5\u6536\u524d\u4e00\u500b state\uff0c\u53ef\u4ee5\u628a\u66f4\u65b0\u908f\u8f2f\u5beb\u5728 function \u5167\u7136\u5f8c\u56de\u50b3\u4e0b\u4e00\u500b\u72c0\u614b\u3002\u5982\u679c function \u56de\u50b3\u7684 state \u6c92\u6709\u8b8a\uff0c\u5c07\u4e0d\u6703\u89f8\u767c re-render\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"function Counter({ initialCount }) {\n  const [count, setCount] = useState(initialCount);\n  return (\n    <>\n      Count: {count}\n      <button onClick={() => setCount(initialCount)}>Reset</button>\n      <button onClick={() => setCount((prevCount) => prevCount - 1)}>-</button>\n      <button onClick={() => setCount((prevCount) => prevCount + 1)}>+</button>\n    </>\n  );\n}\n")),(0,o.kt)("p",null,"\u4e5f\u53ef\u4ee5\u7d50\u5408 object spread \u8a9e\u6cd5\u4f86\u66f4\u65b0 object state"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"const [state, setState] = useState({count: 4, name: 'blue'});\nsetState(prevState => {...prevSate, count: prevSate.count + 1};\nconsole.log(state); // {count: 5, name: 'blue'}\n")),(0,o.kt)("h3",{id:"\u60f0\u6027\u521d\u59cb-state"},"\u60f0\u6027\u521d\u59cb state"),(0,o.kt)("p",null,"\u5982\u679c\u521d\u59cb state \u9700\u8981\u8907\u96dc\u7684\u908f\u8f2f\u904b\u7b97\uff0c\u4f60\u53ef\u4ee5\u50b3\u5165\u4e00\u500b init function \u7d66 useState\uff0cinit function \u53ea\u6703\u5728\u521d\u59cb render \u6642\u88ab\u8abf\u7528\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"const [state, setState] = useState(() => {\n  const initialState = someExpensiveComputation(props);\n  return initialState;\n});\n")),(0,o.kt)("h3",{id:"batching-of-state-updates"},"Batching of state updates"),(0,o.kt)("p",null,"React \u4e0d\u6703\u5728\u6bcf\u6b21 setState \u5f8c\u5c31\u99ac\u4e0a\u540c\u6b65\u5730\u57f7\u884c re-render\uff0c\u800c\u662f\u5c07\u591a\u500b setState \u7d2f\u7a4d\u52a0\u5165\u5230 queue \u4e2d\uff0c\u518d\u4e00\u6b21 re-render \u66f4\u65b0\u591a\u500b state\uff0c\u85c9\u7531\u6279\u6b21\u8655\u7406 state updates \u5c31\u53ea\u8981 re-render \u4e00\u6b21\u4f86\u6539\u5584\u6548\u80fd\u3002"),(0,o.kt)("p",null,"\u5728 React 18 \u4e4b\u524d\u53ea\u6703 batch \u66f4\u65b0 React event handler \u88e1\u9762\u7684 setState\uff0c\u5982\u679c\u662f\u5728 setTimeout \u6216\u662f promise \u4e4b\u985e\u7684\u539f\u751f event handler \u88e1\u9762\u7684 setState \u662f\u4e0d\u6703\u88ab batch update\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"// Before React 18 only React events were batched\n\nfunction handleClick() {\n  setCount((c) => c + 1);\n  setFlag((f) => !f);\n  // React will only re-render once at the end (that's batching!)\n}\n\nsetTimeout(() => {\n  setCount((c) => c + 1);\n  setFlag((f) => !f);\n  // React will render twice, once for each state update (no batching)\n}, 1000);\n")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u5728 React 18 \u4e4b\u5f8c\u5168\u90e8\u7684 event handler"),"\u88e1\u9762\u7684 setState \u90fd\u6703\u81ea\u52d5\u88ab batch update \u4e86\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"// After React 18 updates inside of timeouts, promises,\n// native event handlers or any other event are batched.\n\nfunction handleClick() {\n  setCount((c) => c + 1);\n  setFlag((f) => !f);\n  // React will only re-render once at the end (that's batching!)\n}\n\nsetTimeout(() => {\n  setCount((c) => c + 1);\n  setFlag((f) => !f);\n  // React will only re-render once at the end (that's batching!)\n}, 1000);\n")),(0,o.kt)("p",null,"\u5982\u679c\u4f60\u4e0d\u60f3\u8981 batch update \u9084\u662f\u53ef\u4ee5\u7528 flushSync \u8b93 state \u53ef\u4ee5\u7368\u7acb\u540c\u6b65\u7684\u88ab\u66f4\u65b0\u505a re-render\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"import { flushSync } from 'react-dom';\n\nfunction handleClick() {\n  flushSync(() => {\n    setCounter((c) => c + 1);\n  });\n  // React has updated the DOM by now\n  flushSync(() => {\n    setFlag((f) => !f);\n  });\n  // React has updated the DOM by now\n}\n")),(0,o.kt)("h2",{id:"useeffect"},"useEffect"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"useEffect(didUpdate);\n")),(0,o.kt)("p",null,"function component body \u5167 (render \u7684\u671f\u9593) \u4e0d\u80fd\u76f4\u63a5\u57f7\u884c\u6703\u7522\u751f side effect \u7684\u884c\u70ba\uff0c\u4f8b\u5982 data fetching, timers, subscriptions\uff0c\u9019\u4e9b\u884c\u70ba\u61c9\u8a72\u5beb\u5728 useEffect\u3002"),(0,o.kt)("h3",{id:"effect-function"},"Effect function"),(0,o.kt)("p",null,"useEffect \u50b3\u5165\u7684\u7b2c\u4e00\u500b\u53c3\u6578\u662f\u4e00\u500b effect function\uff0c\u4efb\u4f55\u6709 side effect \u7684\u884c\u70ba\u90fd\u61c9\u8a72\u8981\u5beb\u5728\u9019\u500b effect function \u5167\uff0c",(0,o.kt)("strong",{parentName:"p"},"effect function \u6703\u5728 component render \u5b8c\u6210(paint)\u4e4b\u5f8c\u624d\u57f7\u884c"),"\uff0ceffect function \u53ea\u80fd\u56de\u50b3\u4e00\u500b clean-up function \u6216\u662f\u4ec0\u9ebc\u90fd\u4e0d\u56de\u50b3(\u5305\u542b",(0,o.kt)("inlineCode",{parentName:"p"},"undefined"),")\u3002"),(0,o.kt)("h3",{id:"cleaning-up-an-effect"},"Cleaning up an effect"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"useEffect(() => {\n  const subscription = props.source.subscribe();\n  return () => {\n    // Clean up the subscription\n    subscription.unsubscribe();\n  };\n});\n")),(0,o.kt)("p",null,"\u5728 component \u96e2\u958b\u87a2\u5e55\u4e4b\u524d\u9700\u8981\u6e05\u9664 effect \u6240\u5efa\u7acb\u7684\u8cc7\u6e90\uff0c\u50cf\u662f subscription \u6216 Timer ID\uff0c\u4ee5\u907f\u514d memory leaks\u3002\u9019\u4e9b\u8981\u6e05\u9664\u7684 effect \u53ef\u4ee5\u5beb\u5728 effect function \u56de\u50b3\u7684 clean-up function \u5167\uff0c",(0,o.kt)("strong",{parentName:"p"},"clean-up function \u6703\u5728\u5143\u4ef6\u88ab\u79fb\u9664\u524d(unmount)\u88ab\u8abf\u7528\u3002")),(0,o.kt)("p",null,"component \u901a\u5e38\u90fd\u6703 render \u5f88\u591a\u6b21\uff0c\u5728\u6bcf\u6b21 render \u57f7\u884c\u4e0b\u4e00\u500b effect \u4e4b\u524d\uff0c\u4e0a\u4e00\u500b effect \u7684 clean-up function \u6703\u5148\u88ab\u57f7\u884c\u6e05\u9664\u5df2\u5efa\u7acb\u7684\u8cc7\u6e90\u3002"),(0,o.kt)("h3",{id:"timing-of-effects"},"Timing of effects"),(0,o.kt)("p",null,"effect function \u57f7\u884c\u7684\u6642\u6a5f\u9ede\u6703\u5728",(0,o.kt)("strong",{parentName:"p"},"layout \u548c paint \u4e4b\u5f8c"),"\uff0c\u4e5f\u5c31\u662f\u756b\u9762\u90fd\u5df2\u7d93\u6e32\u67d3\u597d\uff0cuser \u5df2\u7d93\u770b\u5230\u756b\u9762\u4e4b\u5f8c\u3002\u4e5f\u56e0\u70ba\u9019\u6a23\u57f7\u884c effect function \u6642\u624d\u4e0d\u6703 block \u4f4f\u700f\u89bd\u5668\u66f4\u65b0\u756b\u9762\uff0c\u9069\u7528\u65bc\u5f88\u591a\u5e38\u898b\u7684 side effect\uff0c\u4f8b\u5982 data fetching\u3001\u8a2d\u5b9a subscription \u548c event handler\uff0c\u4e0d\u963b\u7919\u700f\u89bd\u5668\u66f4\u65b0\u756b\u9762\u7684\u5de5\u4f5c\u3002"),(0,o.kt)("p",null,"\u4f46\u6709\u4e9b effect \u9700\u8981\u767c\u751f\u5728 paint \u4e4b\u524d\uff0c\u4f8b\u5982\u4f7f\u7528\u8005\u53ef\u898b\u7684 DOM \u6539\u8b8a\uff0c\u907f\u514d user \u5148\u770b\u5230\u521d\u59cb\u503c\u53c8\u7a81\u7136\u4e00\u9583\u8b8a\u6210 side effect \u6539\u8b8a\u7684\u503c\uff0c\u9019\u6642\u53ef\u4ee5\u9078\u64c7\u4f7f\u7528 ",(0,o.kt)("inlineCode",{parentName:"p"},"useLayoutEffect")," \uff0c\u4ed6\u8ddf useEffect \u7684\u5dee\u5225\u53ea\u5728\u65bc\u4ed6\u57f7\u884c\u7684\u6642\u6a5f\u9ede\u662f\u5728 paint \u4e4b\u524d\uff0c\u4f46\u662f\u4f7f\u7528\u6642\u9700\u8981\u6ce8\u610f\u4ed6\u6703 blocking \u700f\u89bd\u5668\u6e32\u67d3\u756b\u9762\uff0c\u4e0d\u80fd\u57f7\u884c\u904b\u7b97\u6642\u9593\u592a\u9577\u7684\u5de5\u4f5c\uff0c\u5426\u5247\u6703\u5ef6\u5f8c user \u770b\u5230\u756b\u9762\u7684\u6642\u9593\u3002"),(0,o.kt)("h3",{id:"conditionally-firing-an-effect"},"Conditionally firing an effect"),(0,o.kt)("p",null,"\u5982\u679c useEffect \u53ea\u6709\u50b3\u5165\u4e00\u500b function \u53c3\u6578\uff0c\u9810\u8a2d\u6703\u662f\u5728",(0,o.kt)("strong",{parentName:"p"},"\u6bcf\u6b21 render \u5b8c\u6210\u4e4b\u5f8c"),"\u8abf\u7528 effect function\u3002"),(0,o.kt)("p",null,"\u5982\u679c\u5728\u7b2c\u4e8c\u500b\u53c3\u6578\u4e2d\u50b3\u5165 dependency array\uff0c\u53ef\u4ee5\u8b93 useEffect",(0,o.kt)("strong",{parentName:"p"},"\u53ea\u5728 dependency array \u4e2d\u7684\u503c\u6539\u8b8a\u4e4b\u5f8c"),"\u624d\u57f7\u884c effect function\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"useEffect(() => {\n  // \u5075\u6e2c\u5230 props.source \u6539\u8b8a\u4e4b\u5f8c\u624d\u57f7\u884c\u9019\u500bfunction\n  const subscription = props.source.subscribe();\n  return () => {\n    subscription.unsubscribe();\n  };\n}, [props.source]);\n")),(0,o.kt)("p",null,"\u6240\u6709\u5728\u8a72 component \u4e2d\u6703\u96a8\u6642\u9593\u800c\u8b8a\u7684\u503c\uff08\u4f8b\u5982 props \u548c state\uff09\u4ee5\u53ca\u5728\u8a72 effect function \u6240\u4f7f\u7528\u5230\u7684\u503c\u90fd\u61c9\u8a72\u5beb\u5728 dependency array \u88e1\uff0c\u5426\u5247 effect function \u6703\u7528\u5230\u4e0a\u4e00\u6b21 render \u7684\u820a\u503c\u3002"),(0,o.kt)("p",null,"\u5982\u679c\u53ea\u60f3\u8981\u5728 mount \u6642\u57f7\u884c\u4e00\u6b21 effect function\uff0cunmount \u6642\u57f7\u884c\u4e00\u6b21 clean-up function\uff0c\u53ef\u4ee5\u53ea\u5e36\u4e00\u500b\u7a7a\u7684 dependency array(",(0,o.kt)("inlineCode",{parentName:"p"},"[]"),")\u3002"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},"\u5efa\u8b70\u4f7f\u7528 \xa0",(0,o.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/eslint-plugin-react-hooks#installation"},"eslint-plugin-react-hooks")," \u4e2d\u7684 \xa0",(0,o.kt)("a",{parentName:"p",href:"https://github.com/facebook/react/issues/14920"},"exhaustive-deps")," \u898f\u5247\u3002\u5b83\u6703\u5728\u4f9d\u8cf4\u932f\u8aa4\u6642\u767c\u51fa\u8b66\u544a\u4e26\u63d0\u51fa\u4fee\u6b63\u5efa\u8b70\u3002")),(0,o.kt)("h3",{id:"\u7e3d\u7d50\u5e38\u898b\u7684\u56db\u500b\u4f7f\u7528\u60c5\u5883"},"\u7e3d\u7d50\u5e38\u898b\u7684\u56db\u500b\u4f7f\u7528\u60c5\u5883"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u4e0d\u5e36 dependency array\uff0c\u5728\u6bcf\u6b21 render \u5b8c\u6210\u4e4b\u5f8c\u90fd\u57f7\u884c effect function"),(0,o.kt)("li",{parentName:"ol"},"\u5e36\u7a7a\u7684 dependency array\uff0c\u53ea\u6703\u57f7\u884c\u4e00\u6b21 effect function\uff0c\u6642\u6a5f\u9ede\u662f\u5728\u521d\u6b21 render \u5b8c\u6210\u4e4b\u5f8c"),(0,o.kt)("li",{parentName:"ol"},"\u5c07 effect function \u5167\u6703\u7528\u5230\u7684 dependency state/props \u653e\u9032 dependency array \u4e2d\uff0c\u5982\u679c dependency \u6709\u8b8a\u5316\u624d\u57f7\u884c effect function"),(0,o.kt)("li",{parentName:"ol"},"return clean-up function\uff0c\u5728 unmount \u6642\u6e05\u9664 effect \u4e2d\u4f7f\u7528\u5230\u7684\u8cc7\u6e90")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"[https://medium.com/hannah-lin/react-hook-\u7b46\u8a18-\u5f9e\u6700\u57fa\u672c\u7684-hook-\u958b\u59cb-usestate-useeffect-fee6582d8725](https://medium.com/hannah-lin/react-hook-%E7%AD%86%E8%A8%98-%E5%BE%9E%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9A%84-hook-%E9%96%8B%E5%A7%8B-usestate-useeffect-fee6582d8725)",src:n(4945).Z})),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://medium.com/hannah-lin/react-hook-%E7%AD%86%E8%A8%98-%E5%BE%9E%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9A%84-hook-%E9%96%8B%E5%A7%8B-usestate-useeffect-fee6582d8725"},"https://medium.com/hannah-lin/react-hook-\u7b46\u8a18-\u5f9e\u6700\u57fa\u672c\u7684-hook-\u958b\u59cb-usestate-useeffect-fee6582d8725")),(0,o.kt)("h2",{id:"usecontext"},"useContext"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"const value = useContext(MyContext);\n")),(0,o.kt)("p",null,"\u63a5\u6536\u4e00\u500b context object \u53c3\u6578\uff08",(0,o.kt)("a",{parentName:"p",href:"https://reactjs.org/docs/context.html#reactcreatecontext"},"React.createContext"),"\xa0 \u7684\u56de\u50b3\u503c\uff09\u4e26\u56de\u50b3\u8a72 context \u76ee\u524d\u7684\u503c\u3002"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"useContext"),"\u53d6\u5f97\u7684\u503c\u53d6\u6c7a\u65bc\u8ddd\u96e2 component \u6700\u8fd1\u7684 \xa0",(0,o.kt)("inlineCode",{parentName:"p"},"<MyContext.Provider>"),"\xa0 \u7684 \xa0",(0,o.kt)("inlineCode",{parentName:"p"},"value"),"\xa0prop\u3002"),(0,o.kt)("p",null,"\u547c\u53eb \xa0",(0,o.kt)("inlineCode",{parentName:"p"},"useContext")," \u7684 component \u7e3d\u662f\u6703\u5728 context value \u66f4\u65b0\u6642 re-render\u3002\u5982\u679c re-render component \u7684\u64cd\u4f5c\u5f88\u6602\u8cb4\uff0c\u4f60\u53ef\u4ee5\u900f\u904e ",(0,o.kt)("inlineCode",{parentName:"p"},"useMemo")," \u6216\u5176\u4ed6 ",(0,o.kt)("a",{parentName:"p",href:"https://github.com/facebook/react/issues/15156#issuecomment-474590693"},"memoization \u4f86\u6700\u4f73\u5316"),"\u3002"),(0,o.kt)("p",null,"Example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"const themes = {\n  light: {\n    foreground: '#000000',\n    background: '#eeeeee',\n  },\n  dark: {\n    foreground: '#ffffff',\n    background: '#222222',\n  },\n};\n\nconst ThemeContext = React.createContext(themes.light);\n\nfunction App() {\n  return (\n    <ThemeContext.Provider value={themes.dark}>\n      <Toolbar />\n    </ThemeContext.Provider>\n  );\n}\n\nfunction Toolbar(props) {\n  return (\n    <div>\n      <ThemedButton />\n    </div>\n  );\n}\n\nfunction ThemedButton() {\n  const theme = useContext(ThemeContext);\n  return (\n    <button style={{ background: theme.background, color: theme.foreground }}>\n      I am styled by theme context!\n    </button>\n  );\n}\n")),(0,o.kt)("h3",{id:"reactcreatecontext"},(0,o.kt)("inlineCode",{parentName:"h3"},"React.createContext")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"const MyContext = React.createContext(defaultValue);\n")),(0,o.kt)("h3",{id:"contextprovider"},(0,o.kt)("inlineCode",{parentName:"h3"},"Context.Provider")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"<MyContext.Provider value={/* some value */}>\n")),(0,o.kt)("p",null,"\u6bcf\u4e00\u500b context object \u90fd\u6709\u4e00\u500b Provider React component\uff0c\u63d0\u4f9b\u5b50\u5143\u4ef6\u8a02\u95b1 context \u7684\u6539\u8b8a\u4e8b\u4ef6\u3002"),(0,o.kt)("p",null,"\u591a\u500b Context Provider \u53ef\u4ee5\u76f4\u63a5\u5beb\u6210\u5de2\u72c0\uff0c\u4f8b\u5982\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"class App extends React.Component {\n  render() {\n    const { signedInUser, theme } = this.props;\n\n    // App component that provides initial context values\n    return (\n      <ThemeContext.Provider value={theme}>\n        <UserContext.Provider value={signedInUser}>\n          <Layout />\n        </UserContext.Provider>\n      </ThemeContext.Provider>\n    );\n  }\n}\n")),(0,o.kt)("h2",{id:"usememo"},"useMemo"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"const memoizedValue = useMemo(() => computeExpensiveValue(a, b), [a, b]);\n")),(0,o.kt)("p",null,"Pass a \u201ccreate\u201d function and an array of dependencies"),(0,o.kt)("p",null,"Returns a\xa0",(0,o.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/Memoization"},"memoized"),"\xa0value. \u8a18\u4f4f callback function \u56de\u50b3\u7684\u904b\u7b97\u7d50\u679c\uff0c\u53ef\u4ee5\u662f\u4efb\u4f55\u503c\uff0c\u5305\u542b object\u3001array\u3001basic type\uff0c\u751a\u81f3\u662f React Component\u3002"),(0,o.kt)("p",null,"re-render \u6642\u53ea\u6709\u5728 dependencies \u6539\u8b8a\u5f8c\u624d\u6703\u91cd\u65b0\u57f7\u884c callback function \u66f4\u65b0 memoizedValue\uff0c\u5982\u679c dependencies \u6c92\u6709\u6539\u8b8a\u6703\u76f4\u63a5\u4f7f\u7528\u7576\u524d\u7684 memoizedValue\uff0c\u4e0d\u6703\u91cd\u65b0\u57f7\u884c callback function\u3002\u9069\u5408\u628a",(0,o.kt)("strong",{parentName:"p"},"\u57f7\u884c\u901f\u5ea6\u6162\u7684\u904b\u7b97"),"\u6216\u662f",(0,o.kt)("strong",{parentName:"p"},"dependencies \u6c92\u8b8a\u7d50\u679c\u5c31\u4e0d\u6703\u8b8a\u5f97\u904b\u7b97"),"\u4f7f\u7528 useMemo \u5c07\u7d50\u679c\u5b58\u8d77\u4f86\uff0c\u907f\u514d\u6bcf\u6b21 render \u90fd\u8981\u91cd\u8907\u57f7\u884c\u4e0d\u5fc5\u8981\u7684\u904b\u7b97\u4ee5\u6539\u5584\u6548\u80fd\u3002"),(0,o.kt)("p",null,"\u50b3\u5230 \xa0",(0,o.kt)("inlineCode",{parentName:"p"},"useMemo"),"\xa0 \u7684 function \u6703\u5728 render \u671f\u9593\u57f7\u884c\uff0c\u56e0\u6b64",(0,o.kt)("strong",{parentName:"p"},"\u4e0d\u80fd\u57f7\u884c\u6709 side effect \u7684\u904b\u7b97"),"\u3002"),(0,o.kt)("p",null,"\u5982\u679c\u6c92\u6709\u63d0\u4f9b array\uff0c\u6bcf\u6b21 render \u6642\u90fd\u6703\u8a08\u7b97\u65b0\u7684\u503c\uff0c\u7b49\u65bc\u6c92\u4f5c\u7528\u3002"),(0,o.kt)("h2",{id:"usecallback"},"useCallback"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"const memoizedCallback = useCallback(() => {\n  doSomething(a, b);\n}, [a, b]);\n")),(0,o.kt)("p",null,"\u63a5\u6536\u4e00\u500b callback function \u8ddf\u4e00\u500b dependency array"),(0,o.kt)("p",null,"\u56de\u50b3 memoized callback\uff0c\u9019\u500b memoized callback \u53ea\u6703\u5728 dependencies \u6539\u8b8a\u6642\u66f4\u65b0\uff0c\u5982\u679c dependencies \u6c92\u6709\u6539\u8b8a\uff0cmemoized callback \u6703\u88ab\u4fdd\u5b58\u5728\u540c\u4e00\u500b\u8a18\u61b6\u9ad4\u4f4d\u7f6e(reference identity)\uff0c\u5728\u4e0b\u4e00\u6b21\u7684 render \u76f4\u63a5\u7e7c\u7e8c\u4f7f\u7528\u3002"),(0,o.kt)("p",null,"\u4e00\u822c\u7684 callback function \u5373\u4f7f\u5167\u5bb9\u6216\u662f\u7d50\u679c\u6c92\u6709\u4efb\u4f55\u6539\u8b8a\u4e5f\u6703\u5728\u6bcf\u6b21 render \u6642\u5b58\u9032\u65b0\u7684\u8a18\u61b6\u9ad4\u4f4d\u7f6e\uff0c\u7576\u9019 callback \u6709\u50b3\u7d66 child component \u4f7f\u7528\u6642\uff0c\u56e0\u70ba\u5c0d child \u4f86\u8aaa\u90fd\u662f\u65b0\u7684 prop\uff0c\u6703\u9020\u6210 child component \u6bcf\u6b21\u90fd re-render\uff0c\u4f46\u9019\u5176\u5be6\u662f\u4e0d\u5fc5\u8981\u7684\u800c\u4e14\u6d6a\u8cbb\u6548\u80fd\u7684\u56e0\u70ba re-render \u4e4b\u5f8c\u9084\u662f\u4e00\u6a23\u7684\u7d50\u679c\uff0c\u53ea\u9700\u8981\u5728 callback function \u771f\u7684\u6709\u6539\u8b8a\u6642\u624d re-render \u5c31\u597d\uff0c\u70ba\u4e86\u6539\u5584\u9019\u500b\u6548\u80fd\u554f\u984c\uff0c\u53ef\u4ee5\u6539\u6210\u7528 memoizedCallback \u50b3\u905e\u7d66 child\uff0c\u5982\u6b64\u4e00\u4f86\u53ea\u6709\u5728 callback function \u771f\u6b63\u6709\u6539\u8b8a\u6642\u624d\u6703\u8b93 child component re-render\u3002"),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("inlineCode",{parentName:"p"},"useCallback(fn, deps)"),"\xa0 \u76f8\u7b49\u65bc \xa0",(0,o.kt)("inlineCode",{parentName:"p"},"useMemo(() => fn, deps)"),"\u3002")),(0,o.kt)("h2",{id:"memorized-hook"},"Memorized Hook"),(0,o.kt)("p",null,"useMemo, useCallback"),(0,o.kt)("p",null,"\u4e0d\u5efa\u8b70\u5168\u90e8\u90fd\u7528 Memorized Hook\uff0c\u56e0\u70ba\u53ef\u80fd\u6703\u6709 memory overhead\uff0cmemory usage \u592a\u591a\u4e5f\u6703\u6709 performance issue \uff0c\u9069\u7528\u7684\u51fd\u5f0f\u8981\u7b26\u5408\uff1a"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u57f7\u884c\u901f\u5ea6\u5f88\u6162 \xa0(Expensive function or expensive calculation)"),(0,o.kt)("li",{parentName:"ul"},"\u4e0d\u9700\u8981\u6bcf\u6b21 render \u90fd\u57f7\u884c\u7684\u904b\u7b97")),(0,o.kt)("h2",{id:"usereducer"},"useReducer"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"const [state, dispatch] = useReducer(reducer, initialArg, init);\n")),(0,o.kt)("p",null,"\u7b2c\u4e00\u500b\u53c3\u6578\u662f reducer function\uff0c",(0,o.kt)("strong",{parentName:"p"},"reducer \u662f\u4e00\u500b\u4e0d\u80fd\u6709 side effect \u7684 pure function"),"\uff0c\u8ca0\u8cac\u7684\u5de5\u4f5c\u662f\u63a5\u6536\u524d\u4e00\u500b state \u4ee5\u53ca action \u7136\u5f8c\u8a08\u7b97\u4e0b\u4e00\u500b state \u4e26\u56de\u50b3\u3002"),(0,o.kt)("p",null,"useReducer \u6703\u56de\u50b3\u7576\u524d\u7684 state \u4ee5\u53ca dispatch function\uff0ccomponent \u53ef\u4ee5\u900f\u904e dispatch action \u4f86\u66f4\u65b0 state \u89f8\u767c re-render\u3002"),(0,o.kt)("p",null,"Example"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"const initialState = { count: 0 };\n\nfunction reducer(state, action) {\n  switch (action.type) {\n    case 'increment':\n      return { count: state.count + 1 };\n    case 'decrement':\n      return { count: state.count - 1 };\n    default:\n      throw new Error();\n  }\n}\n\nfunction Counter() {\n  const [state, dispatch] = useReducer(reducer, initialState);\n  return (\n    <>\n      Count: {state.count}\n      <button onClick={() => dispatch({ type: 'decrement' })}>-</button>\n      <button onClick={() => dispatch({ type: 'increment' })}>+</button>\n    </>\n  );\n}\n")),(0,o.kt)("p",null,"\u4f7f\u7528\u4e0a\u7684\u6d41\u7a0b\u4e3b\u8981\u6703\u662f\u9019\u6a23\uff1a"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"\u5b9a\u7fa9 action object\uff0c\u4e0b\u4e00\u500b\u72c0\u614b\u8981\u505a\u4ec0\u9ebc\u6539\u8b8a\uff1f"),(0,o.kt)("li",{parentName:"ol"},"\u5b9a\u7fa9 reducer\uff0c\u63a5\u6536\u5230 action \u4e4b\u5f8c\u4e0b\u4e00\u500b\u72c0\u614b\u8a72\u5982\u4f55\u6539\u8b8a\uff1f"),(0,o.kt)("li",{parentName:"ol"},"\u5728\u5143\u4ef6\u4e2d\u4f7f\u7528 state"),(0,o.kt)("li",{parentName:"ol"},"\u5728\u5143\u4ef6\u4e2d\u7684 event handler \u900f\u904e dispatch action \u547c\u53eb reducer \u4f86\u66f4\u65b0 state\uff0cre-render component")),(0,o.kt)("p",null,(0,o.kt)("img",{alt:"[https://dmitripavlutin.com/react-usereducer/](https://dmitripavlutin.com/react-usereducer/)",src:n(4765).Z})),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://dmitripavlutin.com/react-usereducer/"},"https://dmitripavlutin.com/react-usereducer/")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"Note"),(0,o.kt)("br",{parentName:"p"}),"\n","React guarantees that\xa0",(0,o.kt)("inlineCode",{parentName:"p"},"dispatch"),"\xa0function identity is stable and won\u2019t change on re-renders. This is why it\u2019s safe to omit from the\xa0",(0,o.kt)("inlineCode",{parentName:"p"},"useEffect"),"\xa0or\xa0",(0,o.kt)("inlineCode",{parentName:"p"},"useCallback"),"\xa0dependency list."),(0,o.kt)("p",{parentName:"blockquote"},"dispatch function \u5728 re-render \u7684\u6642\u5019\u4e0d\u6703\u88ab\u6539\u8b8a\uff0c\u56e0\u6b64\u4e0d\u6703\u9020\u6210\u5b50\u5143\u4ef6 re-render\uff0c\u9069\u5408\u62ff\u4f86\u50b3\u905e\u7d66\u5b50\u5143\u4ef6\u4f7f\u7528\u540c\u6642\u4fdd\u6301\u597d\u7684\u6548\u80fd\u3002")),(0,o.kt)("h3",{id:"\u5982\u4f55\u521d\u59cb\u5316"},"\u5982\u4f55\u521d\u59cb\u5316"),(0,o.kt)("p",null,"\u6709\u5169\u7a2e\u65b9\u5f0f\u53ef\u4ee5\u521d\u59cb\u5316 useReducer state\uff0c\u7b2c\u4e00\u7a2e\u662f\u900f\u904e\u7b2c\u4e8c\u500b\u53c3\u6578\u50b3\u5165\u521d\u59cb\u72c0\u614b"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"const [state, dispatch] = useReducer(reducer, { count: initialCount });\n")),(0,o.kt)("p",null,"\u7b2c\u4e8c\u7a2e\u65b9\u5f0f\u662f\u60f0\u6027\u521d\u59cb\u5316(Lazy initialization)\uff0c\u900f\u904e\u7b2c\u4e09\u500b\u53c3\u6578\u50b3\u5165 init function\uff0cinit function \u53ef\u4ee5\u63a5\u6536 props\uff0c\u7136\u5f8c\u56de\u50b3\u8981\u521d\u59cb\u5316\u7684 state\uff0c\u9019\u7a2e\u65b9\u5f0f\u53ef\u4ee5\u8b93\u4f60\u628a\u521d\u59cb\u5316\u7684\u908f\u8f2f\u5beb\u5728 reducer \u4e4b\u5916\uff0c\u8981\u5728 reducer \u4e2d\u8655\u7406\u521d\u59cb\u5316\u7684 action \u4e5f\u6703\u6bd4\u8f03\u65b9\u4fbf\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"function init(initialCount) {\n  return { count: initialCount };\n}\n\nfunction reducer(state, action) {\n  switch (action.type) {\n    case 'increment':\n      return { count: state.count + 1 };\n    case 'decrement':\n      return { count: state.count - 1 };\n    case 'reset':\n      return init(action.payload);\n    default:\n      throw new Error();\n  }\n}\n\nfunction Counter({ initialCount }) {\n  const [state, dispatch] = useReducer(reducer, initialCount, init);\n  return (\n    <>\n      Count: {state.count}\n      <button\n        onClick={() => dispatch({ type: 'reset', payload: initialCount })}\n      >\n        Reset\n      </button>\n      <button onClick={() => dispatch({ type: 'decrement' })}>-</button>\n      <button onClick={() => dispatch({ type: 'increment' })}>+</button>\n    </>\n  );\n}\n")),(0,o.kt)("h3",{id:"usereducer-\u8ddf-redux-\u4e0d\u540c\u4e4b\u8655"},"useReducer \u8ddf Redux \u4e0d\u540c\u4e4b\u8655"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"userReducer \u8cc7\u6599\u662f\u5b58\u5728 component state\uff0c\u800c Redux \u662f\u5b58\u5728 global store"),"\uff0c\u53ef\u4ee5\u642d\u914d useContext \u505a\u5230\u985e\u4f3c global store \u7684\u6548\u679c\u3002"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"userReducer \u6c92\u6709 middleware"),"\uff0c\u4e0d\u80fd\u50cf Redux \u7528 thunk \u6216 saga \u4f86\u8655\u7406 side effect\u3002")),(0,o.kt)("h2",{id:"useref"},"useRef"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"const refContainer = useRef(initialValue); // {current: initialValue}\n")),(0,o.kt)("p",null,"useRef \u6703\u56de\u50b3\u4e00\u500b\u6709 \xa0",(0,o.kt)("inlineCode",{parentName:"p"},"current")," \u5c6c\u6027\u7684 object\uff0c",(0,o.kt)("inlineCode",{parentName:"p"},"refContainer.current")," \u7684\u503c\u6703\u88ab\u521d\u59cb\u5316\u70ba initialValue\u3002"),(0,o.kt)("p",null,"refContainer \u6703\u5728 component",(0,o.kt)("strong",{parentName:"p"},"\u6574\u500b\u751f\u547d\u9031\u671f\u90fd\u4fdd\u5b58\u4e00\u6a23\u7684 reference"),"\u3002\u5982\u679c\u662f\u81ea\u5df1\u5efa\u7acb\u7684",(0,o.kt)("inlineCode",{parentName:"p"},"{current: ...}"),"\xa0object\uff0c\u6bcf\u6b21 render \u5f8c reference \u5c31\u6703\u6539\u8b8a\u3002"),(0,o.kt)("p",null,"\u66f4\u65b0 current \u7684\u503c",(0,o.kt)("strong",{parentName:"p"},"\u4e0d\u6703\u89f8\u767c re-render"),"\u3002"),(0,o.kt)("p",null,"\u66f4\u65b0 \xa0",(0,o.kt)("inlineCode",{parentName:"p"},"useRef")," object \u7684 current\xa0 \u662f side effect\uff0c\u6240\u4ee5\u8981\u5beb\u5728 \xa0",(0,o.kt)("inlineCode",{parentName:"p"},"useEffect"),"\xa0 \u6216 event handler \u88e1\u9762\u3002"),(0,o.kt)("h3",{id:"\u5e38\u898b\u7684\u4f7f\u7528\u60c5\u5883"},"\u5e38\u898b\u7684\u4f7f\u7528\u60c5\u5883"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u76f4\u63a5\u5b58\u53d6 child \u6216 DOM \u57f7\u884c\u64cd\u4f5c")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'function TextInputWithFocusButton() {\n  const inputEl = useRef(null);\n  const onButtonClick = () => {\n    // `current` points to the mounted text input element\n    inputEl.current.focus();\n  };\n  return (\n    <>\n      <input ref={inputEl} type="text" />\n      <button onClick={onButtonClick}>Focus the input</button>\n    </>\n  );\n}\n')),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"\u8a08\u7b97 render \u6b21\u6578")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"const App = () => {\n  const renderCount = useRef(0); // { current: 0 }\n\n  useEffect(() => {\n    renderCount.current += 1;\n  });\n\n  return <p>{renderCount.current}</p>;\n};\n")),(0,o.kt)("h2",{id:"uselayouteffect"},"useLayoutEffect"),(0,o.kt)("p",null,"\u4f7f\u7528\u65b9\u5f0f\u8ddf useEffect \u76f8\u540c\uff0c\u5dee\u5225\u5728\u65bc useLayoutEffect \u7684 effect function \u662f\u5728\u700f\u89bd\u5668 paint \u6e32\u67d3\u756b\u9762",(0,o.kt)("strong",{parentName:"p"},"\u4e4b\u524d"),"\u540c\u6b65(synchronously)\u57f7\u884c\uff0c\u6240\u4ee5",(0,o.kt)("strong",{parentName:"p"},"\u756b\u9762\u6703\u88ab block \u4f4f\u76f4\u5230 effect function \u57f7\u884c\u5b8c\u624d\u6703\u51fa\u73fe"),"\uff0c\u4f7f\u7528\u4e0a\u5fc5\u9808\u5c0f\u5fc3\u53ef\u80fd\u5f71\u97ff\u6548\u80fd\uff0c",(0,o.kt)("strong",{parentName:"p"},"\u5b98\u65b9\u5efa\u8b70\u76e1\u91cf\u4ee5\u4f7f\u7528 useEffect \u70ba\u4e3b"),"\uff0c\u907f\u514d\u756b\u9762\u88ab blocking\u3002"),(0,o.kt)("p",null,"\u8a73\u7d30\u4f7f\u7528\u7bc4\u4f8b\u53ef\u4ee5\u53c3\u8003\u9019\u7bc7\u5beb\u5f97\u5f88\u597d\u7684\u6587\u7ae0\uff1a"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://medium.com/hannah-lin/react-hook-%E7%AD%86%E8%A8%98-uselayouteffect-30c93301a618"},"https://medium.com/hannah-lin/react-hook-\u7b46\u8a18-uselayouteffect-30c93301a618")),(0,o.kt)("h2",{id:"usedeferredvalue"},"useDeferredValue"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"const deferredValue = useDeferredValue(value);\n")),(0,o.kt)("p",null,"\u901a\u5e38\u7528\u4f86\u63a5\u6536\u4e00\u500b state\uff0c\u56de\u50b3\u4e00\u500b\u8907\u88fd state \u7684\u503c\uff0cdeferredValue\uff0c\u9019\u500b deferredValue \u6703\u88ab\u8a8d\u70ba\u662f non-urgent \u7684 state\uff0c\u6703\u5148\u4fdd\u7559\u539f\u4f86\u7684\u503c\uff0c\u88ab\u5ef6\u9072\u7b49\u5230\u5176\u4ed6 urgent \u7684 state \u66f4\u65b0\u5b8c\u6210\uff0c\u624d\u6703\u56de\u4f86\u66f4\u65b0 deferredValue\u3002"),(0,o.kt)("p",null,"\u7528\u9014\u985e\u4f3c debouncing \u6216 throttling\uff0c\u53ef\u4ee5\u7528\u5728\u9700\u8981\u5ef6\u9072\u4e00\u6bb5\u6642\u9593\u518d\u66f4\u65b0 state \u7684\u5730\u65b9\uff0c\u5dee\u5225\u5728\u65bc\u4e0d\u7528\u6307\u5b9a\u56fa\u5b9a\u7684\u5ef6\u9072\u6642\u9593\uff0cReact \u6703\u5728\u5176\u4ed6\u7dca\u6025\u7684\u5de5\u4f5c(\u4f8b\u5982 user input)\u5b8c\u6210\u4e4b\u5f8c\u81ea\u52d5\u56de\u4f86\u66f4\u65b0 deferredValue\u3002",(0,o.kt)("strong",{parentName:"p"},"\u8ddf useTransition \u4e00\u6a23\u662f React 18 \u7684\u65b0\u529f\u80fd\uff0c\u4ed6\u5011\u7684\u76ee\u7684\u90fd\u662f\u7528\u4f86\u544a\u8a34 React \u54ea\u4e9b\u662f\u975e\u7dca\u6025\u7684 state \u66f4\u65b0\uff0c\u53ef\u4ee5\u88ab urgent state \u4e2d\u65b7\u6216\u662f\u5ef6\u9072\u665a\u4e00\u9ede\u518d\u505a re-render \u6c92\u95dc\u4fc2\u3002")),(0,o.kt)("p",null,(0,o.kt)("strong",{parentName:"p"},"\u4f9d\u8cf4 deferred value \u7684 child component \u8981\u8a18\u5f97\u4f7f\u7528 useMemo"),"\uff0c\u4e0d\u7136\u5bb9\u6613\u9020\u6210\u4e0d\u5fc5\u8981\u7684 re-render\u3002"),(0,o.kt)("p",null,"Example:"),(0,o.kt)("p",null,"defer user input \u7684 search query\uff0cReact \u6703\u5148\u628a user input \u7576\u6210\u7dca\u6025\u72c0\u614b\u5148\u8655\u7406\uff0c\u5b8c\u6210\u4e4b\u5f8c\u624d\u6703\u66f4\u65b0 deferredQuery\uff0c\u4f46\u662f\u4f9d\u8cf4 deferred value \u7684 child component \u8981\u8a18\u5f97\u4f7f\u7528 useMemo\uff0c\u53ea\u6709\u7576 deferred value \u6539\u8b8a\u6642\u624d re-render child component\uff0c\u5426\u5247\u5c31\u6703\u9020\u6210\u4e0d\u5fc5\u8981\u7684 re-render\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"function Typeahead() {\n  const query = useSearchQuery('');\n  const deferredQuery = useDeferredValue(query);\n\n  // Memoizing tells React to only re-render when deferredQuery changes,\n  // not when query changes.\n  const suggestions = useMemo(\n    () => <SearchSuggestions query={deferredQuery} />,\n    [deferredQuery]\n  );\n\n  return (\n    <>\n      <SearchInput query={query} />\n      <Suspense fallback=\"Loading results...\">{suggestions}</Suspense>\n    </>\n  );\n}\n")),(0,o.kt)("h2",{id:"usetransition"},"useTransition"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"const [isPending, startTransition] = useTransition();\n")),(0,o.kt)("p",null,"\u56de\u50b3\u7684\u7b2c\u4e00\u500b\u8b8a\u6578\u4ee3\u8868\u662f\u5426\u6b63\u5728\u66f4\u65b0\u72c0\u614b(transition)\u7684 isPending \u5e03\u6797\u503c\uff0c\u4ee5\u53ca\u4e00\u500b\u958b\u59cb\u66f4\u65b0\u72c0\u614b(transition)\u7684 startTransition function\u3002"),(0,o.kt)("p",null,"startTransition function \u53ef\u4ee5\u8b93\u4f60\u50b3\u5165\u4e00\u500b callback function \u5728\u5176\u4e2d\u57f7\u884c",(0,o.kt)("strong",{parentName:"p"},"\u6bd4\u8f03\u4e0d\u7dca\u6025\u7684\u72c0\u614b\u66f4\u65b0"),"\uff0c\u4e26\u7372\u53d6 isPending \u4ee3\u8868\u662f\u5426\u6b63\u5728\u66f4\u65b0\u72c0\u614b\uff0c\u53ef\u4ee5\u7528 isPending \u4f86\u986f\u793a loading spinner\u3002"),(0,o.kt)("p",null,"Example:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"function App() {\n  const [isPending, startTransition] = useTransition();\n  const [count, setCount] = useState(0);\n\n  function handleClick() {\n    startTransition(() => {\n      setCount((c) => c + 1);\n    });\n  }\n\n  return (\n    <div>\n      {isPending && <Spinner />}\n      <button onClick={handleClick}>{count}</button>\n    </div>\n  );\n}\n")),(0,o.kt)("p",null,"\u9019\u662f React 18 \u7684\u65b0\u529f\u80fd\uff0c\u4f60\u53ef\u4ee5\u5728 startTransition \u5167\u8655\u7406\u975e\u7dca\u6025\u7684 state \u66f4\u65b0\uff0c\u5982\u679c\u6709\u7dca\u6025\u7684 state \u66f4\u65b0\u4f8b\u5982 clicks or key presses\uff0cstartTransition \u5167\u7684 state \u66f4\u65b0\u6703\u88ab\u4e2d\u65b7\uff0c\u7b49\u5230\u7dca\u6025\u7684\u5de5\u4f5c\u8655\u7406\u5b8c\u6703\u5728\u81ea\u52d5\u56de\u4f86\u57f7\u884c\u3002"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Urgent updates"),"\xa0reflect direct interaction, like typing, clicking, pressing, and so on. startTransition \u4e4b\u5916\u7684 state \u66f4\u65b0",(0,o.kt)("strong",{parentName:"li"},"\u9810\u8a2d\u90fd\u662f\u5c6c\u65bc\u7dca\u6025\u7684"),"\u3002"),(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("strong",{parentName:"li"},"Transition updates"),"\xa0transition the UI from one view to another. \u4e00\u4e9b\u4f7f\u7528\u8005\u4e0d\u5bb9\u6613\u5bdf\u89ba\u6216\u662f\u53ef\u9810\u671f\u7684\u756b\u9762\u8f49\u63db\u5ef6\u9072")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"import { startTransition } from 'react';\n\n// Urgent: Show what was typed\nsetInputValue(input);\n\n// Mark any state updates inside as transitions\nstartTransition(() => {\n  // Transition: Show the results\n  setSearchQuery(input);\n});\n")),(0,o.kt)("blockquote",null,(0,o.kt)("p",{parentName:"blockquote"},(0,o.kt)("strong",{parentName:"p"},"useDeferredValue \u8ddf useTransition \u90fd\u662f React 18 \u63d0\u4f9b\u7d66\u6211\u5011\u6a19\u793a\u51fa\u975e\u7dca\u6025\u7684 state updates \u7684\u65b9\u6cd5\uff0c\u5176\u4ed6\u6c92\u6709\u6a19\u793a\u7684\u8a71 React \u5c31\u6703\u9ed8\u8a8d\u7576\u4f5c\u662f\u7dca\u6025\u7684 state updates\u3002"))),(0,o.kt)("h2",{id:"useid"},"useId"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},"const id = useId();\n")),(0,o.kt)("p",null,"\u7522\u751f\u552f\u4e00\u7684 ID"),(0,o.kt)("p",null,"example\uff0c\u76f4\u63a5\u7528\u5728\u9700\u8981 id \u7684\u5143\u7d20\u4e0a\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-jsx"},'function Checkbox() {\n  const id = useId();\n  return (\n    <>\n      <label htmlFor={id}>Do you like React?</label>\n      <input id={id} type="checkbox" name="react" />\n    </>\n  );\n}\n')),(0,o.kt)("h2",{id:"reference"},"Reference"),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://reactjs.org/docs/hooks-reference.html#usecallback"},"Hooks API Reference - React")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://medium.com/hannah-lin/react-hook-%E7%AD%86%E8%A8%98-%E5%BE%9E%E6%9C%80%E5%9F%BA%E6%9C%AC%E7%9A%84-hook-%E9%96%8B%E5%A7%8B-usestate-useeffect-fee6582d8725"},"[React Hook \u7b46\u8a18] \u5f9e\u6700\u57fa\u672c\u7684 Hook \u958b\u59cb useState, useEffect")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://medium.com/@ryardley/react-hooks-not-magic-just-arrays-cd4f1857236e"},"React hooks: not magic, just arrays")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://jason-memo.dev/posts/how-to-use-react-hooks-useCallback-wrongly-for-keeping-same-function-instance/"},"\u5982\u4f55\u932f\u8aa4\u5730\u4f7f\u7528 React hooks useCallback \u4f86\u4fdd\u5b58\u76f8\u540c\u7684 function instance")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://react-hooks-cheatsheet.com/"},"React Hooks Cheatsheets")),(0,o.kt)("p",null,(0,o.kt)("a",{parentName:"p",href:"https://blog.logrocket.com/react-hooks-cheat-sheet-unlock-solutions-to-common-problems-af4caf699e70/"},"React Hooks cheat sheet: Best practices with examples - LogRocket Blog")))}d.isMDXComponent=!0},2240:function(e,t,n){t.Z=n.p+"assets/images/lautaro-andreani-xkBaqlcqeb4-unsplash-5fdd791266e4841813b1eb799ca738dd.jpg"},4945:function(e,t,n){t.Z=n.p+"assets/images/use-effect-4fc55959b33b51bf7003b92c6b0c0e6b.png"},4765:function(e,t,n){t.Z=n.p+"assets/images/use-reducer-a6c21c2106bb5146cf9444c95b38ec3d.jpg"}}]);