"use strict";(self.webpackChunkgcdeng_github_io=self.webpackChunkgcdeng_github_io||[]).push([[1477],{10:function(e){e.exports=JSON.parse('{"blogPosts":[{"id":"a-guidebook-to-optimize-web-vitals","metadata":{"permalink":"/blog/a-guidebook-to-optimize-web-vitals","source":"@site/blog/2021-11-14-a-guidebook-to-optimize-web-vitals.md","title":"[\u524d\u7aef\u512a\u5316\u7cfb\u5217]Web Vitals\u512a\u5316\u65b9\u6cd5\u61f6\u4eba\u5305","description":"\u9019\u7bc7\u6587\u7ae0\u4ecb\u7d39\u4e86 Web Vitals\u3001\u6e2c\u91cf\u65b9\u5f0f\u4ee5\u53ca\u512a\u5316\u65b9\u6cd5\uff0c\u5176\u4e2d\u512a\u5316\u65b9\u6cd5\u6703\u96a8\u8457\u81ea\u5df1\u7684\u5be6\u52d9\u7d93\u9a57\u53ca\u7814\u7a76\u6301\u7e8c\u66f4\u65b0\uff0c\u5e0c\u671b\u53ef\u4ee5\u6210\u70ba\u512a\u5316\u6548\u80fd\u7528\u7684\u61f6\u4eba\u5305\uff0c\u5728\u958b\u767c\u529f\u80fd\u6642\u4f5c\u70ba\u63d0\u9192\u81ea\u5df1\u6703\u5f71\u97ff\u6548\u80fd\u7684\u6ce8\u610f\u4e8b\u9805\uff0c\u8981\u512a\u5316\u7db2\u7ad9\u6642\u4e5f\u65b9\u4fbf\u56de\u4f86\u627e\u5be6\u4f5c\u7684\u65b9\u5411\u3002","date":"2021-11-14T00:00:00.000Z","formattedDate":"November 14, 2021","tags":[{"label":"performance","permalink":"/blog/tags/performance"},{"label":"web vitals","permalink":"/blog/tags/web-vitals"}],"readingTime":14.34,"truncated":true,"authors":[{"name":"Eric Deng","url":"/","imageURL":"/img/ericdeng.jpg","key":"ericdeng"}],"nextItem":{"title":"Prerender.io\u5982\u4f55\u5e6b\u52a9CSR\u7684SEO - \u539f\u7406\u4ecb\u7d39\u8207\u4f7f\u7528\u6559\u5b78","permalink":"/blog/solve-seo-problems-with-prerenderio"}},"content":"\u9019\u7bc7\u6587\u7ae0\u4ecb\u7d39\u4e86 Web Vitals\u3001\u6e2c\u91cf\u65b9\u5f0f\u4ee5\u53ca\u512a\u5316\u65b9\u6cd5\uff0c\u5176\u4e2d\u512a\u5316\u65b9\u6cd5\u6703\u96a8\u8457\u81ea\u5df1\u7684\u5be6\u52d9\u7d93\u9a57\u53ca\u7814\u7a76\u6301\u7e8c\u66f4\u65b0\uff0c\u5e0c\u671b\u53ef\u4ee5\u6210\u70ba\u512a\u5316\u6548\u80fd\u7528\u7684\u61f6\u4eba\u5305\uff0c\u5728\u958b\u767c\u529f\u80fd\u6642\u4f5c\u70ba\u63d0\u9192\u81ea\u5df1\u6703\u5f71\u97ff\u6548\u80fd\u7684\u6ce8\u610f\u4e8b\u9805\uff0c\u8981\u512a\u5316\u7db2\u7ad9\u6642\u4e5f\u65b9\u4fbf\u56de\u4f86\u627e\u5be6\u4f5c\u7684\u65b9\u5411\u3002\\n\\n![kate-stone-matheson-uy5t-CJuIK4-unsplash.jpg](/img/2021-11-14-a-guidebook-to-optimize-web-vitals-assets/kate-stone-matheson-uy5t-CJuIK4-unsplash.jpg)Photo by Kate Stone Matheson on Unsplash\\n\\n\x3c!--truncate--\x3e\\n\\n## \u76ee\u9304\\n\\n- [\u4ec0\u9ebc\u662f Web Vitals?](#\u4ec0\u9ebc\u662f-web-vitals)\\n- [\u5982\u4f55\u6e2c\u91cf\u7db2\u7ad9\u7684 Web Vitals\uff1f](#\u5982\u4f55\u6e2c\u91cf\u7db2\u7ad9\u7684-web-vitals\uff1f)\\n  - [\u5be6\u9a57\u6a21\u64ec\u6e2c\u91cf(In the lab)](#\u5be6\u9a57\u6a21\u64ec\u6e2c\u91cfin-the-lab)\\n  - [\u5be6\u6e2c(In the field)](#\u5be6\u6e2cin-the-field)\\n  - [\u5982\u4f55\u5c07\u6e2c\u91cf\u5de5\u5177\u5c0e\u5165\u7522\u54c1\u958b\u767c\u6d41\u7a0b\u4e2d](#\u5982\u4f55\u5c07\u6e2c\u91cf\u5de5\u5177\u5c0e\u5165\u7522\u54c1\u958b\u767c\u6d41\u7a0b\u4e2d)\\n- [\u8f09\u5165\u901f\u5ea6(Loading Performance)](#\u8f09\u5165\u901f\u5ea6loading-performance)\\n  - [Largest Contentful Paint (LCP)](#largest-contentful-paint-lcp)\\n  - [First Contentful Paint (FCP)](#first-contentful-paint-fcp)\\n  - [Time to First Byte (TTFB)](#time-to-first-byte-ttfb)\\n  - [\u512a\u5316\u65b9\u6cd5](#\u512a\u5316\u65b9\u6cd5)\\n- [\u4e92\u52d5\u53cd\u61c9\u80fd\u529b(Interactivity)](#\u4e92\u52d5\u53cd\u61c9\u80fd\u529binteractivity)\\n  - [First Input Delay (FID)](#first-input-delay-fid)\\n  - [Time to Interactive (TTI)](#time-to-interactive-tti)\\n  - [Total Blocking Time (TBT)](#total-blocking-time-tbt)\\n  - [\u512a\u5316\u65b9\u6cd5](#\u512a\u5316\u65b9\u6cd5-1)\\n- [\u8996\u89ba\u7a69\u5b9a\u6027(Visual Stability)](#\u8996\u89ba\u7a69\u5b9a\u6027visual-stability)\\n  - [Cumulative Layout Shift (CLS)](#cumulative-layout-shift-cls)\\n  - [Speed Index (SI)](#speed-index-si)\\n  - [\u512a\u5316\u65b9\u6cd5](#\u512a\u5316\u65b9\u6cd5-2)\\n- [\u7e3d\u7d50](#\u7e3d\u7d50)\\n- [Reference](#reference)\\n\\n## \u4ec0\u9ebc\u662f Web Vitals?\\n\\n**Web Vitals**\u662f\u7531 Google \u63d0\u51fa\u8861\u91cf\u7db2\u7ad9\u6548\u80fd\u53ca\u4f7f\u7528\u9ad4\u9a57\u7684\u91cf\u5316\u6307\u6a19\uff0c\u53ef\u4ee5\u5e6b\u52a9\u958b\u767c\u8005\u505a\u70ba\u512a\u5316\u7db2\u7ad9\u7684\u53c3\u8003\u3002\u4ee5\u4f7f\u7528\u8005\u9ad4\u9a57\u70ba\u4e2d\u5fc3\u63d0\u51fa\u4e86\u4e09\u500b\u6539\u5584\u9762\u5411\uff0c\u6bcf\u500b\u9762\u5411\u6709\u4ee5\u4e0b\u5404\u81ea\u5c0d\u61c9\u7684\u6307\u6a19\uff1a\\n\\n1. \u8f09\u5165\u901f\u5ea6(Loading Performance)\\n   1. **Largest Contentful Paint (LCP)**\\n   2. First Contentful Paint (FCP)\\n   3. Time to First Byte (TTFB)\\n2. \u4e92\u52d5\u53cd\u61c9\u80fd\u529b(Interactivity)\\n   1. **First Input Delay (FID)**\\n   2. Time to Interactive (TTI)\\n   3. Total Blocking Time (TBT)\\n3. \u8996\u89ba\u7a69\u5b9a\u6027(Visual Stability)\\n   1. **Cumulative Layout Shift (CLS)**\\n   2. Speed Index (SI)\\n\\n\u5176\u4e2d**LCP, FID, CLS**\u662f\u4e09\u500b\u8f03\u70ba\u91cd\u8981\u4ee3\u8868\u5404\u9762\u5411\u7684**\u6838\u5fc3\u6307\u6a19(Core Web Vitals)**\u3002\\n\\n## \u5982\u4f55\u6e2c\u91cf\u7db2\u7ad9\u7684 Web Vitals\uff1f\\n\\n\u6709\u5f88\u591a\u5de5\u5177\u53ef\u4ee5\u5e6b\u6211\u5011\u89e3\u6790\u7db2\u7ad9\u6548\u80fd\uff0c\u4e26\u4e14\u7522\u751f\u51fa\u9019\u4e9b\u91cf\u5316\u6307\u6a19\u5206\u6578\u4ee5\u53ca\u6539\u5584\u5efa\u8b70\u7684\u5206\u6790\u5831\u544a\uff0c\u4f9d\u7167\u74b0\u5883\u5206\u6210\u5169\u7a2e\u6e2c\u91cf\u65b9\u5f0f\uff0c\u4e0d\u540c\u65b9\u5f0f\u6709\u5404\u81ea\u7684\u5de5\u5177\uff1a\\n\\n### \u5be6\u9a57\u6a21\u64ec\u6e2c\u91cf(In the lab)\\n\\n\u6a21\u64ec\u6e2c\u91cf\u5de5\u5177\u6703\u53bb\u6a21\u64ec\u4f7f\u7528\u8005\u7684\u64cd\u4f5c\u884c\u70ba\uff0c\u4f7f\u7528\u6a21\u64ec\u8cc7\u6599\u8a55\u5206\uff0c\u63d0\u4f9b\u53ef\u4ee5\u91cd\u73fe\u7684\u7d50\u679c\uff0c\u9069\u5408\u7528\u5728\u7522\u54c1\u958b\u767c\u968e\u6bb5\u505a\u5206\u6790\u53ca\u9a57\u8b49\u3002\\n\\n- [Lighthouse](https://developers.google.com/web/tools/lighthouse/)\\n- [Lighthouse CI](https://github.com/GoogleChrome/lighthouse-ci)\uff0c\u8a2d\u5b9a\u5728 PR \u6642\u81ea\u52d5\u5316\u8dd1 Lighthouse \u7522\u751f\u6e2c\u91cf\u5831\u544a\u3002\\n- [Chrome DevTools Performance panel](https://developer.chrome.com/docs/devtools/evaluate-performance/)\uff0c\u53ef\u4ee5\u9304\u88fd\u756b\u9762\uff0c\u66f4\u6df1\u5165\u91dd\u5c0d\u67d0\u6bb5 frame \u505a\u512a\u5316\u3002\\n- [WebPageTest](https://webpagetest.org/)\\n\\n### \u5be6\u6e2c(In the field)\\n\\n\u4e5f\u88ab\u7a31\u70ba Real User Monitoring(RUM)\uff0c\u5be6\u6e2c\u5de5\u5177\u6703\u4f7f\u7528\u5f9e\u771f\u5be6\u4f7f\u7528\u8005\u8490\u96c6\u4f86\u7684\u533f\u540d\u4f7f\u7528\u884c\u70ba\u8cc7\u6599\u8a55\u5206\uff0c\u53ef\u4ee5\u77e5\u9053\u4f7f\u7528\u8005\u771f\u5be6\u9ad4\u9a57\u72c0\u6cc1\uff0c\u4f46\u5206\u6578\u4e5f\u6703\u53d7\u4f7f\u7528\u8005\u7576\u4e0b\u88dd\u7f6e\u5f71\u97ff\uff0c\u4f8b\u5982\u4f7f\u7528\u8005\u7684\u7db2\u8def\u72c0\u6cc1\u4e0d\u4f73\uff0c\u6216\u662f\u6bcf\u500b\u4f7f\u7528\u8005\u6703\u986f\u793a\u4e0d\u540c\u7684\u5ba2\u88fd\u5316\u8cc7\u6599\uff0c\u90fd\u6703\u5f71\u97ff\u6e2c\u91cf\u8a55\u5206\uff0c\u56e0\u6b64\u53ef\u80fd\u6703\u8ddf\u6a21\u64ec\u6e2c\u91cf\u7d50\u679c\u6709\u5dee\u8ddd\u3002\\n\\n- [PageSpeed Insights](https://developers.google.com/speed/pagespeed/insights/?hl=zh-TW)\\n- [Search Console](https://search.google.com/search-console/about)\\n- [Chrome User Experience Report](https://developers.google.com/web/tools/chrome-user-experience-report) API\\n- [Firebase Performance Monitoring](https://firebase.google.com/docs/perf-mon)\\n- [Web Vitals Chrome Extension](https://github.com/GoogleChrome/web-vitals-extension)\\n\\n\u5982\u679c\u9700\u8981\u66f4\u8a73\u7d30\u7684\u4f7f\u7528\u884c\u70ba\u8cc7\u6599\u53ef\u4ee5\u4f7f\u7528 [web-vitals](https://github.com/GoogleChrome/web-vitals) javascript library\uff0c\u5728\u81ea\u5df1\u7684\u5c08\u6848\u4e2d\u5be6\u4f5c Real User Monitoring\uff0c\u4f86\u89c0\u5bdf\u4f7f\u7528\u8005\u5be6\u969b\u64cd\u4f5c\u7d30\u7bc0\uff0c\u9a57\u8b49\u5728\u7522\u54c1\u74b0\u5883\u4e2d\u6548\u80fd\u554f\u984c\u662f\u5426\u6709\u6539\u5584\u3002\\n\\n> \u9019\u7bc7\u6587\u7ae0\u4e0d\u6703\u592a\u8a73\u7d30\u89e3\u91cb\u6bcf\u500b\u6e2c\u91cf\u5de5\u5177\u8a08\u7b97\u6307\u6a19\u5206\u6578\u7684\u516c\u5f0f\uff0c\u5982\u679c\u6709\u8208\u8da3\u53ef\u4ee5\u53c3\u8003\u5404\u6307\u6a19\u7684\u6a19\u984c\u8d85\u9023\u7d50\u3002\\n\\n### \u5982\u4f55\u5c07\u6e2c\u91cf\u5de5\u5177\u5c0e\u5165\u7522\u54c1\u958b\u767c\u6d41\u7a0b\u4e2d\\n\\n\u53c3\u8003 [https://web.dev/i18n/en/vitals-tools/](https://web.dev/i18n/en/vitals-tools/) \u63d0\u5230\u7684\u6d41\u7a0b\\n\\n1. \u4f7f\u7528 Search Console \u7522\u751f\u6bcf\u500b\u9801\u9762\u7684\u6838\u5fc3\u6307\u6a19\u6e2c\u91cf\u5831\u544a\uff0c\u627e\u5230\u54ea\u500b\u9801\u9762\u9700\u8981\u7279\u5225\u9032\u884c\u512a\u5316\u3002\\n2. \u627e\u5230\u9700\u8981\u512a\u5316\u7684\u9801\u9762 URL\uff0c\u4f7f\u7528 PageSpeed Insights \u6216\u5176\u4ed6 RUM \u5de5\u5177\u5f97\u5230\u5305\u542b lab \u53ca field \u7684\u8a73\u7d30\u6307\u6a19\u6e2c\u91cf\u7d50\u679c\u8ddf\u512a\u5316\u5efa\u8b70\u3002\\n3. \u5728\u672c\u5730\u958b\u767c\u74b0\u5883\u914d\u5408\u512a\u5316\u5efa\u8b70\u9032\u884c\u4fee\u6b63\uff0c\u914d\u5408 Lighthouse \u8ddf Chrome DevTools \u505a\u9a57\u8b49\u3002\\n4. \u4f7f\u7528 Lighthouse CI \u5728 PR \u81ea\u52d5\u5316\u6e2c\u91cf\uff0c\u901a\u904e\u8a2d\u5b9a\u7684\u6307\u6a19\u5206\u6578\u9580\u6abb\u5f8c\u624d merge \u9032\u4e3b\u7dda\u7136\u5f8c deploy production\u3002\\n5. \u56de\u5230\u6b65\u9a5f 1 \u8ddf 2\uff0c\u9a57\u8b49\u771f\u5be6\u7522\u54c1\u74b0\u5883\u4e2d\u7684\u6307\u6a19\u5206\u6578\u662f\u5426\u771f\u7684\u6709\u512a\u5316\u6210\u529f\u3002\\n\\n## \u8f09\u5165\u901f\u5ea6(Loading Performance)\\n\\n\u76ee\u6a19\u662f\u8981\u8a55\u4f30\u7db2\u9801\u53ef\u4ee5\u591a\u5feb\u8f09\u5165\u5b8c\u6210\u4e26\u4e14\u6e32\u67d3\u597d\u756b\u9762\u3002\\n\\n### [Largest Contentful Paint (LCP)](https://web.dev/lcp/)\\n\\n`core web vital`\\n\\n\u5f9e\u7db2\u9801\u958b\u59cb\u8f09\u5165\u5230\u6700\u5927\u9762\u7a4d\u7684\u5143\u7d20\u6e32\u67d3(render)\u5230\u756b\u9762\u4e0a\u6240\u82b1\u7684\u6642\u9593\u3002\\n\\n![LCP.svg](/img/2021-11-14-a-guidebook-to-optimize-web-vitals-assets/LCP.svg)\\n\\n### [First Contentful Paint (FCP)](https://web.dev/fcp/)\\n\\n\u5f9e\u7db2\u9801\u958b\u59cb\u8f09\u5165\u5230\u4efb\u4f55\u4e00\u500b\u5143\u7d20\u6e32\u67d3\u5230\u756b\u9762\u4e0a\u6240\u82b1\u7684\u6642\u9593\u3002\\n\\n### [Time to First Byte (TTFB)](https://web.dev/ttfb/)\\n\\n\u700f\u89bd\u5668\u5c0d\u4f3a\u670d\u5668\u767c\u51fa\u8acb\u6c42(ex: http api request)\u5f8c\u5230\u6536\u5230\u56de\u61c9\u8cc7\u6599(\u7b2c\u4e00\u500b byte)\u6240\u82b1\u7684\u6642\u9593\u3002\\n\\n### \u512a\u5316\u65b9\u6cd5\\n\\n- \u52a0\u901f\u53d6\u5f97\u8cc7\u6e90\u7684\u6642\u9593\\n  - Cache\\n    - CDN caching\\n      - \u4f8b\u5982\u4f7f\u7528 SSG \u5c07\u975c\u614b HTML cache \u5728 CDN\\n    - [HTTP caching](https://developer.mozilla.org/en-US/docs/Web/HTTP/Caching)\\n    - service worker [Workbox Precaching](https://developers.google.com/web/tools/workbox/modules/workbox-precaching)\\n    - server caching\uff0c\u5c07\u975c\u614b\u6a94\u6848 cache \u5728 server-side disk\\n      - reverse proxies (Varnish, nginx)\\n      - cloud provider (Firebase, AWS, Azure)\\n      - CDN edge servers\\n  - \u5728\u771f\u6b63\u9700\u8981\u57f7\u884c\u4e4b\u524d\u9810\u5148\u4e0b\u8f09\u597d\u8cc7\u6e90\uff0c\u8981\u7528\u6642\u53ef\u4ee5\u76f4\u63a5\u958b\u59cb\u57f7\u884c\uff0c\u4f7f\u7528 Resource Hints `preload`, `prefetch`\uff0c\u4f8b\u5982 prefetch \u5206\u9801\u7684\u4e0b\u4e00\u9801\u6703\u7528\u5230\u7684\u8cc7\u6e90\\n  - \u9810\u5148\u8207\u8cc7\u6e90\u670d\u52d9\u5668\u5efa\u7acb\u9023\u7dda\uff0c\u8981\u7528\u6642\u53ef\u4ee5\u66f4\u5feb\u4e0b\u8f09\u5230\u8cc7\u6e90\uff0c\u4f7f\u7528 Resource Hints `dns-prefetch`, `preconnect`\uff0c\u4f8b\u5982[\u65e9\u4e00\u9ede\u8207 third-party \u5efa\u7acb\u9023\u7dda](https://web.dev/optimize-lcp/#establish-third-party-connections-early)\\n  - \u6e1b\u5c11 HTTP request \u6578\u91cf\\n  - \u52a0\u901f\u5f8c\u7aef\u4f3a\u670d\u5668\u56de\u61c9\u901f\u5ea6\uff0c\u4f8b\u5982\u512a\u5316 DB query\\n- \u6e1b\u5c11\u8cc7\u6e90\u9ad4\u7a4d\uff0c\u66f4\u5feb\u53d6\u5f97\u53ca\u57f7\u884c\u8cc7\u6e90\u5167\u5bb9\\n  - \u6e1b\u5c11 server remote API response data \u9ad4\u7a4d\uff0c\u4f8b\u5982\u4e0d\u62ff\u591a\u9918\u7528\u4e0d\u5230\u7684\u8cc7\u6599\\n  - dynamic import\uff0c\u5728\u9700\u8981\u7528\u5230\u6642\u624d\u8f09\u5165 module\\n  - route-based code splitting\uff0c\u7279\u5b9a\u9801\u9762\u53ea\u8f09\u5165\u76f8\u95dc\u7684\u8173\u672c\u8207\u6a23\u5f0f\u6a94\\n  - tree shaking\\n  - partial import\uff0c\u53ea\u5f9e module \u4e2d\u8f09\u5165\u9700\u8981\u7528\u7684 function\uff0c\u4e0d\u662f\u8f09\u5165\u6574\u500b module\\n  - \u6539\u5584 webpack chunk \u8a2d\u5b9a\uff0c\u6e1b\u5c11 bundle size\\n  - \u6539\u5584\u5957\u4ef6\u4f7f\u7528\u65b9\u5f0f\uff0c\u76e1\u91cf\u6311\u9078\u9ad4\u7a4d\u5c0f\u7684\u5957\u4ef6\uff0c\u79fb\u9664\u591a\u9918\u5f15\u7528\u7684\u5957\u4ef6\\n  - \u5206\u6790 bundle size \u5de5\u5177\uff1a\\n    - [Webpack Bundle Analyzer](https://www.npmjs.com/package/webpack-bundle-analyzer)\\n    - [source-map-explorer](https://www.npmjs.com/package/source-map-explorer)\\n    - [Import Cost VSCode Extension](https://marketplace.visualstudio.com/items?itemName=wix.vscode-import-cost)\\n  - \u7cbe\u7c21\u7a0b\u5f0f\u78bc: \u522a\u9664\u7528\u4e0d\u5230\u7684\u7a0b\u5f0f\u78bc\u3001minify js & css\\n  - [\u6e1b\u5c11 polyfills \u9ad4\u7a4d](https://web.dev/serve-modern-code-to-modern-browsers/)\\n    - \u4f7f\u7528@babel/preset-env \u53ea\u91dd\u5c0d\u8981\u652f\u63f4\u7684\u700f\u89bd\u5668\u4f7f\u7528 polyfill\\n- \u700f\u89bd\u5668\u5728\u4e0b\u8f09\u6216\u57f7\u884c\u8cc7\u6e90(js, css)\u6642\u6703\u66ab\u505c\u89e3\u6790 HTML DOM \u53ca\u5ef6\u9072\u6e32\u67d3\u756b\u9762(**render-blocking**)\uff0c\u56e0\u6b64\u6e1b\u5c11 render-blocking \u6642\u9593\u4e5f\u662f\u4e00\u500b\u65b9\u6cd5\\n  - CSR \u56e0\u70ba\u6709\u5f88\u591a JS \u9700\u8981\u5728\u700f\u89bd\u5668\u57f7\u884c\uff0c\u5c0d LCP \u5f71\u97ff\u8f03\u5927\uff0c\u53ef\u4ee5\u8003\u616e\u6539\u6210\u4f7f\u7528 server-side rendering \u6216\u662f\u5176\u4ed6 pre-rendering \u65b9\u5f0f\uff0c\u4f46\u53ef\u80fd\u4e5f\u6703\u5c0d TTFB \u53ca TTI \u9020\u6210\u8ca0\u9762\u5f71\u97ff\uff0c\u9700\u8981\u8a55\u4f30\u662f\u5426\u9069\u5408\u81ea\u5df1\u7684\u5c08\u6848\\n  - script tag \u4f7f\u7528 async \u5c6c\u6027\uff0c\u8b93 js \u53ef\u4ee5\u5728\u80cc\u666f\u4e0b\u8f09\u4e0d\u963b\u64cb\u6e32\u67d3\u756b\u9762\\n  - script tag \u4f7f\u7528 defer \u5c6c\u6027\uff0c\u8b93\u975e\u95dc\u9375\u7684 js \u53ef\u4ee5\u5ef6\u9072\u57f7\u884c\u4e0d\u963b\u64cb\u6e32\u67d3\u756b\u9762\\n  - [\u5ef6\u9072\u8f09\u5165\u975e\u95dc\u9375\u7684 CSS](https://web.dev/optimize-lcp/#defer-non-critical-css)\\n    - [loadCSS](https://github.com/filamentgroup/loadCSS)\\n  - \u52a0\u901f\u53d6\u5f97\u8cc7\u6e90\u7684\u6642\u9593\u4ee5\u53ca\u6e1b\u5c11\u8cc7\u6e90\u9ad4\u7a4d\u4e5f\u53ef\u4ee5\u5e6b\u52a9\u6e1b\u5c11 render-blocking \u6642\u9593\\n- \u512a\u5316\u5716\u7247\\n  - [\u97ff\u61c9\u5f0f\u5716\u6a94](https://web.dev/serve-responsive-images/)\uff0c\u6839\u64da\u88dd\u7f6e\u5c3a\u5bf8\u62ff\u53d6\u5c0d\u61c9\u8db3\u5920\u7684\u5716\u7247\u5c3a\u5bf8\\n  - \u4f7f\u7528 WebP\u3001AVIF \u683c\u5f0f\\n  - Image Server ([Cloudinary](https://cloudinary.com/))\\n  - lazy loading\\n  - \u58d3\u7e2e\u5716\u7247([Imagemin](https://web.dev/use-imagemin-to-compress-images/))\\n\\n## \u4e92\u52d5\u53cd\u61c9\u80fd\u529b(Interactivity)\\n\\n\u76ee\u6a19\u662f\u8981\u8a55\u4f30\u7db2\u9801\u591a\u5feb\u53ef\u4ee5\u56de\u61c9\u4f7f\u7528\u8005\u7684\u4e92\u52d5\u884c\u70ba\uff0c\u4f8b\u5982\u6309\u4e0b\u6309\u9215\u4e4b\u5f8c\u591a\u4e45\u6703\u6709\u53cd\u61c9\u3002\\n\\n### [First Input Delay (FID)](https://web.dev/fid/)\\n\\n`core web vital`\\n\\n\u4f7f\u7528\u8005\u9996\u6b21\u8207\u7db2\u7ad9\u4e92\u52d5\uff0c\u76f4\u5230\u700f\u89bd\u5668\u56de\u61c9\u4e92\u52d5\u4e8b\u4ef6\u7684\u6642\u9593\u5dee\u3002\u9019\u500b\u6307\u6a19\u6703\u56e0\u70ba\u771f\u5be6\u4f7f\u7528\u8005\u9996\u6b21\u4e92\u52d5\u884c\u70ba\u800c\u6709\u6240\u4e0d\u540c\uff0c\u6240\u4ee5\u53ea\u80fd\u5be6\u6e2c(field)\u7121\u6cd5\u6a21\u64ec\u6e2c\u91cf(lab)\u3002\u5728\u958b\u767c\u968e\u6bb5\u56e0\u70ba\u6c92\u6709\u8fa6\u6cd5\u5be6\u6e2c\uff0c\u53ef\u4ee5\u85c9\u7531\u512a\u5316\u6709\u95dc\u806f\u6027\u7684 TBT \u6307\u6a19\u4f86\u5354\u52a9\u6539\u5584 FID\u3002\\n\\n![FID.svg](/img/2021-11-14-a-guidebook-to-optimize-web-vitals-assets/FID.svg)\\n\\n### [Time to Interactive (TTI)](https://web.dev/tti/)\\n\\n\u5f9e\u7db2\u9801\u958b\u59cb\u8f09\u5165\u5230\u9577\u6642\u9593\u4efb\u52d9(long tasks)\u90fd\u5df2\u7d93\u7d50\u675f\u800c\u4e14\u53ef\u4ee5\u56de\u61c9\u4f7f\u7528\u8005\u4e92\u52d5\u6240\u82b1\u7684\u6642\u9593\u3002\\n\\n\u9577\u6642\u9593\u4efb\u52d9(long tasks)\u662f\u6307\u8d85\u904e 50ms \u7684\u4efb\u52d9\uff0c\u53ef\u80fd\u662f\u89e3\u6790 HTML \u5efa\u7acb DOM Tree\u3001\u89e3\u6790 CSS \u5957\u7528\u6a23\u5f0f\u3001\u57f7\u884c JS \u7b49\u3002\\n\\n### [Total Blocking Time (TBT)](https://web.dev/tbt/)\\n\\n\u4e3b\u57f7\u884c\u7dd2\u88ab\u9577\u6642\u9593\u4efb\u52d9(long tasks)\u963b\u585e\u7684\u7e3d\u6642\u9593\uff0c\u963b\u585e\u7684\u6642\u9593\u662f\u6307\u9577\u6642\u9593\u4efb\u52d9\u4e2d\u8d85\u904e 50ms \u7684\u6642\u9593(long task time - 50ms)\uff0c\u5c07\u6bcf\u500b long task \u963b\u585e\u6642\u9593\u505a\u7e3d\u548c\u5c31\u662f TBT\uff0c\u9019\u6bb5\u6642\u9593\u88ab\u8996\u70ba\u7121\u6cd5\u56de\u61c9\u4f7f\u7528\u8005\u4e92\u52d5\u7684\u6642\u9593\u3002\\n\\n### \u512a\u5316\u65b9\u6cd5\\n\\n\u5ef6\u9072\u4e92\u52d5\u56de\u61c9\u6642\u9593\u7684\u4e3b\u8981\u539f\u56e0\u662f\u7e41\u91cd\u7684 js \u57f7\u884c\u4efb\u52d9\u4f54\u7528\u8457\u4e3b\u57f7\u884c\u7dd2\uff0c\u8b93\u700f\u89bd\u5668\u7121\u6cd5\u8655\u7406\u4f7f\u7528\u8005\u7684\u4e92\u52d5\u884c\u70ba\u4e8b\u4ef6\uff0c\u56e0\u6b64**[\u6e1b\u5c11\u4e3b\u57f7\u884c\u7dd2\u8ca0\u64d4](https://web.dev/mainthread-work-breakdown/)\u53ef\u4ee5\u6709\u6548\u6539\u5584**\u3002\\n\\n- \u6e1b\u5c11 JS \u57f7\u884c\u6642\u9593\uff0c\u53ef\u4ee5\u53c3\u8003\u4e0a\u8ff0\u5df2\u7d93\u63d0\u5230\u7684\u65b9\u6cd5\\n- \u62c6\u5206 long task\uff0ccode-split js bundle \u62c6\u5206\u6210\u591a\u500b\u53ef\u4ee5\u975e\u540c\u6b65\u57f7\u884c\u7684\u5c0f\u6a94\u6848(chunk)\uff0c\u914d\u5408 async, defer \u5c6c\u6027\\n- \u5ef6\u9072\u57f7\u884c\u4e0d\u91cd\u8981\u7684\u8cc7\u6e90\uff0c\u4f8b\u5982\u4f7f\u7528 script tag defer \u5c6c\u6027\\n- \u4f7f\u7528[web workers](https://developer.mozilla.org/en-US/docs/Web/API/Worker)\uff0c\u8b93 js \u5728\u53e6\u4e00\u500b\u80cc\u666f\u57f7\u884c\u7dd2\u57f7\u884c\uff0c\u5957\u4ef6: [Comlink](https://github.com/GoogleChromeLabs/comlink)\\n- \u5148\u6e96\u5099\u597d\u4e92\u52d5\u884c\u70ba\u9700\u8981\u7684\u8cc7\u6599\uff0c\u4f8b\u5982\u76e1\u91cf\u907f\u514d\u5728\u4e92\u52d5\u6642\u624d\u53bb\u6253 api fetch \u8cc7\u6599\\n- Debounce\\n- Throttle\\n\\n## \u8996\u89ba\u7a69\u5b9a\u6027(Visual Stability)\\n\\n\u76ee\u6a19\u662f\u8981\u8a55\u4f30\u7db2\u9801\u4e0a\u7684\u5143\u7d20\u662f\u5426\u767c\u751f\u672a\u9810\u671f\u7684\u4f4d\u7f6e\u6539\u8b8a\u800c\u5f71\u97ff\u4f7f\u7528\u8005\u7684\u4e92\u52d5\u884c\u70ba\uff0c\u4f8b\u5982\u8981\u6309\u4e0b\u6309\u9215\u6642\u7a81\u7136\u8df3\u51fa\u5ee3\u544a\u3002\u4ee5\u53ca\u8a55\u4f30\u8f49\u5834\u6216\u52d5\u756b\u7684\u6e32\u67d3\u6709\u7dad\u6301\u4e00\u5b9a\u7684 frame rate\uff0c\u756b\u9762\u4e0a\u6bcf\u500b\u72c0\u614b\u7684\u6539\u8b8a\u662f\u6d41\u66a2\u7684\u3002\\n\\n### [Cumulative Layout Shift (CLS)](https://web.dev/cls/)\\n\\n`core web vital`\\n\\n\u7d2f\u8a08\u4f48\u5c40\u504f\u79fb\uff0c\u756b\u9762\u767c\u751f\u672a\u9810\u671f\u6392\u7248\u79fb\u52d5\u7684\u7a0b\u5ea6\uff0c\u4f8b\u5982\u7a81\u7136\u6ed1\u51fa\u4f86\u7684\u5ee3\u544a\u5c31\u6703\u6709\u5f88\u5927\u7684\u5f71\u97ff\uff0c\u8f03\u4f4e\u7684 CLS \u5206\u6578\u53ef\u4ee5\u6709\u52a9\u65bc\u8996\u89ba\u9ad4\u9a57\u4e0a\u7684\u8212\u9069\u5ea6\u3002\\n\\n![CLS.svg](/img/2021-11-14-a-guidebook-to-optimize-web-vitals-assets/CLS.svg)\\n\\n### [Speed Index (SI)](https://web.dev/speed-index/)\\n\\n\u7db2\u9801\u8f09\u5165\u671f\u9593\u5167\u5bb9\u80fd\u591a\u5feb\u88ab\u4f7f\u7528\u8005\u770b\u5230\uff0c\u7528\u4f86\u8861\u91cf\u8996\u89ba\u7684\u6d41\u66a2\u6027\u3002\u6e2c\u91cf\u5de5\u5177\u6703\u5728\u7db2\u9801\u8f09\u5165\u671f\u9593\u9304\u88fd\u5f71\u7247\uff0c\u8a08\u7b97\u6bcf\u500b frame \u5728\u8996\u89ba\u4e0a\u7684\u5167\u5bb9\u5b8c\u6210\u9032\u5ea6\u3002\\n\\n### \u512a\u5316\u65b9\u6cd5\\n\\n- img, video, iframe \u8a2d\u5b9a width, height \u5c6c\u6027\uff0c\u6216\u662f[\u5bec\u9ad8\u6bd4](https://web.dev/optimize-cls/#images-without-dimensions)\\n- \u907f\u514d\u5728\u73fe\u6709\u5167\u5bb9\u4e0a\u65b9\u63d2\u5165\u52d5\u614b\u8f09\u5165\u7684\u5167\u5bb9\uff0c\u5c0e\u81f4\u63a8\u64e0\u5230\u5176\u4ed6\u5143\u4ef6\u7684\u6392\u7248\uff0c\u53ef\u4ee5\u5148\u9810\u7559\u597d\u9700\u8981\u7684\u7a7a\u9593([CSS aspect ratio boxes](https://css-tricks.com/aspect-ratio-boxes/))\uff0c\u6216\u662f\u5c07\u53d7\u5f71\u97ff\u7684\u6392\u7248\u79fb\u5230\u53ef\u8996\u7bc4\u570d\u4e4b\u5916\\n- \u907f\u514d\u7a81\u7136\u79fb\u52d5\u6216\u84cb\u677f\u7684\u5167\u5bb9\uff0c\u4f8b\u5982\u5ee3\u544a\u7a81\u7136\u8df3\u51fa\u4f86\\n- [\u9632\u6b62 FOIT (flash of invisible text) \u6587\u5b57\u7a81\u7136\u51fa\u73fe\u3001FOUT (flash of unstyled text) \u5b57\u9ad4\u7a81\u7136\u6539\u8b8a](https://web.dev/optimize-cls/#web-fonts-causing-foutfoit)\\n  - \u4f7f\u7528`<link rel=preload>` \u63d0\u65e9\u4e0b\u8f09\u5b57\u9ad4\uff0c@font-face \u52a0\u4e0a `font-display: optional` [[\u53c3\u8003](https://web.dev/preload-optional-fonts/)]\\n  - google fonts url \u52a0\u4e0a`&display=swap`\\n- [\u76e1\u91cf\u4f7f\u7528`transform`\u505a\u52d5\u756b](https://web.dev/optimize-cls/#animations)\uff0c\u700f\u89bd\u5668\u904b\u7b97\u6210\u672c\u8f03\u4f4e\\n\\n\u5728\u5be6\u4f5c\u8996\u89ba\u7a69\u5b9a\u6027\u7684\u6539\u5584\u901a\u5e38\u6703\u9700\u8981\u4f7f\u7528\u5230[Chrome DevTools Performance panel](https://developer.chrome.com/docs/devtools/evaluate-performance/)\uff0c\u53bb\u5206\u6790\u6bcf\u500b frame \u7d30\u90e8\u7684\u72c0\u6cc1\u4f86\u627e\u5230 root cause\uff0c[\u53c3\u8003\u8a73\u7d30\u5982\u4f55 debug](https://web.dev/debug-layout-shifts/)\u3002\\n\\n## \u7e3d\u7d50\\n\\n\u9019\u7bc7\u6587\u7ae0\u5c07\u6703\u8ddf\u8457 Google \u5728 Web Vitals \u4e0a\u7684\u65b0\u63d0\u6848\u4ee5\u53ca\u7b46\u8005\u81ea\u8eab\u7684\u7814\u7a76\u6301\u7e8c\u66f4\u65b0\uff0c\u5982\u679c\u6709\u4efb\u4f55\u554f\u984c\u6216\u5efa\u8b70\u90fd\u6b61\u8fce\u8207\u6211\u806f\u7d61\u3002\\n\\n## Reference\\n\\n[Web Vitals](https://web.dev/learn-web-vitals/)\\n\\n[I/O Extended 2021 \u7cfb\u5217: Chrome DevTools & Web Vitals](https://www.youtube.com/watch?v=_o0Q-fUjeiA&t=27s&ab_channel=GoogleDevelopersTaiwan-Google%E9%96%8B%E7%99%BC%E4%BA%BA%E5%93%A1%E5%8F%B0%E7%81%A3%E9%A0%BB%E9%81%93)\\n\\n[\u6253\u9020\u9ad8\u901f\u7db2\u7ad9\uff0c\u5f9e\u7db2\u7ad9\u6307\u6a19\u958b\u59cb\uff01(Speed Up Your App with Web Vitals) MOPCON 2021 \u9010\u5b57\u7a3f | Summer\u3002\u6851\u83ab\u3002\u590f\u5929](https://cythilya.github.io/2021/10/24/mopcon-speed-up-your-app-with-web-vitals/?fbclid=IwAR3GXoUWjr9GXFaYZBjR4NMfiiucoGAIOtjSG8sRg02BFg86qlFF55u6fq4)"},{"id":"solve-seo-problems-with-prerenderio","metadata":{"permalink":"/blog/solve-seo-problems-with-prerenderio","source":"@site/blog/2021-11-07-solve-seo-problems-with-prerenderio.md","title":"Prerender.io\u5982\u4f55\u5e6b\u52a9CSR\u7684SEO - \u539f\u7406\u4ecb\u7d39\u8207\u4f7f\u7528\u6559\u5b78","description":"Client-Side Rendering (CSR) Single Page Application (SPA) \u6700\u5e38\u9047\u5230\u7684\u554f\u984c\u5c31\u662f SEO\uff0c\u89e3\u6c7a\u9019\u500b\u554f\u984c\u7684\u65b9\u6cd5\u6709\u5f88\u591a\u7a2e\uff0c\u5176\u4e2d\u4e00\u7a2e\u7372\u5f97 Google \u63a8\u85a6\u7684\u65b9\u6cd5\u662f**Prerender.io**\uff0c\u9019\u7bc7\u6587\u7ae0\u5c07\u6703\u4ecb\u7d39\u5b83\u7684\u904b\u4f5c\u539f\u7406\u4ee5\u53ca\u5982\u4f55\u958b\u59cb\u5c0e\u5165\u4f7f\u7528\u3002","date":"2021-11-07T00:00:00.000Z","formattedDate":"November 7, 2021","tags":[{"label":"seo","permalink":"/blog/tags/seo"},{"label":"prerender","permalink":"/blog/tags/prerender"},{"label":"csr","permalink":"/blog/tags/csr"},{"label":"ssr","permalink":"/blog/tags/ssr"},{"label":"ssg","permalink":"/blog/tags/ssg"},{"label":"prerender.io","permalink":"/blog/tags/prerender-io"},{"label":"frontend","permalink":"/blog/tags/frontend"},{"label":"web","permalink":"/blog/tags/web"}],"readingTime":8.92,"truncated":true,"authors":[{"name":"Eric Deng","url":"/","imageURL":"/img/ericdeng.jpg","key":"ericdeng"}],"prevItem":{"title":"[\u524d\u7aef\u512a\u5316\u7cfb\u5217]Web Vitals\u512a\u5316\u65b9\u6cd5\u61f6\u4eba\u5305","permalink":"/blog/a-guidebook-to-optimize-web-vitals"},"nextItem":{"title":"[\u524d\u7aef\u512a\u5316\u7cfb\u5217] \u4f7f\u7528async, defer\u5c6c\u6027\u52a0\u901f\u7db2\u9801\u8f09\u5165\u6642\u9593","permalink":"/blog/script-tag-async-defer-attributes"}},"content":"Client-Side Rendering (CSR) Single Page Application (SPA) \u6700\u5e38\u9047\u5230\u7684\u554f\u984c\u5c31\u662f SEO\uff0c\u89e3\u6c7a\u9019\u500b\u554f\u984c\u7684\u65b9\u6cd5\u6709\u5f88\u591a\u7a2e\uff0c\u5176\u4e2d\u4e00\u7a2e\u7372\u5f97 Google \u63a8\u85a6\u7684\u65b9\u6cd5\u662f**Prerender.io**\uff0c\u9019\u7bc7\u6587\u7ae0\u5c07\u6703\u4ecb\u7d39\u5b83\u7684\u904b\u4f5c\u539f\u7406\u4ee5\u53ca\u5982\u4f55\u958b\u59cb\u5c0e\u5165\u4f7f\u7528\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u958b\u59cb\u4e4b\u524d\uff0c\u5148\u804a\u804a CSR \u7684 SEO \u554f\u984c\\n\\nClient-Side Rendering (CSR) \u662f\u904e\u53bb\u5e7e\u5e74\u6d41\u884c\u7684\u524d\u7aef\u958b\u767c\u65b9\u5f0f\uff0c\u700f\u89bd\u5668\u6703\u6536\u5230\u4e00\u500b body \u88e1\u53ea\u6709\u6839\u5143\u4ef6\u4ee5\u53ca\u5f15\u5165\u6253\u5305\u597d\u7684 JS \u7684 HTML\uff0c\u89e3\u6790 HTML \u5f8c\u958b\u59cb\u4e0b\u8f09\u53ca\u57f7\u884c JS \u5c07\u5167\u5bb9\u6e32\u67d3\u9032\u6839\u5143\u4ef6\u4e2d\uff0c\u5927\u90e8\u5206\u7684\u904b\u7b97\u8cc7\u6e90\u6703\u96c6\u4e2d\u5728\u700f\u89bd\u5668\u4e0a\uff0c\u800c\u6700\u5927\u7684\u554f\u984c\u662f\u641c\u5c0b\u5f15\u64ce\u505a SEO \u7684\u722c\u87f2\u4e26\u4e0d\u6703\u7b49\u5f85 AJAX \u8ddf JS \u6e32\u67d3\u597d\u5167\u5bb9\u624d\u958b\u59cb\u8490\u96c6\u8cc7\u6599\uff0c\u4ed6\u53ea\u6703\u770b\u5230 HTML \u4e2d\u4e00\u500b\u7a7a\u7a7a\u7684\u6839\u5143\u4ef6\uff0c\u6c92\u6709\u8cc7\u6599\u53ef\u4ee5\u7d66\u4ed6\u505a Index\uff0c\u96d6\u7136 Google Search \u5f8c\u4f86\u4e5f\u6709[\u65b0\u7684\u722c\u87f2\u6a5f\u5236](https://developers.google.com/search/docs/advanced/javascript/javascript-seo-basics)\u89e3\u6c7a\u9019\u500b\u554f\u984c\uff0c\u4f46\u722c\u87f2\u4e5f\u6709[\u8cc7\u6e90\u9810\u7b97](https://prerender.io/crawl-budget-seo/)(Crawl Budget)\u9650\u5236\uff0cCSR \u9700\u8981\u82b1\u8cbb\u5927\u91cf\u722c\u87f2\u904b\u7b97\u8cc7\u6e90\uff0c\u5c0e\u81f4 Index \u6703\u9700\u8981\u5f88\u591a\u6642\u9593\u751a\u81f3\u6709\u4e9b\u9801\u9762\u4e5f\u7121\u6cd5\u505a Index\uff0c\u53e6\u5916\u4e00\u500b\u554f\u984c\u662f\u793e\u4ea4\u5a92\u9ad4\u4f8b\u5982 FB, Twitter \u9700\u8981\u7684[open graph meta tag](https://ahrefs.com/blog/open-graph-meta-tags/)\u5982\u679c\u662f CSR \u52d5\u614b\u7522\u751f\u7684\u8a71\u4e00\u958b\u59cb\u4e5f\u6703\u62ff\u4e0d\u5230\uff0c\u65bc\u662f\u958b\u59cb\u6709\u4eba\u63d0\u51fa\u5f88\u591a\u4e8b\u5148\u6e32\u67d3(pre-rendering)\u597d\u975c\u614b HTML \u518d\u9001\u7d66 client \u7684\u89e3\u6cd5\uff0c\u4ee5\u4e0b\u5217\u8209\u5e7e\u7a2e\uff1a\\n\\n1. Pre-build \u6216\u7a31 Static Site Generator (SSG)\uff0c\u662f\u5728 build-time \u6e96\u5099\u597d\u6bcf\u500b\u8def\u7531(Route)\u9700\u8981\u7684\u8cc7\u6599\u4e26\u5efa\u7acb\u51fa\u5b8c\u6574\u7684\u975c\u614b HTML\uff0cserver \u6536\u5230\u8acb\u6c42\u6642\u76f4\u63a5\u56de\u50b3\u5df2\u7d93\u5efa\u7acb\u597d\u7684 HTML\uff0c\u5e38\u898b\u7684\u5de5\u5177\u5305\u542b[react-snap](https://github.com/stereobooster/react-snap)\uff0c[Eleventy](https://www.11ty.dev/)\uff0c\u9019\u500b\u65b9\u6cd5\u7684\u512a\u9ede\u5305\u542b\u53ef\u4ee5\u5728 CDN cache HTML \u7e2e\u77ed\u8acb\u6c42\u56de\u50b3\u6642\u9593\u4ee5\u53ca[First Contentful Paint (FCP)](https://web.dev/fcp/)\u6642\u9593\uff0c\u7f3a\u9ede\u5247\u662f\u56e0\u70ba\u662f\u5728 build-time \u7522\u751f HTML\uff0c\u6bcf\u6b21\u6709\u5167\u5bb9\u8b8a\u52d5\u90fd\u8981\u91cd build\uff0c\u5c0d\u65bc\u5167\u5bb9\u8b8a\u52d5\u983b\u7387\u9ad8\u7684\u7db2\u7ad9\u6703\u5f88\u9ebb\u7169\uff0c\u4e5f\u6703\u5ef6\u9577 build \u7684\u6642\u9593\u3002\\n2. Server-Side Rendering (SSR)\uff0c\u76f8\u5c0d\u65bc SSG \u4f86\u8aaa\u5b83\u5247\u662f\u5728 run-time \u5efa\u7acb\u597d HTML\uff0c\u7576 server \u6536\u5230\u67d0\u500b\u8def\u7531\u7684\u8acb\u6c42\u5f8c\u958b\u59cb\u6e96\u5099\u9700\u8981\u7684\u8cc7\u6599\u4e26\u5efa\u7acb\u597d HTML \u56de\u50b3\u7d66 client\uff0c\u89e3\u6c7a\u4e86 SSG \u7684\u554f\u984c\u540c\u6642\u7e7c\u627f\u5176\u512a\u9ede\uff0c\u4f46\u4e5f\u6709\u5b83\u672c\u8eab\u7684\u7684\u554f\u984c\uff0c\u5c31\u662f\u6703\u63d0\u5347\u958b\u767c\u8907\u96dc\u5ea6\uff0c\u4ee5\u53ca\u73fe\u6709\u7684 CSR \u5c08\u6848\u96e3\u4ee5\u8f49\u63db\u6210 SSR \u67b6\u69cb\uff0c\u5e38\u898b\u7684\u5de5\u5177\u6846\u67b6\u5305\u542b React \u7684[Next.js](https://nextjs.org/)\uff0cVue \u7684[Nuxt.js](https://nuxtjs.org/)\u3002\uff08\u4e0d\u904e\u9019\u985e\u6846\u67b6\u9084\u662f\u6709\u5f88\u591a\u5f88\u9999\u7684\u7279\u8272\uff09\\n3. Prerender.io\\n\\n## Prerender.io \u904b\u4f5c\u539f\u7406 - Dynamic Rendering\\n\\n![Screen Shot 2021-11-08 at 11.11.38 AM.png](/img/2021-11-07-solve-seo-problems-with-prerenderio-assets/prerenderio.png)\\n\\n[Prerender.io](https://prerender.io/)\u904b\u4f5c\u6d41\u7a0b\u662f\u7576\u524d\u7aef\u7684 web server \u6536\u5230\u8acb\u6c42\u6642\u900f\u904e Prerender-node Middleware \u53bb\u8fa8\u8b58\u9019\u500b\u8acb\u6c42\u662f\u5f9e\u700f\u89bd\u5668\u9084\u662f\u5f9e\u722c\u87f2\u767c\u51fa\u7684\uff0c\u5982\u679c\u662f\u700f\u89bd\u5668\u5c31\u4f9d\u7167\u539f\u672c\u7684 CSR \u6a5f\u5236\uff0c\u5982\u679c\u662f\u722c\u87f2\u624d\u9700\u8981\u505a prerender\uff0c\u6703\u59d4\u8a17 Prerender.io cloud service \u5e6b\u6211\u5011\u6e32\u67d3\u51fa\u975c\u614b HTML \u518d\u56de\u50b3\u7d66 web server \u7136\u5f8c\u518d\u56de\u7d66\u722c\u87f2\uff0c\u9019\u6a23\u7684\u6e32\u67d3\u65b9\u5f0f\u7a31\u70ba[Dynamic Rendering](https://developers.google.com/search/docs/advanced/javascript/dynamic-rendering)\u3002\\n\\n### \u8fa8\u8b58\u722c\u87f2\u7684\u65b9\u6cd5\\n\\n\u5229\u7528 request header \u4e2d user-agent \u7684\u503c\uff0c\u5982\u679c\u662f google search \u7684\u722c\u87f2\u6703\u5e36\u4e0a `googlebot` \uff0c\u76ee\u524d\u652f\u63f4\u7684\u722c\u87f2\u6709\u9019\u4e9b\uff1a\\n\\n```jsx\\nprerender.crawlerUserAgents = [\\n  \'googlebot\',\\n  \'Yahoo! Slurp\',\\n  \'bingbot\',\\n  \'yandex\',\\n  \'baiduspider\',\\n  \'facebookexternalhit\',\\n  \'twitterbot\',\\n  \'rogerbot\',\\n  \'linkedinbot\',\\n  \'embedly\',\\n  \'quora link preview\',\\n  \'showyoubot\',\\n  \'outbrain\',\\n  \'pinterest/0.\',\\n  \'developers.google.com/+/web/snippet\',\\n  \'slackbot\',\\n  \'vkShare\',\\n  \'W3C_Validator\',\\n  \'redditbot\',\\n  \'Applebot\',\\n  \'WhatsApp\',\\n  \'flipboard\',\\n  \'tumblr\',\\n  \'bitlybot\',\\n  \'SkypeUriPreview\',\\n  \'nuzzel\',\\n  \'Discordbot\',\\n  \'Google Page Speed\',\\n  \'Qwantify\',\\n  \'pinterestbot\',\\n  \'Bitrix link preview\',\\n  \'XING-contenttabreceiver\',\\n  \'Chrome-Lighthouse\',\\n  \'TelegramBot\',\\n];\\n```\\n\\n### \u722c\u87f2\u7372\u53d6\u975c\u614b HTML \u7684\u65b9\u6cd5\\n\\n\u6211\u5011\u7684 web server \u8981\u53bb\u6253 Prerender.io \u63d0\u4f9b\u7684 GET API \u4e26\u5e36\u4e0a\u722c\u87f2\u8acb\u6c42\u7684\u8def\u7531\uff0cPrerender.io \u6703\u958b\u4e00\u500b[Headless Chrome](https://developers.google.com/web/updates/2017/04/headless-chrome)\u53bb\u8ddf\u6211\u5011\u7684 server \u8acb\u6c42\u8a72\u8def\u7531\u7684\u8cc7\u6599\u4f86\u6e32\u67d3 HTML\uff0c\u9019\u6bb5\u5176\u5be6\u7b49\u540c\u4f7f\u7528 Headless Chrome \u5728\u505a CSR\uff0c\u518d\u900f\u904e HTTP \u5206\u584a(chunk)\u50b3\u8f38\u5f9e\u539f\u672c\u7684 API \u56de\u50b3\u6e32\u67d3\u597d\u7684 HTML \u7d66\u6211\u5011\u7684 server\uff0cserver \u6536\u5230\u5f8c\u518d\u628a HTML \u56de\u8986\u7d66\u722c\u87f2\u7684\u8acb\u6c42\uff0c\u56e0\u6b64\u722c\u87f2\u5c31\u53ef\u4ee5\u6536\u5230\u6e32\u67d3\u597d\u7684\u975c\u614b HTML \u800c\u4e14\u4e0d\u5305\u542b JS \u6a94\u6848\u3002\\n\\n```jsx\\nprerender.plainResponse = function (response, callback) {\\n  var content = \'\';\\n\\n  response.on(\'data\', function (chunk) {\\n    content += chunk;\\n  });\\n  response.on(\'end\', function () {\\n    response.body = content;\\n    callback(null, response);\\n  });\\n};\\n```\\n\\n## \u5982\u4f55\u958b\u59cb\u4f7f\u7528\\n\\n### \u5728 Dev \u74b0\u5883\\n\\n\u5148\u5728 local \u8dd1\u4e00\u53f0[Prerender Node Server](https://github.com/prerender/prerender)\uff0c\u5047\u8a2d\u958b\u8d77\u4f86\u7684 URL \u662f `http://localhost:3000`\\n\\n```bash\\ngit clone https://github.com/prerender/prerender.git\\ncd prerender\\nnpm install\\nnode server.js\\n```\\n\\n\u5b98\u65b9\u6709\u63d0\u4f9b\u591a\u7a2e\u8a9e\u8a00\u7684 open source server [middleware](https://docs.prerender.io/article/12-middlewares)\uff0c\u53ef\u4ee5\u628a\u5b83\u5b89\u88dd\u9032\u6211\u5011\u7684\u524d\u7aef web server \u4e2d\uff0c\u5982\u679c\u4f60\u7684 server \u662f Node.js \u7684\u8a71\u53ef\u4ee5\u7528[prerender-node](https://github.com/prerender/prerender-node)\\n\\n```bash\\nnpm install prerender-node --save\\n```\\n\\n\u5f15\u5165 middleware\\n\\n```jsx\\napp.use(require(\'prerender-node\'));\\n```\\n\\nmiddleware \u4e2d\u6703\u8b80\u53d6\u74b0\u5883\u8b8a\u6578 `process.env.PRERENDER_SERVICE_URL` \u6240\u4ee5\u53ef\u4ee5\u628a\u5b83\u8a2d\u70ba `http://localhost:3000` \uff0c\u6216\u662f\u76f4\u63a5\u8a2d\u5b9a middleware \u7684 `prerenderServiceUrl`\\n\\n```jsx\\nconst prerenderServiceUrl = \'http://localhost:3000\';\\napp.use(\\n  require(\'prerender-node\').set(\'prerenderServiceUrl\', prerenderServiceUrl)\\n);\\n```\\n\\n\u57f7\u884c curl \u6216\u662f\u4f7f\u7528 browser extension\uff0c\u4f8b\u5982[ModHeader](https://chrome.google.com/webstore/detail/modheader/idgpnmonknjnojddfkpgkljpfnnfcklj?hl=zh-TW)\uff0c\u5728 header \u4e2d\u52a0\u5165 user-agent: `Googlebot`\uff0c\u53bb\u6253\u4f60\u7684 service \u67d0\u500b\u9801\u9762\u8def\u7531\uff0c\u5047\u8a2d `https://www.example.com/`\\n\\n```bash\\ncurl -A Googlebot https://www.example.com/\\n```\\n\\n\u4f60\u7684 server \u6536\u5230\u8acb\u6c42\u5f8c\uff0cmiddleware \u5982\u679c\u5224\u65b7\u662f\u722c\u87f2\u5c31\u6703\u53bb\u6253 GET `http://localhost:3000/https://www.example.com/` \uff0c\u8acb\u6c42 Prerender Node Server \u6e32\u67d3 HTML\uff0c\u4e4b\u5f8c\u5c31\u53ef\u4ee5\u6536\u5230\u4e00\u500b\u5b8c\u6574\u6e32\u67d3\u597d\u6c92\u6709 script tag \u7684\u975c\u614b HTML\u3002\\n\\n### \u5728 Stage \u74b0\u5883\\n\\n\u5728[Prerender.io](https://prerender.io/)\u5b98\u7db2\u8a3b\u518a\u65b0\u5e33\u865f\u62ff\u5230 token\uff0cmiddleware \u4e2d\u6703\u8b80\u53d6\u74b0\u5883\u8b8a\u6578 `process.env.PRERENDER_TOKEN` \u53ef\u4ee5\u628a\u4ed6\u8a2d\u5b9a\u70ba\u4f60\u7684 token\uff0c\u6216\u662f\u76f4\u63a5\u8a2d\u5b9a\u4ee5\u4e0b\u7684 `prerenderToken`\u3002\\n\\n```jsx\\napp.use(require(\'prerender-node\').set(\'prerenderToken\', \'YOUR_TOKEN\'));\\n```\\n\\n\u901a\u5e38 Stage server \u4e0d\u6703\u5c0d\u5916\u516c\u958b\uff0c\u9700\u8981\u5148\u8a2d\u5b9a\u767d\u540d\u55ae\u5141\u8a31[Prerender.io \u7684 IP](https://docs.prerender.io/article/22-ip-addresses)\uff0c\u8b93\u4ed6\u5011\u7684 cloud service \u53ef\u4ee5\u6253\u9032 Stage server \u8acb\u6c42\u9801\u9762\u8cc7\u6599\uff0c\u518d\u7167\u8457\u4e00\u6a23\u7684\u65b9\u6cd5\u5e36\u8457\u722c\u87f2\u7684 user-agent \u53bb\u6253\u4f60\u7684 service\uff0cmiddleware \u6703\u53bb GET `https://service.prerender.io/https://www.example.com/` \uff0c\u8acb\u6c42 cloud service \u6e32\u67d3 HTML\uff0c\u4e4b\u5f8c\u5c31\u53ef\u4ee5\u770b\u5230 stage \u74b0\u5883\u4e0b\u7684 prerendered HTML\uff0c\u5728\u5b98\u7db2\u7684 Dashboard \u4e0a\u4e5f\u53ef\u4ee5\u770b\u5230\u722c\u87f2\u8acb\u6c42\u7d00\u9304\u4ee5\u53ca\u88ab cache \u7684\u9801\u9762\u3002\\n\\nStage \u8ddf Production \u4e5f\u53ef\u4ee5\u8003\u616e\u4e0d\u7528\u4ed6\u5011\u7684 cloud service\uff0c\u800c\u662f\u5167\u90e8\u7dad\u8b77[Prerender Node Server](https://github.com/prerender/prerender)\uff0c\u5728 middleware \u8a2d\u5b9a\u597d prerenderServiceUrl \u6253\u5230\u81ea\u5df1\u7684 Prerender Node Server\u3002\\n\\n## Prerender.io \u7684\u512a\u7f3a\u9ede\\n\\n\u512a\u9ede\\n\\n- \u5be6\u4f5c\u8d77\u4f86\u6bd4\u5176\u4ed6\u89e3\u6cd5\u66f4\u7c21\u55ae\u5feb\u901f\uff0c\u53ea\u8981\u8a2d\u5b9a server middleware\u3002\\n- \u4efb\u4f55\u73fe\u6709 CSR \u524d\u7aef\u6846\u67b6 React, Vue, Angular \u90fd\u53ef\u4ee5\u76f4\u63a5\u4f7f\u7528\u3002\\n- \u4ecb\u9762\u4e0d\u932f\u7684 Dashboard\u3002\\n- Cloud service \u6709 cache \u6a5f\u5236\uff0c\u53ef\u4ee5\u5728 dashboard \u4e0a\u8a2d\u5b9a cache \u6642\u9593\uff0c\u5982\u679c\u6709\u7279\u5225\u9801\u9762\u9700\u6c42\u4e5f\u6709\u63d0\u4f9b\u5efa\u7acb\u8ddf\u6e05\u9664 cache \u7684 API\u3002\\n\\n\u7f3a\u9ede\\n\\n- [\u984d\u5916\u96f2\u7aef\u670d\u52d9\u6210\u672c](https://prerender.io/pricing/)\u6216\u662f\u81ea\u5df1\u7dad\u904b[Prerender Node Server](https://github.com/prerender/prerender)\u6210\u672c\uff0c\u4e0d\u904e\u9019\u9805\u5c0d\u65bc\u4efb\u4f55 SSR \u65b9\u5f0f\u6216\u591a\u6216\u5c11\u90fd\u6703\u6709\u3002\\n\\n## \u7e3d\u7d50\\n\\n\u9019\u7bc7\u6587\u7ae0\u8b1b\u89e3\u4e86 CSR \u9047\u5230\u7684\u554f\u984c\u8207 SSG\u3001SSR\u3001Prerender.io \u4e09\u7a2e\u89e3\u6c7a\u65b9\u6848\uff0c\u91dd\u5c0d Prerender.io \u4ecb\u7d39\u5b83\u7684\u904b\u4f5c\u539f\u7406 Dynamic Rendering\u3001middleware \u4f7f\u7528\u65b9\u5f0f\u4ee5\u53ca\u512a\u7f3a\u9ede\u6bd4\u8f03\uff0c\u6574\u9ad4\u4f86\u8aaa\u6211\u89ba\u5f97 Prerender.io \u662f\u4ecb\u65bc SSG \u8207 SSR \u4e4b\u9593\u89e3\u6c7a SEO \u554f\u984c\u7684\u6298\u8877\u65b9\u6848\uff0c\u5982\u679c\u662f\u4ee5\u4e0b\u60c5\u5883\uff1a\\n\\n1. \u5177\u6709\u4e00\u5b9a\u898f\u6a21\u7684 CSR SPA \u5c08\u6848\u8f49\u63db SSR \u67b6\u69cb\u6210\u672c\u904e\u9ad8\\n2. \u7db2\u7ad9\u5167\u5bb9\u8b8a\u66f4\u983b\u7387\u9ad8\\n3. \u53ea\u60f3\u512a\u5316 SEO\\n\\n\u9019\u4e9b\u60c5\u6cc1\u4e0b Prerender.io \u6703\u662f\u500b\u5efa\u8b70\u53ef\u4ee5\u8003\u616e\u7684\u89e3\u6cd5\uff0c\u9084\u6709\u5176\u4ed6\u66f4\u591a\u7d30\u7bc0\u4e5f\u53ef\u4ee5\u5230\u4ed6\u5011\u7684\u5b98\u65b9\u6587\u4ef6\u770b\u770b\u3002\\n\\n\u5982\u679c\u6709\u4efb\u4f55\u554f\u984c\u6216\u5efa\u8b70\u6b61\u8fce\u8207\u6211\u806f\u7d61\u8a0e\u8ad6\u3002\\n\\n## Reference\\n\\n[Render Javascript With Search Engines in Mind | Prerender](https://prerender.io/)\\n\\n[Prerender.io Knowledge Base](https://docs.prerender.io/)\\n\\n[https://github.com/prerender/prerender](https://github.com/prerender/prerender)\\n\\n[https://github.com/prerender/prerender-node](https://github.com/prerender/prerender-node)\\n\\n[Dynamic Rendering | Google Search Central | Google Developers](https://developers.google.com/search/docs/advanced/javascript/dynamic-rendering)\\n\\n[Understand JavaScript SEO Basics | Google Search Central](https://developers.google.com/search/docs/advanced/javascript/javascript-seo-basics)\\n\\n[Crawl Budget Optimization | Improve Crawl Health | Prerender](https://prerender.io/crawl-budget-seo/)\\n\\n[Getting Started with Headless Chrome | Web | Google Developers](https://developers.google.com/web/updates/2017/04/headless-chrome)"},{"id":"script-tag-async-defer-attributes","metadata":{"permalink":"/blog/script-tag-async-defer-attributes","source":"@site/blog/2021-11-04-script-tag-async-defer-attributes.md","title":"[\u524d\u7aef\u512a\u5316\u7cfb\u5217] \u4f7f\u7528async, defer\u5c6c\u6027\u52a0\u901f\u7db2\u9801\u8f09\u5165\u6642\u9593","description":"\u700f\u89bd\u5668\u5728\u89e3\u6790 HTML \u6642\u5982\u679c\u9047\u5230`<script>...<\/script>`\u5c31\u6703\u66ab\u505c\u89e3\u6790\u76f4\u63a5\u958b\u59cb\u57f7\u884c\uff0c\u5982\u679c\u662f\u5916\u90e8\u8cc7\u6e90`<script src=\\"...\\"><\/script>`\u6703\u7b49\u5f85\u4e0b\u8f09\u4e26\u57f7\u884c\u5b8c\u6210\u4e4b\u5f8c\u624d\u958b\u59cb\u7e7c\u7e8c\u89e3\u6790 HTML \u5efa\u7acb DOM\uff0c\u9019\u6a23\u7576\u9047\u5230\u5167\u5bb9\u5f88\u591a\u7684 script \u6642\u5c07\u6703\u5ef6\u9577\u9801\u9762\u6e32\u67d3\u7684\u6642\u9593\uff0c\u4e5f\u6703\u8b93\u4f7f\u7528\u8005\u66f4\u6162\u770b\u5230\u7db2\u9801\u5167\u5bb9\u5f71\u97ff\u4f7f\u7528\u9ad4\u9a57\u3002`async`, `defer` \u6b63\u662f\u70ba\u4e86\u89e3\u6c7a\u4e0a\u8ff0\u554f\u984c\u800c\u751f\u7684\u5169\u500b script tag \u5c6c\u6027\uff0c\u9019\u7bc7\u6587\u7ae0\u6703\u4ecb\u7d39\u4ed6\u5011\u7684\u5171\u540c\u9ede\u8207\u76f8\u7570\u9ede\uff0c\u4ee5\u53ca\u5404\u81ea\u9069\u7528\u7684\u60c5\u5883\u3002","date":"2021-11-04T00:00:00.000Z","formattedDate":"November 4, 2021","tags":[{"label":"performance","permalink":"/blog/tags/performance"},{"label":"frontend","permalink":"/blog/tags/frontend"},{"label":"web","permalink":"/blog/tags/web"}],"readingTime":4.06,"truncated":true,"authors":[{"name":"Eric Deng","url":"/","imageURL":"/img/ericdeng.jpg","key":"ericdeng"}],"prevItem":{"title":"Prerender.io\u5982\u4f55\u5e6b\u52a9CSR\u7684SEO - \u539f\u7406\u4ecb\u7d39\u8207\u4f7f\u7528\u6559\u5b78","permalink":"/blog/solve-seo-problems-with-prerenderio"},"nextItem":{"title":"[\u8cc7\u5b89\u7cfb\u5217] \u9632\u79a6CSRF\u653b\u64ca\u7684\u4e94\u7a2e\u65b9\u6cd5","permalink":"/blog/five-ways-to-defend-against-CSRF-attacks"}},"content":"\u700f\u89bd\u5668\u5728\u89e3\u6790 HTML \u6642\u5982\u679c\u9047\u5230`<script>...<\/script>`\u5c31\u6703\u66ab\u505c\u89e3\u6790\u76f4\u63a5\u958b\u59cb\u57f7\u884c\uff0c\u5982\u679c\u662f\u5916\u90e8\u8cc7\u6e90`<script src=\\"...\\"><\/script>`\u6703\u7b49\u5f85\u4e0b\u8f09\u4e26\u57f7\u884c\u5b8c\u6210\u4e4b\u5f8c\u624d\u958b\u59cb\u7e7c\u7e8c\u89e3\u6790 HTML \u5efa\u7acb DOM\uff0c\u9019\u6a23\u7576\u9047\u5230\u5167\u5bb9\u5f88\u591a\u7684 script \u6642\u5c07\u6703\u5ef6\u9577\u9801\u9762\u6e32\u67d3\u7684\u6642\u9593\uff0c\u4e5f\u6703\u8b93\u4f7f\u7528\u8005\u66f4\u6162\u770b\u5230\u7db2\u9801\u5167\u5bb9\u5f71\u97ff\u4f7f\u7528\u9ad4\u9a57\u3002\\n\\n`async`, `defer` \u6b63\u662f\u70ba\u4e86\u89e3\u6c7a\u4e0a\u8ff0\u554f\u984c\u800c\u751f\u7684\u5169\u500b script tag \u5c6c\u6027\uff0c\u9019\u7bc7\u6587\u7ae0\u6703\u4ecb\u7d39\u4ed6\u5011\u7684\u5171\u540c\u9ede\u8207\u76f8\u7570\u9ede\uff0c\u4ee5\u53ca\u5404\u81ea\u9069\u7528\u7684\u60c5\u5883\u3002\\n\\n![script-async-defer.png](/img/2021-11-04-script-tag-async-defer-attributes-assets/script-async-defer.png)\\n\\n\x3c!--truncate--\x3e\\n\\n\u6642\u5e8f\u5716 (\u4f86\u6e90\uff1aSpeed up Google Maps(and everything else) with async & defer)\\n\\n## async, defer \u7684\u5171\u540c\u9ede\\n\\n- \u89e3\u6790 HTML \u6642\u8dd1\u5230\u5c31\u958b\u59cb\u80cc\u666f\u4e0b\u8f09 script\uff0c\u4e0b\u8f09\u6642\u4e0d\u963b\u64cb\u700f\u89bd\u5668\u89e3\u6790 HTML\u3001\u5efa\u7acb DOM\uff0c\u5982\u6b64\u4e00\u4f86\u9801\u9762\u6e32\u67d3\u5b8c\u6210\u4f7f\u7528\u8005\u5c31\u53ef\u4ee5\u5148\u770b\u5230\u7db2\u9801\u5167\u5bb9\u3002\\n- \u53ea\u5c0d\u5f9e\u5916\u90e8\u8f09\u5165\u7684 script \u6709\u6548\uff0c\u4e5f\u5c31\u662f\u6c92\u6709 src \u7684 inline script \u6c92\u6709\u4f5c\u7528\uff0c\u6703\u76f4\u63a5\u958b\u59cb\u57f7\u884c\u3002\\n\\n## defer\\n\\n- DOM \u5efa\u7acb\u5b8c\u6210\u4e4b\u5f8c\u624d\u958b\u59cb\u57f7\u884c script\u3002\\n- \u52a0\u4e86 defer \u7684 script \u4e4b\u9593\u6703\u7167\u8457\u5beb\u5728 HTML \u7684\u9806\u5e8f\u57f7\u884c\uff0c\u5c31\u7b97\u5148\u4e0b\u8f09\u597d\u4e86\u4e5f\u6703\u7b49\u524d\u9762\u7684\u57f7\u884c\u5b8c\u6210\u3002\\n\\n\u9069\u7528\u60c5\u5883\uff1a\\n\\n\u4f9d\u8cf4 DOM \u6216\u5176\u4ed6 script\uff0c\u4f8b\u5982\u6703\u9700\u8981\u4f7f\u7528 HTML element \u6216\u662f\u5176\u4ed6 script \u7684\u8cc7\u6599\uff0c\u7b26\u5408\u5927\u90e8\u5206\u7684\u4f7f\u7528\u60c5\u5883\uff0c\u901a\u5e38\u90fd\u53ef\u4ee5\u52a0\u4e0a\u9019\u500b\u5c6c\u6027\uff0c\u7136\u5f8c\u628a script tag \u653e\u5728`<head>`\u88e1\u8b93\u4ed6\u76e1\u65e9\u958b\u59cb\u80cc\u666f\u4e0b\u8f09\uff0c\u53ea\u9700\u8981\u6ce8\u610f\u5beb\u5728 HTML \u4e0a\u7684\u57f7\u884c\u5148\u5f8c\u9806\u5e8f\u3002\\n\\n## async\\n\\n- \u4e0d\u7ba1 DOM \u597d\u4e86\u6c92\uff0cscript \u4e0b\u8f09\u597d\u5c31\u57f7\u884c\uff0c\u958b\u59cb\u57f7\u884c\u4e4b\u5f8c\u4f9d\u7136\u6703\u66ab\u505c\u89e3\u6790 HTML\u3002\\n- \u52a0\u4e86 async \u7684 script \u4e4b\u9593\u4e0d\u4fdd\u8b49\u57f7\u884c\u9806\u5e8f\uff0c\u4e5f\u4e0d\u6703\u7b49\u5f85\u5176\u4ed6 script\uff0c\u5148\u4e0b\u8f09\u597d\u5148\u57f7\u884c\u3002\\n\\n\u9069\u7528\u60c5\u5883\uff1a\\n\\n\u6c92\u6709\u76f8\u4f9d\u6027\u7684 script\uff0c\u4e0d\u4f9d\u8cf4 DOM \u6216\u5176\u4ed6 script\uff0c\u8ab0\u5148\u57f7\u884c\u90fd\u6c92\u95dc\u4fc2\uff0c\u9069\u7528\u65bc\u7368\u7acb\u7684\u7b2c\u4e09\u65b9 script \u50cf GA, GTM, ads...\\n\\n## Dynamic scripts\\n\\n\u6709\u6642\u5019\u53ef\u80fd\u6703\u5beb js \u52d5\u614b\u5efa\u7acb script tag \u7136\u5f8c\u63d2\u5165 HTML\uff0c\u9019\u6a23\u88ab\u8f09\u5165\u7684 script \u7a31\u70ba Dynamic scripts\uff0c\u50cf\u662f\u9019\u6a23 \ud83d\udc47\\n\\n```jsx\\nlet script = document.createElement(\'script\');\\nscript.src = \'/article/script-async-defer/long.js\';\\ndocument.body.append(script); // (*)\\n```\\n\\n\u4ee5\u9019\u7a2e\u65b9\u5f0f\u63d2\u5165\u7684 script \u9810\u8a2d`async`\u6548\u679c\uff0c\u63d2\u5165 document \u4e4b\u5f8c`(*)`\u5c31\u958b\u59cb\u80cc\u666f\u4e0b\u8f09\u3002\u5982\u679c\u60f3\u8981\u6539\u6210`defer`\u53ea\u8981\u8a2d\u5b9a`script.async=false`\u5c31\u53ef\u4ee5\u4e86\uff0c\u80cc\u666f\u4e0b\u8f09\u5b8c\u6210\u5f8c\u6703\u7167\u8457\u63d2\u5165 document \u7684\u9806\u5e8f\u57f7\u884c script\u3002\\n\\n## \u5f88\u5c11\u6703\u76f4\u63a5\u64b0\u5beb HTML\uff0c\u5be6\u52d9\u4e0a\u6703\u600e\u9ebc\u505a\u5462\uff1f\\n\\n\u73fe\u5728\u901a\u5e38\u6703\u4f7f\u7528 webpack \u4f86\u6253\u5305 js\uff0c\u53ef\u4ee5\u642d\u914d[html-webpack-plugin](https://github.com/jantimon/html-webpack-plugin#writing-your-own-templates)\uff0c\u4ed6\u6703\u751f\u6210 HTML \u4e26\u5f15\u5165\u6253\u5305\u597d\u7684 script\uff0c\u53ef\u4ee5\u5728\u4f7f\u7528\u6642\u8a2d\u5b9a`scriptLoading`\u53c3\u6578\u70ba`defer`\u3002\\n\\n\u5269\u4e0b\u5176\u4ed6\u7b2c\u4e09\u65b9\u7684 script \u6703\u9700\u8981\u76f4\u63a5\u5beb\u5728 HTML \u4e2d\uff0c\u9019\u6642\u5c31\u53ef\u4ee5\u52a0\u4e0a`acync`\u5c6c\u6027\u3002\\n\\n## \u7e3d\u7d50\\n\\n\u9019\u5169\u500b\u5c6c\u6027\u8b93\u8f09\u5165\u9801\u9762\u6642\u53ef\u4ee5\u66f4\u65e9\u958b\u59cb\u4e0b\u8f09 script \u540c\u6642\u89e3\u6790 HTML\uff0c\u7b97\u662f\u4e00\u500b\u5c0f\u5c0f\u8209\u624b\u4e4b\u52de\u5c31\u53ef\u4ee5\u52a0\u901f\u7db2\u9801\u8f09\u5165\u6642\u9593\u7684\u65b9\u6cd5\u5594\u3002\\n\\n\u5982\u679c\u6709\u4efb\u4f55\u554f\u984c\u6216\u5efa\u8b70\u6b61\u8fce\u8207\u6211\u806f\u7d61\u8a0e\u8ad6\u3002\\n\\n## Reference\\n\\n[The Script element - HTML: HyperText Markup Language | MDN](https://developer.mozilla.org/en-US/docs/Web/HTML/Element/script)\\n\\n[Scripts: async, defer](https://javascript.info/script-async-defer)\\n\\n[Efficiently load JavaScript with defer and async](https://flaviocopes.com/javascript-async-defer/)\\n\\n[\u524d\u7aef\u4e09\u5341\uff5c 02. [HTML] script tag \u52a0\u4e0a async & defer \u7684\u529f\u80fd\u53ca\u5dee\u7570\uff1f](https://medium.com/schaoss-blog/02-html-script-tag-%E5%8A%A0%E4%B8%8A-async-defer-%E7%9A%84%E5%8A%9F%E8%83%BD%E5%8F%8A%E5%B7%AE%E7%95%B0-8205fddbbafc)\\n\\n[[JS] Async, defer attributes | PJCHENder \u672a\u6574\u7406\u7b46\u8a18](https://pjchender.dev/javascript/js-async-defer/)"},{"id":"five-ways-to-defend-against-CSRF-attacks","metadata":{"permalink":"/blog/five-ways-to-defend-against-CSRF-attacks","source":"@site/blog/2021-11-02-five-ways-to-defend-against-CSRF-attacks.md","title":"[\u8cc7\u5b89\u7cfb\u5217] \u9632\u79a6CSRF\u653b\u64ca\u7684\u4e94\u7a2e\u65b9\u6cd5","description":"\u7db2\u7ad9\u524d\u7aef\u9632\u79a6CSRF\u653b\u64ca\u7684\u4e94\u7a2e\u65b9\u6cd5","date":"2021-11-02T00:00:00.000Z","formattedDate":"November 2, 2021","tags":[{"label":"CSRF","permalink":"/blog/tags/csrf"},{"label":"cookie","permalink":"/blog/tags/cookie"},{"label":"security","permalink":"/blog/tags/security"}],"readingTime":4.665,"truncated":true,"authors":[{"name":"Eric Deng","url":"/","imageURL":"/img/ericdeng.jpg","key":"ericdeng"}],"prevItem":{"title":"[\u524d\u7aef\u512a\u5316\u7cfb\u5217] \u4f7f\u7528async, defer\u5c6c\u6027\u52a0\u901f\u7db2\u9801\u8f09\u5165\u6642\u9593","permalink":"/blog/script-tag-async-defer-attributes"},"nextItem":{"title":"[Javascript] \u6df1\u5165\u4e86\u89e3\u4e8b\u4ef6\u8ff4\u5708(Event Loop)\uff0cMacrotask\u8ddfMicrotask\u662f\u4ec0\u9ebc\uff1f","permalink":"/blog/javascript-deep-dive-into-event-loop"}},"content":"![charles-deluvio-pjAH2Ax4uWk-unsplash.jpg](/img/2021-11-02-five-ways-to-defend-against-CSRF-attacks-assets/charles-deluvio-pjAH2Ax4uWk-unsplash.jpg)\\n\\n<figcaption align = \\"center\\">Photo by <a href=\\"https://unsplash.com/@charlesdeluvio?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText\\">Charles Deluvio</a> on <a href=\\"https://unsplash.com/s/photos/coding?utm_source=unsplash&utm_medium=referral&utm_content=creditCopyText\\">Unsplash</a></figcaption>\\n\\n## What is CSRF?\\n\\nCross Site Request Forgery \u8de8\u7ad9\u8acb\u6c42\u507d\u9020\uff0c\u4e5f\u88ab\u7a31\u70ba one-click attack \u6216 session riding\uff0c\u901a\u5e38\u7e2e\u5beb\u70ba CSRF \u6216 XSRF\u3002\\n\\n\u5047\u8a2d\u6709\u5169\u500b\u4e0d\u540c\u7db2\u57df(domain)\u7684\u7db2\u7ad9\u53ca\u4e00\u4f4d\u4f7f\u7528\u8005\\n\\n- A \u7db2\u7ad9: \u60e1\u610f\u7db2\u7ad9\uff0c\u4f8b\u5982\u5c0f\u904a\u6232\u7db2\u7ad9\\n- B \u7db2\u7ad9: \u653b\u64ca\u76ee\u6a19\u7db2\u7ad9\\n- \u4f7f\u7528\u8005\uff1a\u88ab\u5192\u5145\u8eab\u4efd\u7684\u51a4\u5927\u982d\uff0c\u6211\u5011\u5c31\u5148\u53eb\u4ed6\u5927\u982d\u5427\\n\\n\u653b\u64ca\u6d41\u7a0b\uff1a\\n\\n1. \u5927\u982d\u5df2\u7d93\u767b\u5165\u904e B \u7db2\u7ad9\u4e26\u4e14\u700f\u89bd\u5668 cookie \u4e2d\u5305\u542b\u8b58\u5225\u8eab\u4efd\u7684 auth token\\n2. \u99ed\u5ba2\u60f3\u8fa6\u6cd5\u8b93\u5927\u982d\u5728 A \u7db2\u7ad9\u4e0a\u5c0d B \u7db2\u7ad9\u767c\u51fa API \u8acb\u6c42 \u2192 \u8de8\u7ad9\u8acb\u6c42\uff0c\u800c\u4e14\u9019\u500b\u8acb\u6c42\u5e36\u8457 B \u7db2\u7ad9\u7684 cookie \u53ca auth token\u2192 \u507d\u9020\u8eab\u4efd\\n3. B \u7db2\u7ad9\u6536\u5230\u8acb\u6c42\uff0c\u78ba\u8a8d auth token \u78ba\u5be6\u662f\u5927\u982d\u5f8c\u7e7c\u7e8c\u57f7\u884c\u99ed\u5ba2\u9810\u671f\u7684\u8acb\u6c42\u5167\u5bb9\\n\\n\u7528\u9019\u500b\u65b9\u5f0f\u5c31\u53ef\u4ee5\u8b93\u4f7f\u7528\u8005\uff08\u5927\u982d\uff09\u5728\u4f7f\u7528 A \u7db2\u7ad9\u6642\u53ef\u80fd\u662f\u9ede\u64ca\u4e00\u500b\u6309\u9215\u751a\u81f3\u662f\u8f09\u5165\u4e00\u5f35\u5716\u7247\u7121\u610f\u9593\u5c31\u4ee5\u81ea\u5df1\u7684\u8eab\u4efd\u5c0d B \u7db2\u7ad9\u57f7\u884c\u60e1\u610f\u653b\u64ca\uff0c\u4f8b\u5982\u5728\u81ea\u5df1\u767b\u5165\u904e\u7684\u9280\u884c\u7db2\u7ad9\u8f49\u5e33\uff0c\u5982\u679c B \u7db2\u7ad9\u4e5f\u6c92\u5bdf\u89ba\u507d\u9020\u7684\u8acb\u6c42\u90a3\u9019\u500b\u653b\u64ca\u5c31\u6210\u529f\u4e86\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## \u5982\u4f55\u89e3\u6c7a CSRF \u653b\u64ca\\n\\n1. \u5f8c\u7aef\u670d\u52d9\u5728 response header `Access-Control-Allow-Origin` \u6307\u5b9a\u5141\u8a31\u7684 domain\uff0c\u700f\u89bd\u5668\u6703\u5148\u767c\u51fa preflight \u8acb\u6c42\u7d66 server \u6aa2\u67e5 client domain \u662f\u5426\u88ab\u5141\u8a31\uff0c\u5982\u679c\u5141\u8a31\u7684\u8a71\u624d\u6703\u518d\u767c\u51fa\u771f\u6b63\u7684\u8acb\u6c42\u3002\\n2. \u700f\u89bd\u5668\u6703\u5728 request header \u52a0\u5165`Referer` \u53ca`Origin` \u5169\u500b\u6b04\u4f4d\u4ee3\u8868\u8acb\u6c42\u7684\u4f86\u6e90 domain\uff0cserver \u53ef\u4ee5\u6aa2\u67e5\u9019\u5169\u500b\u6b04\u4f4d\u7684\u503c\u662f\u4e0d\u662f\u5141\u8a31\u7684 domain\uff0c\u96d6\u7136\u9019\u5169\u500b\u6b04\u4f4d\u662f[Forbidden header name](https://developer.mozilla.org/en-US/docs/Glossary/Forbidden_header_name) \uff0c\u4f46\u4ecd\u6709\u4e9b[\u5c0f\u6280\u5de7](https://www.trustedsec.com/blog/setting-the-referer-header-using-javascript/)\u53ef\u4ee5\u4fee\u6539\uff0c\u800c\u4e14\u6709\u4e9b\u700f\u89bd\u5668\u53ef\u80fd\u6c92\u6709\u9019\u5169\u500b\u6b04\u4f4d\uff0c\u6240\u4ee5\u53ea\u7528\u9019\u500b\u65b9\u6cd5\u4e26\u4e0d\u5b89\u5168\u3002\\n3. set cookie with `SameSite=Strict or Lax`\\n   - Strict: \u9019\u500b cookie \u53ea\u6703\u8ddf\u8457\u76f8\u540c domain \u7684\u8acb\u6c42\u9001\u51fa\uff0c\u4e0d\u6703\u8ddf\u8457 cross site request \u4e00\u8d77\u9001\u51fa\u53bb\\n   - Lax: \u53ea\u5141\u8a31\u7279\u5b9a\u65b9\u5f0f\u7684 cross site request \u53ef\u4ee5\u4e00\u8d77\u5e36\u8457\u9001\u51fa\u53bb\uff0c\u7279\u5b9a\u65b9\u5f0f\u5305\u542b\uff1a`<a>`, `<link rel=\\"prerender\\">`, `<form method=\\"GET\\">`\uff0cChrome set cookie \u9810\u8a2d`SameSite=Lax`\\n4. CSRF token: server \u52a0\u5bc6\u7522\u751f\u4e00\u500b\u552f\u4e00\u4e14\u6709\u6642\u6548\u6027\u7684 token\uff0c\u5728\u524d\u7aef\u8f09\u5165\u9801\u9762\u6642\u6216\u662f\u5728\u547c\u53eb\u9700\u8981\u4fdd\u8b77\u7684 api \u4e4b\u524d\u5148\u8ddf server \u53d6\u5f97\u9019\u500b token\uff0c\u518d\u628a token \u653e\u9032 api request header \u4e2d\u9001\u7d66 server \u6aa2\u67e5\u662f\u5408\u6cd5 token \u624d\u63a5\u53d7\u8acb\u6c42\u3002\\n\\n   CSRF token \u5c31\u50cf\u662f\u4e00\u6b21\u6027\u4f7f\u7528\u7684\u9a57\u8b49\u78bc\u4f86\u8b93\u8acb\u6c42\u591a\u4e00\u5c64\u4fdd\u8b77\uff0c\u6240\u4ee5\u7279\u5225\u9700\u8981\u6ce8\u610f\u53d6\u5f97 CSRF token \u7684 api \u4e0d\u80fd\u63a5\u53d7\u8de8\u7db2\u57df\u7684\u8acb\u6c42\uff0c\u5982\u679c\u8b93\u99ed\u5ba2\u6709\u6a5f\u6703\u53d6\u5f97 CSRF token \u4e00\u6a23\u6709\u98a8\u96aa\u3002\\n\\n   \u9019\u500b\u4e5f\u662f\u6700\u5e38\u898b\u7684\u65b9\u6cd5\uff0c\u5be6\u4f5c\u4e0a\u53ef\u4ee5\u4f7f\u7528\u5957\u4ef6\u9054\u6210\uff0c\u4f8b\u5982 nodejs \u7684[csurf](http://expressjs.com/en/resources/middleware/csurf.html)\u3002\\n\\n5. Double submit cookie: \u524d\u7aef\u96a8\u6a5f\u7522\u751f\u4e00\u500b CSRF token\uff0c\u540c\u6642\u653e\u9032 cookie \u4ee5\u53ca\u6bcf\u500b request header\uff0cserver \u6aa2\u67e5\u5169\u908a\u7684 token \u662f\u76f8\u540c\u7684\u624d\u63a5\u53d7\u8acb\u6c42\uff0c\u56e0\u70ba\u700f\u89bd\u5668\u7684\u8a2d\u8a08\u99ed\u5ba2\u7121\u6cd5\u5c07\u507d\u9020\u7684 token \u653e\u9032\u4f60\u7684 domain \u7684 cookie\uff0c\u6b64\u6642\u8de8 domain \u8acb\u6c42\u6240\u5e36\u7684 cookie \u4e2d\u4e00\u5b9a\u6c92\u6709\u6b63\u78ba\u7684 CSRF token\u3002\\n\\n\u9019\u7bc7\u6587\u7ae0\u63d0\u4f9b\u4e86 5 \u500b\u9632\u79a6 CSRF \u653b\u64ca\u7684\u65b9\u6cd5\uff0c\u5be6\u52d9\u4e0a\u4e5f\u8981\u8003\u616e\u54ea\u4e9b\u65b9\u6cd5\u9069\u7528\u5728\u4f60\u7684\u670d\u52d9\u4e2d\uff0c\u53ef\u4ee5\u55ae\u7368\u4f7f\u7528\u4e5f\u53ef\u4ee5\u7d44\u5408\u4f7f\u7528\u5f97\u5230\u66f4\u597d\u7684\u4fdd\u8b77\u3002\\n\\n\u53e6\u5916\uff0c\u5c0d\u65bc\u4f7f\u7528\u8005\u4f86\u8aaa\u990a\u6210\u767b\u51fa\u7db2\u7ad9\u7684\u597d\u7fd2\u6163\u4e5f\u53ef\u4ee5\u964d\u4f4e\u9047\u5230\u7684\u98a8\u96aa\u5594\uff01\\n\\n\u5982\u679c\u6709\u4efb\u4f55\u554f\u984c\u6216\u5efa\u8b70\u6b61\u8fce\u8207\u6211\u806f\u7d61\u8a0e\u8ad6\u3002\\n\\n## Reference\\n\\n[CSRF \u653b\u64ca\u539f\u7406](https://medium.com/@Tommmmm/csrf-%E6%94%BB%E6%93%8A%E5%8E%9F%E7%90%86-d0f2a51810ca)\\n\\n[SameSite cookies - HTTP | MDN](https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Set-Cookie/SameSite)\\n\\n[\u96f6\u57fa\u790e\u8cc7\u5b89\u7cfb\u5217\uff08\u4e00\uff09-\u8a8d\u8b58 CSRF\uff08Cross Site Request Forgery\uff09](https://tech-blog.cymetrics.io/posts/jo/zerobased-cross-site-request-forgery/)\\n\\n[Setting the \'Referer\' Header Using JavaScript - TrustedSec](https://www.trustedsec.com/blog/setting-the-referer-header-using-javascript/)\\n\\n[Prevent Cross-Site Request Forgery (CSRF) Attacks](https://auth0.com/blog/cross-site-request-forgery-csrf/#CSRF-Defenses-Strategies)"},{"id":"javascript-deep-dive-into-event-loop","metadata":{"permalink":"/blog/javascript-deep-dive-into-event-loop","source":"@site/blog/2021-06-14-javascript-deep-dive-into-event-loop.md","title":"[Javascript] \u6df1\u5165\u4e86\u89e3\u4e8b\u4ef6\u8ff4\u5708(Event Loop)\uff0cMacrotask\u8ddfMicrotask\u662f\u4ec0\u9ebc\uff1f","description":"\u96d6\u7136 Javascript \u662f\u4e00\u500b\u55ae\u4e00\u57f7\u884c\u7dd2(Single Thread)\u7684\u7a0b\u5f0f\u8a9e\u8a00\uff0c\u540c\u4e00\u6642\u9593\u53ea\u80fd\u57f7\u884c\u4e00\u9805\u4efb\u52d9\uff0c\u4f46\u56e0\u70ba\u5e95\u5c64**\u4e8b\u4ef6\u8ff4\u5708(Event Loop)**\u9019\u500b\u6a5f\u5236\u8b93\u4ed6\u6709\u80fd\u529b\u4ee5\u975e\u540c\u6b65\u7684\u65b9\u5f0f\u540c\u6642\u8655\u7406\u591a\u9805\u4efb\u52d9\uff0c\u9019\u7bc7\u6587\u7ae0\u5c07\u6703\u6df1\u5165\u89e3\u91cb\u4e8b\u4ef6\u8ff4\u5708\uff0c\u5e6b\u52a9\u958b\u767c\u8005\u66f4\u6e05\u695a\u81ea\u5df1\u5beb\u51fa\u7684\u7a0b\u5f0f\u78bc\u662f\u5982\u4f55\u5728\u5e95\u5c64\u904b\u4f5c\u3002","date":"2021-06-14T00:00:00.000Z","formattedDate":"June 14, 2021","tags":[{"label":"javascript","permalink":"/blog/tags/javascript"},{"label":"event loop","permalink":"/blog/tags/event-loop"},{"label":"macrotask","permalink":"/blog/tags/macrotask"},{"label":"microtask","permalink":"/blog/tags/microtask"}],"readingTime":8.58,"truncated":true,"authors":[{"name":"Eric Deng","url":"/","imageURL":"/img/ericdeng.jpg","key":"ericdeng"}],"prevItem":{"title":"[\u8cc7\u5b89\u7cfb\u5217] \u9632\u79a6CSRF\u653b\u64ca\u7684\u4e94\u7a2e\u65b9\u6cd5","permalink":"/blog/five-ways-to-defend-against-CSRF-attacks"},"nextItem":{"title":"[Javascript] Mutable vs Immutable Objects","permalink":"/blog/javascript-mutable-vs-immutable-objects"}},"content":"\u96d6\u7136 Javascript \u662f\u4e00\u500b\u55ae\u4e00\u57f7\u884c\u7dd2(Single Thread)\u7684\u7a0b\u5f0f\u8a9e\u8a00\uff0c\u540c\u4e00\u6642\u9593\u53ea\u80fd\u57f7\u884c\u4e00\u9805\u4efb\u52d9\uff0c\u4f46\u56e0\u70ba\u5e95\u5c64**\u4e8b\u4ef6\u8ff4\u5708(Event Loop)**\u9019\u500b\u6a5f\u5236\u8b93\u4ed6\u6709\u80fd\u529b\u4ee5\u975e\u540c\u6b65\u7684\u65b9\u5f0f\u540c\u6642\u8655\u7406\u591a\u9805\u4efb\u52d9\uff0c\u9019\u7bc7\u6587\u7ae0\u5c07\u6703\u6df1\u5165\u89e3\u91cb\u4e8b\u4ef6\u8ff4\u5708\uff0c\u5e6b\u52a9\u958b\u767c\u8005\u66f4\u6e05\u695a\u81ea\u5df1\u5beb\u51fa\u7684\u7a0b\u5f0f\u78bc\u662f\u5982\u4f55\u5728\u5e95\u5c64\u904b\u4f5c\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## Overview\\n\\n\u672c\u7bc7\u6587\u7ae0\u6703\u5305\u542b\u4ee5\u4e0b\u4e3b\u984c\uff0c\u5f9e\u4e86\u89e3 Javascript \u7684\u57f7\u884c\u74b0\u5883\u53ca\u8cc7\u6599\u7d50\u69cb\u5230\u4e8b\u4ef6\u8ff4\u5708\u8a73\u7d30\u7684\u904b\u4f5c\u6d41\u7a0b\uff0c\u4e5f\u7b97\u662f\u6db5\u84cb\u5f9e\u521d\u968e\u5230\u9032\u968e Javascript \u958b\u767c\u8005\u90fd\u5fc5\u9808\u77e5\u9053\u7684\u5167\u5bb9\u3002\\n\\n- Javascript Engine\\n- Memory Heap\\n- Call Stack\\n- Javascript Runtime\\n- \u540c\u6b65\u8207\u975e\u540c\u6b65\\n- \u4e8b\u4ef6\u8ff4\u5708 Event Loop\\n- Macrotask queue vs Microtask queue\\n\\n![js-event-loop.png](/img/2021-06-14-javascript-deep-dive-into-event-loop-assets/js-event-loop.png)\\n[https://suprabhasupi.hashnode.dev/how-javascript-works](https://suprabhasupi.hashnode.dev/how-javascript-works)\\n\\n## Javascript Engine\\n\\n\u96fb\u8166\u4e0a\u771f\u6b63\u57f7\u884c\u904b\u7b97\u5de5\u4f5c\u7684\u662f CPU\uff0c\u4f46 CPU \u53ea\u80fd\u7406\u89e3\u6a5f\u5668\u8a9e\u8a00(Machine code)\uff0c\u7121\u6cd5\u76f4\u63a5\u8b80\u61c2 Javascript \u9019\u7a2e\u9ad8\u968e\u8a9e\u8a00\uff0cJavascript Engine \u7684\u529f\u80fd\u5c31\u662f\u628a Javascript \u7ffb\u8b6f\u6210\u6a5f\u5668\u8a9e\u8a00\uff0c\u5982\u6b64\u4e00\u4f86\u6211\u5011\u5c31\u4e0d\u7528\u76f4\u63a5\u64b0\u5beb\u53ef\u8b80\u6027\u5dee\u7684\u6a5f\u5668\u8a9e\u8a00\u3002\\n\\n![js-engine.jpeg](/img/2021-06-14-javascript-deep-dive-into-event-loop-assets/js-engine.jpeg)\\n[https://suprabhasupi.hashnode.dev/how-javascript-works](https://suprabhasupi.hashnode.dev/how-javascript-works)\\n\\nEngine \u88e1\u5305\u542b\u5f88\u591a\u6a21\u7d44\uff0c\u672c\u7bc7\u6587\u7ae0\u53ea\u6703\u4ecb\u7d39\u5176\u4e2d\u7684 Interpreter, Compiler, Memory Heap \u4ee5\u53ca Call Stack\u3002\\n\\nEngine \u6703\u900f\u904e\u5169\u500b\u6b65\u9a5f\u7ffb\u8b6f Javascript\uff0c\u7b2c\u4e00\u500b\u662f Interpreter \u6703\u5148\u5c07 js \u8f49\u6210 Bytecode\uff0c\u7b2c\u4e8c\u500b\u662f Compiler \u6703\u5c07 Bytecode \u8f49\u6210 Machine Code \u540c\u6642 Profiler \u6703\u4e00\u8d77\u9032\u884c\u512a\u5316\u3002\\n\\n![4PqiR6V.png](/img/2021-06-14-javascript-deep-dive-into-event-loop-assets/4PqiR6V.png)\\n\\n\u6700\u5e38\u807d\u898b\u7684 V8 Engine \u662f\u7531 Google \u958b\u767c\uff0c\u88ab\u4f7f\u7528\u5728 Chrome \u4ee5\u53ca Node.js \u4e0a\uff0c\u4f46\u5176\u5be6\u9084\u6709[\u5176\u4ed6\u5f88\u591a Engine](https://www.wikiwand.com/en/List_of_ECMAScript_engines)\uff0c\u53ea\u8981\u7b26\u5408 ECMAScript \u5236\u5b9a\u7684\u6a19\u6e96\u5927\u5bb6\u90fd\u53ef\u4ee5\u958b\u767c\u81ea\u5df1\u7684 Javascript Engine.\\n\\n## Memory Heap\\n\\n\u4e3b\u8981\u6709\u4ee5\u4e0b\u529f\u80fd:\\n\\n1. \u5206\u914d\u8a18\u61b6\u9ad4\u7a7a\u9593\u7d66\u8b8a\u6578\u4f7f\u7528\uff0c\u5206\u914d\u597d\u4e4b\u5f8c\u6703\u5f97\u5230\u4e00\u500b\u4f4d\u5740\\n2. \u5c07\u8b8a\u6578\u7684\u503c\u5beb\u9032\u914d\u7f6e\u597d\u7684\u8a18\u61b6\u9ad4\u7a7a\u9593\\n3. \u4f7f\u7528\u4f4d\u5740\u5f9e\u8a18\u61b6\u9ad4\u7a7a\u9593\u8b80\u53d6\u8b8a\u6578\u7684\u503c\\n4. \u91cb\u653e\u4e0d\u518d\u4f7f\u7528\u7684\u8a18\u61b6\u9ad4\u7a7a\u9593(Garbage Collection)\\n\\n\u8209\u4f8b\u4f86\u8aaa\uff0cMemory Heap \u5c31\u50cf\u662f\u4e00\u500b\u62bd\u5c5c\u6ac3\uff0c\u6bcf\u500b\u6709\u653e\u6771\u897f\u7684\u62bd\u5c5c\u90fd\u6703\u6709\u4e00\u500b\u7de8\u865f\uff0c\u7a0b\u5f0f\u6703\u7528\u9019\u500b\u7de8\u865f\u53bb\u627e\u6771\u897f\u3002\\n\\n\u62bd\u5c5c\u6ac3 \u2192Memory Heap\\n\\n\u62bd\u5c5c \u2192 \u8a18\u61b6\u9ad4\u7a7a\u9593\\n\\n\u6771\u897f \u2192 \u8b8a\u6578\u7684\u503c\\n\\n\u7de8\u865f \u2192 \u8a18\u61b6\u9ad4\u4f4d\u5740(reference)\\n\\n## Call Stack\\n\\nStack \u662f\u4e00\u500b\u5148\u9032\u5f8c\u51fa(FILO, First In Last Out)\u985e\u4f3c\u7f50\u5b50\u7684\u7d50\u69cb\uff0c\u7576\u7a0b\u5f0f\u547c\u53eb\u51fd\u5f0f(Call function)\u6642\u6703\u628a\u51fd\u5f0f\u653e\u9032 stack \u4e2d\uff0c\u76f4\u5230\u51fd\u5f0f\u57f7\u884c\u7d50\u675f return \u5f8c\u518d\u5c07\u51fd\u5f0f\u5f9e stack \u4e2d\u53d6\u51fa\u3002\\n\\nCall Stack \u7684\u6700\u5e95\u5c64\u4e00\u5b9a\u6703\u6709\u4e00\u500b**[Global Execution Context](https://medium.com/itsems-frontend/javascript-execution-context-and-call-stack-e36e7f77152e)**\uff0c\u63d0\u4f9b\u5176\u4ed6\u51fd\u5f0f\u5b58\u53d6 global object \u4ee5\u53ca`this`\u95dc\u9375\u5b57\u3002\\n\\n\u56e0\u70ba Javascript \u53ea\u6709\u4e00\u500b Call Stack \u7a0b\u5f0f\u4e2d\u6240\u6709\u7684\u4efb\u52d9\u90fd\u6703\u5728\u9019\u500b Stack \u4e2d\u57f7\u884c\uff0c\u6240\u4ee5\u88ab\u7a31\u70ba Single Thread\uff0c\u9019\u500b\u8a2d\u8a08\u8b93\u4ed6\u540c\u4e00\u6642\u9593\u53ea\u6709\u8fa6\u6cd5\u57f7\u884c\u4e00\u4ef6\u4efb\u52d9\uff0c\u7121\u6cd5\u540c\u6642\u57f7\u884c\u591a\u4ef6\u4efb\u52d9\uff0c\u4e5f\u5c31\u662f\u6240\u8b02\u7684 Synchronous\u3002\\n\\nJavascript \u96d6\u7136\u53ea\u6709\u4e00\u500b Engine \u5728\u57f7\u884c\u4efb\u52d9\uff0c\u4f46\u901a\u5e38\u80cc\u5f8c\u9084\u6709 Runtime \u5728\u975e\u540c\u6b65\u7684\u57f7\u884c\u4efb\u52d9\u3002\\n\\n![js-call-stack.png](/img/2021-06-14-javascript-deep-dive-into-event-loop-assets/js-call-stack.png)\\n[https://suprabhasupi.hashnode.dev/how-javascript-works](https://suprabhasupi.hashnode.dev/how-javascript-works)\\n\\n## Javascript Runtime\\n\\nRuntime \u6307\u7684\u662f\u5728\u57f7\u884c\u6642\u671f\u63d0\u4f9b Global Object \u7d66 JS Engine \u8b93\u5b83\u6709\u80fd\u529b\u8207\u57f7\u884c\u74b0\u5883\u4e92\u52d5\u3002\\n\\n\u5728 Browser \u74b0\u5883\u4e2d Runtime \u5c31\u662f Web APIs\uff0cJS Engine \u53ef\u4ee5\u900f\u904e`window` object \u4f86\u4f7f\u7528 Web APIs\uff0c\u900f\u904e Web APIs \u57f7\u884c\u975e\u540c\u6b65\u7684\u4efb\u52d9\uff0c\u4f8b\u5982\u64cd\u4f5c DOM, AJAX, setTimeout \u7b49\u3002\\n\\n\u5728 Node.js \u74b0\u5883\u4e2d Runtime \u5c31\u662f Global APIs\uff0cJS Engine \u53ef\u4ee5\u900f\u904e`global` object \u4f86\u4f7f\u7528\u5404\u7a2e built-in API\uff0c\u4f8b\u5982 Buffer, process, require \u7b49\u3002\\n\\n## \u8a73\u7d30\u89e3\u91cb\u540c\u6b65\u8207\u975e\u540c\u6b65\\n\\n\u540c\u6b65(Synchronous)\u6307\u7684\u662f\u7a0b\u5f0f\u78bc\u7684\u57f7\u884c\u9806\u5e8f\u662f\u7531\u4e0a\u5f80\u4e0b\u4e00\u884c\u4e00\u884c\u7684\u57f7\u884c\uff0c\u540c\u4e00\u6642\u9593\u53ea\u80fd\u505a\u4e00\u4ef6\u4e8b\uff0c\u4e5f\u5c31\u662f\u4e0a\u4e00\u884c\u7684\u7a0b\u5f0f\u5982\u679c\u6c92\u6709\u57f7\u884c\u5b8c\u5c31\u6703\u5361\u4f4f\u4e0b\u4e00\u884c\u7a0b\u5f0f\u7684\u57f7\u884c\u9020\u6210\u963b\u585e(blocking)\uff0c\u5c0e\u81f4\u5f8c\u9762\u7684\u7a0b\u5f0f\u90fd\u7121\u6cd5\u57f7\u884c\uff0c\u5982\u679c\u9047\u5230\u8907\u96dc\u7684\u6578\u5b78\u904b\u7b97\u6216\u662f\u9700\u8981\u5927\u91cf CPU \u904b\u7b97\u7684\u4efb\u52d9\u6642\u5c31\u6703\u56b4\u91cd\u5f71\u97ff\u7a0b\u5f0f\u7684\u904b\u4f5c\u3002\\n\\n\u975e\u540c\u6b65(Asynchronous)\u6307\u7684\u662f\u6703\u5148\u5c07\u5de5\u4f5c\u4e1f\u51fa\u53bb\u7d66\u5176\u4ed6\u57f7\u884c\u74b0\u5883(Runtime)\u8655\u7406\uff0c\u4e0d\u963b\u585e(non-blocking)\u5f8c\u7e8c\u7a0b\u5f0f\u7684\u57f7\u884c\uff0c\u8655\u7406\u5b8c\u6210\u5f8c\u518d\u5c07\u7d50\u679c\u50b3\u7d66\u56de\u8abf\u51fd\u5f0f(callback function)\uff0c\u7136\u5f8c\u7b49\u5f85 Event Loop\uff0c\u4f8b\u5982 AJAX \u6216\u662f\u8b80\u6a94\u5beb\u6a94\u9019\u7a2e\u5b58\u53d6\u5916\u90e8\u8cc7\u6599\u7684 I/O \u90fd\u662f\u5e38\u898b\u7684\u975e\u540c\u6b65\u884c\u70ba\u3002\\n\\n## \u4e8b\u4ef6\u8ff4\u5708 Event Loop \u7684\u904b\u4f5c\u6d41\u7a0b\\n\\n\u4e86\u89e3\u4e86\u4ee5\u4e0a\u6a21\u7d44\u4e4b\u5f8c\uff0cEvent Loop \u4e5f\u6703\u5f88\u597d\u7406\u89e3\uff0c\u5176\u5be6\u5c31\u662f\u9019\u4e9b\u6a21\u7d44\u4e00\u8d77\u4e92\u52d5\u4e4b\u4e0b\u5f62\u6210\u7684\u7121\u9650\u8ff4\u5708\uff0c\u8ff4\u5708\u6d41\u7a0b\u5982\u4e0b\\n\\n1. Javascript engine \u57f7\u884c call stack \u4e2d\u7684\u4efb\u52d9\u3002\\n2. \u7576\u9047\u5230 Web APIs \u6216\u662f\u7121\u6cd5\u8655\u7406\u7684\u4efb\u52d9\u6642\u6703\u4ea4\u7d66 Javascript runtime \u57f7\u884c\uff0cJavascript runtime \u8655\u7406\u5b8c\u6210\u5f8c\u6703\u5c07\u8cc7\u6599\u4ea4\u7d66 callback function\uff0c\u4e26\u5c07 callback function \u653e\u9032 queue \u4e2d\uff0c\u5f62\u6210 Callback Queue\u3002\\n3. Javascript runtime \u7b49\u5f85 call stack \u4e2d\u7684\u4efb\u52d9\u5168\u90e8\u57f7\u884c\u7d50\u675f\u8b8a\u6210\u7a7a\u7684\uff0c\u5f9e callback queue \u4e2d\u62c9\u53d6\u7b2c\u4e00\u500b\u4efb\u52d9\u653e\u9032 call stack\uff0c\u56de\u5230\u7b2c\u4e00\u6b65\u7e7c\u7e8c\u91cd\u8907\u5faa\u74b0\u4e0b\u53bb\u3002\\n\\n\u53ef\u4ee5\u53c3\u8003\u9019\u500b\u5f71\u7247\\n\\n<iframe width=\\"560\\" height=\\"315\\" src=\\"https://www.youtube.com/embed/N0Au8yc5IOw\\" title=\\"YouTube video player\\" frameBorder=\\"0\\" allow=\\"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture\\" allowFullScreen></iframe>\\n\\n## \u7d30\u8ac7 Callback Queue\\n\\n\u4e0a\u9762\u8aaa\u5230\u7684 Callback Queue \u662f\u5b58\u653e callback function \u5730\u65b9\uff0c\u4e5f\u6709\u5f88\u591a\u5225\u540d\u4f8b\u5982 Event Queue, Task Queue\u3002\\n\\n\u901a\u5e38\u5927\u90e8\u5206\u7684\u6587\u7ae0\u90fd\u53ea\u6703\u8aaa\u5230 Callback Queue \u5c31\u7d50\u675f\u4e86\uff0c\u4f46\u5be6\u969b\u4e0a\u4ed6\u53c8\u53ef\u4ee5\u88ab\u7d30\u5206\u70ba Macrotask Queue \u4ee5\u53ca Microtask Queue\uff0c\u5dee\u5225\u5728\u65bc queue \u4e2d\u5b58\u653e\u7684\u4efb\u52d9\u6709\u6240\u4e0d\u540c\u3002\\n\\n## Macrotask Queue\\n\\nmacrotask \u5305\u542b\uff1a\\n\\n- \u5f9e `<script src=\\"...\\">` \u5916\u90e8\u4e0b\u8f09\u7684 script\\n- DOM event handlers\uff0c\u4f8b\u5982 mousemove event \u7684 callback function handler\\n- \u5404\u7a2e Web APIs\uff0c\u4f8b\u5982 setTimeout \u7684 callback function\\n- ajax callback function\\n\\nmacrotask \u5728\u57f7\u884c\u6642\u700f\u89bd\u5668\u4e0d\u6703\u6e32\u67d3(render)DOM\uff0c\u700f\u89bd\u5668\u6703\u88ab\u963b\u585e\u4f4f\uff0c\u4e5f\u5c31\u662f\u53ea\u57f7\u884c macrotask \u4e0d\u6703\u505a\u5176\u4ed6\u4e8b\u60c5\uff0c\u6709\u6642\u6211\u5011\u6703\u770b\u5230\u700f\u89bd\u5668\u8df3\u51fa\u9801\u9762\u6c92\u6709\u56de\u61c9\u7684\u8b66\u544a\uff0c\u53ef\u80fd\u5c31\u662f\u56e0\u70ba macrotask \u6709\u8907\u96dc\u904b\u7b97(CPU-hungry tasks)\u6216\u662f\u7a0b\u5f0f\u908f\u8f2f\u932f\u8aa4\u5c0e\u81f4\u7121\u9650\u8ff4\u5708\u767c\u751f\uff0c\u4f7f\u5f97\u5176\u4ed6\u4efb\u52d9\u7121\u6cd5\u88ab\u8655\u7406\u3002\\n\\n![Screen_Shot_2021-05-16_at_10.37.11_PM.png](/img/2021-06-14-javascript-deep-dive-into-event-loop-assets/Screen_Shot_2021-05-16_at_10.37.11_PM.png)\\n[https://javascript.info/event-loop](https://javascript.info/event-loop)\\n\\n## Microtask Queue\\n\\nmicrotask \u5305\u542b:\\n\\n- promise `.then/catch/finally` \u4e2d\u7684 callback function\\n- `queueMicrotask(func)` \u4e2d\u7684 func\\n\\n\u6bcf\u500b macrotask \u57f7\u884c\u7d50\u675f\u5f8c\u6703\u5148\u5c07 microtask queue \u4e2d\u7684 task \u5168\u90e8\u57f7\u884c\u5b8c\uff0c\u624d\u6703\u7e7c\u7e8c\u57f7\u884c\u700f\u89bd\u5668\u6e32\u67d3\u8ddf\u5176\u4ed6 macrotask\u3002\\n\\n\u5c07 callback queue \u5206\u89e3\u6210 macrotask \u4ee5\u53ca microtask \u4e4b\u5f8c\uff0c\u4ed6\u5011\u5728 Event Loop \u4e2d\u8a73\u7d30\u7684\u904b\u4f5c\u6d41\u7a0b\u6703\u662f\u9019\u6a23\uff1a\\n\\n1. \u5f9e macrotask queue \u4e2d\u62ff\u51fa\u4e00\u500b macrotask \u4e1f\u5230 call stack \u4e2d\u57f7\u884c\u3002\\n2. \u5c07 microtask queue \u4e2d\u5168\u90e8\u7684 task \u4f9d\u7167\u9806\u5e8f Dequeue \u5230 call stack \u4e2d\u57f7\u884c\u3002\\n3. Browser render DOM\u3002\\n4. \u5982\u679c macrotask queue \u662f\u7a7a\u7684\uff0csleep \u76f4\u5230 macrotask \u518d\u6b21\u51fa\u73fe\u3002\\n5. \u56de\u5230\u6b65\u9a5f 1\u3002\\n\\n![/img/2021-06-14-javascript-deep-dive-into-event-loop-assets/Screen_Shot_2021-05-17_at_12.55.38_AM.png](/img/2021-06-14-javascript-deep-dive-into-event-loop-assets/Screen_Shot_2021-05-17_at_12.55.38_AM.png)  \\n[https://javascript.info/event-loop](https://javascript.info/event-loop)\\n\\n## Test\\n\\n```javascript\\nsetTimeout(() => alert(\'timeout\'));\\n\\nPromise.resolve().then(() => alert(\'promise\'));\\n\\nalert(\'code\');\\n```\\n\\n\u53ef\u4ee5\u5148\u60f3\u60f3\u8f38\u51fa\u7d50\u679c\uff0c\u518d\u8cbc\u5230 console \u4e2d\u57f7\u884c\u770b\u7b54\u6848\u662f\u4e0d\u662f\u8ddf\u81ea\u5df1\u60f3\u7684\u4e00\u6a23\uff0c\u5982\u679c\u4e00\u6a23\u7684\u8a71\u4ee3\u8868\u4f60\u5df2\u7d93\u4e86\u89e3\u4e8b\u4ef6\u8ff4\u5708\u56c9\uff01\\n\\n\u5982\u679c\u6709\u4efb\u4f55\u554f\u984c\u6216\u5efa\u8b70\u90fd\u975e\u5e38\u6b61\u8fce\u7559\u8a00\u8a0e\u8ad6\uff0c\u8b1d\u8b1d\uff01\\n\\n## Reference\\n\\n[https://javascript.info/event-loop](https://javascript.info/event-loop)\\n\\n[https://javascript.info/microtask-queue](https://javascript.info/microtask-queue)\\n\\n[https://suprabhasupi.hashnode.dev/how-javascript-works](https://suprabhasupi.hashnode.dev/how-javascript-works)\\n\\n[https://pjchender.blogspot.com/2017/08/javascript-learn-event-loop-stack-queue.html](https://pjchender.blogspot.com/2017/08/javascript-learn-event-loop-stack-queue.html)\\n\\n[https://www.youtube.com/watch?v=8aGhZQkoFbQ&ab_channel=JSConf](https://www.youtube.com/watch?v=8aGhZQkoFbQ&ab_channel=JSConf)\\n\\n[https://developer.mozilla.org/en-US/docs/Web/JavaScript/Memory_Management](https://developer.mozilla.org/en-US/docs/Web/JavaScript/Memory_Management)\\n\\n[https://eyesofkids.gitbooks.io/javascript-start-from-es6/content/part4/eventloop.html](https://eyesofkids.gitbooks.io/javascript-start-from-es6/content/part4/eventloop.html)"},{"id":"javascript-mutable-vs-immutable-objects","metadata":{"permalink":"/blog/javascript-mutable-vs-immutable-objects","source":"@site/blog/2020-11-22-javascript-mutable-vs-immutable-objects.md","title":"[Javascript] Mutable vs Immutable Objects","description":"\u4ecb\u7d39 JavaScript \u7684\u91cd\u8981\u89c0\u5ff5 **Mutable \u53ca Immutable Objects**\uff0c\u4e26\u4ee5\u7bc4\u4f8b\u89e3\u91cb\u4ed6\u5011\u7684\u5dee\u5225\u3002","date":"2020-11-22T00:00:00.000Z","formattedDate":"November 22, 2020","tags":[{"label":"javascript","permalink":"/blog/tags/javascript"},{"label":"mutable","permalink":"/blog/tags/mutable"},{"label":"immutable","permalink":"/blog/tags/immutable"}],"readingTime":3.345,"truncated":true,"authors":[{"name":"Eric Deng","url":"/","imageURL":"/img/ericdeng.jpg","key":"ericdeng"}],"prevItem":{"title":"[Javascript] \u6df1\u5165\u4e86\u89e3\u4e8b\u4ef6\u8ff4\u5708(Event Loop)\uff0cMacrotask\u8ddfMicrotask\u662f\u4ec0\u9ebc\uff1f","permalink":"/blog/javascript-deep-dive-into-event-loop"}},"content":"\u4ecb\u7d39 JavaScript \u7684\u91cd\u8981\u89c0\u5ff5 **Mutable \u53ca Immutable Objects**\uff0c\u4e26\u4ee5\u7bc4\u4f8b\u89e3\u91cb\u4ed6\u5011\u7684\u5dee\u5225\u3002\\n\\n\x3c!--truncate--\x3e\\n\\n## Immutable object\\n\\n- \u6240\u6709\u7684[\u539f\u59cb\u8cc7\u6599\u578b\u614b(primitive)](https://developer.mozilla.org/en-US/docs/Glossary/Primitive)\uff0c\u5305\u542b null, undefined, string, number, boolean, symbol, bigint\uff0c\u90fd\u662f immutable\u3002\\n- immutable object \u662f\u900f\u904e call by value \u7684\u65b9\u5f0f\uff0c\u6703\u6307\u5411\u65b0\u5206\u914d\u7684\u8a18\u61b6\u9ad4\u4f4d\u7f6e\u518d\u5b58\u5165\u503c\uff0c\u56e0\u6b64 object \u5728\u5efa\u7acb\u4e4b\u5f8c\u5c31\u4e0d\u53ef\u518d\u88ab\u6539\u8b8a\u3002\\n- \u7576\u91cd\u65b0\u8ce6\u503c\u6642\uff0c\u6703\u6307\u5411\u65b0\u5206\u914d\u7684\u8a18\u61b6\u9ad4\u4f4d\u7f6e\uff0c\u800c\u975e\u76f4\u63a5\u6539\u8b8a\u8a18\u61b6\u9ad4\u88e1\u7684\u503c\uff0c\u539f\u672c\u7684\u8a18\u61b6\u9ad4\u4f4d\u7f6e\u6703\u88ab garbage collection\uff0c\u63db\u53e5\u8a71\u8aaa\u4ed6\u662f\u88ab\u53d6\u4ee3\u800c\u4e0d\u662f\u76f4\u63a5\u88ab\u4fee\u6539\u3002\\n\\n### example 1\\n\\n```js\\nlet a = 1; // \u5efa\u7acb\u4e00\u500bimmutable object a\\nlet b = a; // \u5275\u5efa\u4e00\u500b\u65b0\u7684\u8a18\u61b6\u9ad4\u4f4d\u7f6e\uff0ccall by value a\u7684\u503c\u5b58\u51651\uff0cb\u6307\u5411\u9019\u500b\u65b0\u7684\u4f4d\u7f6e\\nb = a + 1; // \u5275\u5efa\u4e00\u500b\u65b0\u7684\u8a18\u61b6\u9ad4\u4f4d\u7f6e\uff0ccall by value a\u7684\u503c\u5b58\u51651+1=2\uff0cb\u6307\u5411\u9019\u500b\u65b0\u7684\u4f4d\u7f6e\uff0c\u56e0\u6b64a\u4e0d\u6703\u88ab+1\\nconsole.log(a, b); // 1 2 -> \u56e0\u70ba\u662f\u4e0d\u540c\u7684\u8a18\u61b6\u9ad4\u4f4d\u7f6e\uff0c\u6539\u8b8ab\u4e5f\u4e0d\u6703\u5f71\u97ff\u5230a\\na = 3; // a\u6307\u5411\u65b0\u5206\u914d\u7684\u8a18\u61b6\u9ad4\u4f4d\u7f6e\u88e1\u9762\u5b58\u653e3\uff0c\u539f\u5148\u5b58\u653e1\u7684\u8a18\u61b6\u9ad4\u4f4d\u7f6e\u5247\u6703\u88ab\u5783\u573e\u56de\u6536\\n```\\n\\n### example 2\\n\\n```js\\nfunction swap(a, b) {\\n  let temp = a;\\n  a = b;\\n  b = temp;\\n}\\n\\nlet x = 10;\\nlet y = 20;\\nswap(x, y);\\nconsole.log(x, y); // 10 20 -> a b\u662fcall by value\uff0c\u56e0\u6b64\u4ea4\u63db\u4e26\u4e0d\u6703\u5f71\u97ff\u5230\u50b3\u5165\u7684x y\\n```\\n\\n## Mutable object\\n\\n- \u9664\u4e86 primitive \u4e4b\u5916\u7684 object, array \u90fd\u662f mutable\u3002\\n- mutable object \u662f\u900f\u904e call by sharing \u7684\u65b9\u5f0f\uff0c\u5171\u4eab\u540c\u4e00\u500b\u8a18\u61b6\u9ad4\u4f4d\u7f6e\uff0c\u56e0\u6b64 object \u5efa\u7acb\u4e4b\u5f8c\u53ef\u518d\u88ab\u6539\u8b8a\u3002\\n- \u9700\u8981\u6ce8\u610f\u7684\u662f\uff0c\u7576\u91cd\u65b0\u8ce6\u503c\u6642\uff0c\u4ecd\u6703\u6307\u5411\u65b0\u5206\u914d\u7684\u8a18\u61b6\u9ad4\u4f4d\u7f6e\uff0c\u7d50\u675f\u539f\u672c\u7684\u8a18\u61b6\u9ad4\u5171\u4eab\uff0c\u56e0\u6b64\u539f\u672c\u7684 object \u4e0d\u6703\u88ab\u6539\u8b8a\u3002\\n\\n### example 1\\n\\n```js\\nlet a = { number: 0 }; // \u5efa\u7acb\u4e00\u500bmutable object a\\nlet b = a; // call by sharing\uff0cb\u8207a\u5171\u4eab\u8a18\u61b6\u9ad4\u4f4d\u7f6e\\nb.number++;\\nconsole.log(b); // {number: 1}\\nconsole.log(a); // {number: 1} -> \u6539\u8b8ab\u7684\u540c\u6642a\u4e5f\u88ab\u6539\u8b8a\u4e86\\nb = { age: 27 }; // \u5c0db\u91cd\u65b0\u8ce6\u503c\uff0cb\u6307\u5411\u65b0\u7684\u8a18\u61b6\u9ad4\u4f4d\u7f6e\uff0c\u7d50\u675f\u8207a\u5171\u4eab\u8a18\u61b6\u9ad4\u4f4d\u7f6e\\nconsole.log(a); // {number: 1} -> a\u4e0d\u6703\u88ab\u6539\u8b8a\\n```\\n\\n### example 2\\n\\n```js\\nfunction add(obj) {\\n  obj.number++;\\n}\\n\\nlet o = { number: 10 };\\nadd(o);\\nconsole.log(o.number); // 11 -> o\u8207obj\u5171\u4eab\u8a18\u61b6\u9ad4\u4f4d\u7f6e\uff0c\u56e0\u6b64\u6539\u8b8aobj\u7684\u53c3\u6578\u4e5f\u540c\u6642\u6703\u6539\u8b8ao\u7684\u53c3\u6578\\n\\nfunction add(obj) {\\n  obj = {\\n    number: obj.number + 1,\\n  }; // \u5c0dobj\u91cd\u65b0\u8ce6\u503c\uff0cobj\u6307\u5411\u65b0\u7684\u8a18\u61b6\u9ad4\u4f4d\u7f6e\uff0c\u7d50\u675f\u8207o\u5171\u4eab\u8a18\u61b6\u9ad4\u4f4d\u7f6e\\n}\\n\\nlet o = { number: 10 };\\nadd(o);\\nconsole.log(o.number); // 10 -> o\u7dad\u6301\u4e00\u6a23\u7684\u503c\\n```\\n\\n## Reference\\n\\n[https://developer.mozilla.org/en-US/docs/Glossary/Mutable](https://developer.mozilla.org/en-US/docs/Glossary/Mutable)\\n[https://blog.techbridge.cc/2018/06/23/javascript-call-by-value-or-reference/](https://blog.techbridge.cc/2018/06/23/javascript-call-by-value-or-reference/)"}]}')}}]);