(self.webpackChunkgcdeng_github_io=self.webpackChunkgcdeng_github_io||[]).push([[845],{1820:function(e,t,a){"use strict";a.r(t),a.d(t,{frontMatter:function(){return o},contentTitle:function(){return p},metadata:function(){return s},toc:function(){return c},default:function(){return k}});var n=a(2122),l=a(9756),r=(a(7294),a(3905)),i=["components"],o={slug:"javascript-deep-dive-into-event-loop",title:"[Javascript] \u6df1\u5165\u4e86\u89e3\u4e8b\u4ef6\u8ff4\u5708(Event Loop)\uff0cMacrotask\u8ddfMicrotask\u662f\u4ec0\u9ebc\uff1f",author:"Eric Deng",author_url:"/about",author_image_url:"/img/ericdeng.jpg",tags:["javascript","event loop","macrotask","microtask"],keywords:["javascript","event loop","macrotask","microtask"]},p=void 0,s={permalink:"/javascript-deep-dive-into-event-loop",source:"@site/blog/2021-06-14-javascript-deep-dive-into-event-loop.md",title:"[Javascript] \u6df1\u5165\u4e86\u89e3\u4e8b\u4ef6\u8ff4\u5708(Event Loop)\uff0cMacrotask\u8ddfMicrotask\u662f\u4ec0\u9ebc\uff1f",description:"\u96d6\u7136 Javascript \u662f\u4e00\u500b\u55ae\u4e00\u57f7\u884c\u7dd2(Single Thread)\u7684\u7a0b\u5f0f\u8a9e\u8a00\uff0c\u540c\u4e00\u6642\u9593\u53ea\u80fd\u57f7\u884c\u4e00\u9805\u4efb\u52d9\uff0c\u4f46\u56e0\u70ba\u5e95\u5c64\u4e8b\u4ef6\u8ff4\u5708(Event Loop)\u9019\u500b\u6a5f\u5236\u8b93\u4ed6\u6709\u80fd\u529b\u4ee5\u975e\u540c\u6b65\u7684\u65b9\u5f0f\u540c\u6642\u8655\u7406\u591a\u9805\u4efb\u52d9\uff0c\u9019\u7bc7\u6587\u7ae0\u5c07\u6703\u6df1\u5165\u89e3\u91cb\u4e8b\u4ef6\u8ff4\u5708\uff0c\u5e6b\u52a9\u958b\u767c\u8005\u66f4\u6e05\u695a\u81ea\u5df1\u5beb\u51fa\u7684\u7a0b\u5f0f\u78bc\u662f\u5982\u4f55\u5728\u5e95\u5c64\u904b\u4f5c\u3002",date:"2021-06-14T00:00:00.000Z",formattedDate:"June 14, 2021",tags:[{label:"javascript",permalink:"/tags/javascript"},{label:"event loop",permalink:"/tags/event-loop"},{label:"macrotask",permalink:"/tags/macrotask"},{label:"microtask",permalink:"/tags/microtask"}],readingTime:2.285,truncated:!0,nextItem:{title:"[Javascript] Mutable vs Immutable Objects",permalink:"/javascript-mutable-vs-immutable-objects"}},c=[{value:"Overview",id:"overview",children:[]},{value:"Javascript Engine",id:"javascript-engine",children:[]},{value:"Memory Heap",id:"memory-heap",children:[]},{value:"Call Stack",id:"call-stack",children:[]},{value:"Javascript Runtime",id:"javascript-runtime",children:[]},{value:"\u8a73\u7d30\u89e3\u91cb\u540c\u6b65\u8207\u975e\u540c\u6b65",id:"\u8a73\u7d30\u89e3\u91cb\u540c\u6b65\u8207\u975e\u540c\u6b65",children:[]},{value:"\u4e8b\u4ef6\u8ff4\u5708 Event Loop \u7684\u904b\u4f5c\u6d41\u7a0b",id:"\u4e8b\u4ef6\u8ff4\u5708-event-loop-\u7684\u904b\u4f5c\u6d41\u7a0b",children:[]},{value:"\u7d30\u8ac7 Callback Queue",id:"\u7d30\u8ac7-callback-queue",children:[]},{value:"Macrotask Queue",id:"macrotask-queue",children:[]},{value:"Microtask Queue",id:"microtask-queue",children:[]},{value:"Test",id:"test",children:[]},{value:"Reference",id:"reference",children:[]}],u={toc:c};function k(e){var t=e.components,o=(0,l.Z)(e,i);return(0,r.kt)("wrapper",(0,n.Z)({},u,o,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("p",null,"\u96d6\u7136 Javascript \u662f\u4e00\u500b\u55ae\u4e00\u57f7\u884c\u7dd2(Single Thread)\u7684\u7a0b\u5f0f\u8a9e\u8a00\uff0c\u540c\u4e00\u6642\u9593\u53ea\u80fd\u57f7\u884c\u4e00\u9805\u4efb\u52d9\uff0c\u4f46\u56e0\u70ba\u5e95\u5c64",(0,r.kt)("strong",{parentName:"p"},"\u4e8b\u4ef6\u8ff4\u5708(Event Loop)"),"\u9019\u500b\u6a5f\u5236\u8b93\u4ed6\u6709\u80fd\u529b\u4ee5\u975e\u540c\u6b65\u7684\u65b9\u5f0f\u540c\u6642\u8655\u7406\u591a\u9805\u4efb\u52d9\uff0c\u9019\u7bc7\u6587\u7ae0\u5c07\u6703\u6df1\u5165\u89e3\u91cb\u4e8b\u4ef6\u8ff4\u5708\uff0c\u5e6b\u52a9\u958b\u767c\u8005\u66f4\u6e05\u695a\u81ea\u5df1\u5beb\u51fa\u7684\u7a0b\u5f0f\u78bc\u662f\u5982\u4f55\u5728\u5e95\u5c64\u904b\u4f5c\u3002"),(0,r.kt)("h2",{id:"overview"},"Overview"),(0,r.kt)("p",null,"\u672c\u7bc7\u6587\u7ae0\u6703\u5305\u542b\u4ee5\u4e0b\u4e3b\u984c\uff0c\u5f9e\u4e86\u89e3 Javascript \u7684\u57f7\u884c\u74b0\u5883\u53ca\u8cc7\u6599\u7d50\u69cb\u5230\u4e8b\u4ef6\u8ff4\u5708\u8a73\u7d30\u7684\u904b\u4f5c\u6d41\u7a0b\uff0c\u4e5f\u7b97\u662f\u6db5\u84cb\u5f9e\u521d\u968e\u5230\u9032\u968e Javascript \u958b\u767c\u8005\u90fd\u5fc5\u9808\u77e5\u9053\u7684\u5167\u5bb9\u3002"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Javascript Engine"),(0,r.kt)("li",{parentName:"ul"},"Memory Heap"),(0,r.kt)("li",{parentName:"ul"},"Call Stack"),(0,r.kt)("li",{parentName:"ul"},"Javascript Runtime"),(0,r.kt)("li",{parentName:"ul"},"\u540c\u6b65\u8207\u975e\u540c\u6b65"),(0,r.kt)("li",{parentName:"ul"},"\u4e8b\u4ef6\u8ff4\u5708 Event Loop"),(0,r.kt)("li",{parentName:"ul"},"Macrotask queue vs Microtask queue")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"js-event-loop.png",src:a(6604).Z}),"\n",(0,r.kt)("a",{parentName:"p",href:"https://suprabhasupi.hashnode.dev/how-javascript-works"},"https://suprabhasupi.hashnode.dev/how-javascript-works")),(0,r.kt)("h2",{id:"javascript-engine"},"Javascript Engine"),(0,r.kt)("p",null,"\u96fb\u8166\u4e0a\u771f\u6b63\u57f7\u884c\u904b\u7b97\u5de5\u4f5c\u7684\u662f CPU\uff0c\u4f46 CPU \u53ea\u80fd\u7406\u89e3\u6a5f\u5668\u8a9e\u8a00(Machine code)\uff0c\u7121\u6cd5\u76f4\u63a5\u8b80\u61c2 Javascript \u9019\u7a2e\u9ad8\u968e\u8a9e\u8a00\uff0cJavascript Engine \u7684\u529f\u80fd\u5c31\u662f\u628a Javascript \u7ffb\u8b6f\u6210\u6a5f\u5668\u8a9e\u8a00\uff0c\u5982\u6b64\u4e00\u4f86\u6211\u5011\u5c31\u4e0d\u7528\u76f4\u63a5\u64b0\u5beb\u53ef\u8b80\u6027\u5dee\u7684\u6a5f\u5668\u8a9e\u8a00\u3002"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"js-engine.jpeg",src:a(4800).Z}),"\n",(0,r.kt)("a",{parentName:"p",href:"https://suprabhasupi.hashnode.dev/how-javascript-works"},"https://suprabhasupi.hashnode.dev/how-javascript-works")),(0,r.kt)("p",null,"Engine \u88e1\u5305\u542b\u5f88\u591a\u6a21\u7d44\uff0c\u672c\u7bc7\u6587\u7ae0\u53ea\u6703\u4ecb\u7d39\u5176\u4e2d\u7684 Interpreter, Compiler, Memory Heap \u4ee5\u53ca Call Stack\u3002"),(0,r.kt)("p",null,"Engine \u6703\u900f\u904e\u5169\u500b\u6b65\u9a5f\u7ffb\u8b6f Javascript\uff0c\u7b2c\u4e00\u500b\u662f Interpreter \u6703\u5148\u5c07 js \u8f49\u6210 Bytecode\uff0c\u7b2c\u4e8c\u500b\u662f Compiler \u6703\u5c07 Bytecode \u8f49\u6210 Machine Code \u540c\u6642 Profiler \u6703\u4e00\u8d77\u9032\u884c\u512a\u5316\u3002"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"4PqiR6V.png",src:a(5124).Z})),(0,r.kt)("p",null,"\u6700\u5e38\u807d\u898b\u7684 V8 Engine \u662f\u7531 Google \u958b\u767c\uff0c\u88ab\u4f7f\u7528\u5728 Chrome \u4ee5\u53ca Node.js \u4e0a\uff0c\u4f46\u5176\u5be6\u9084\u6709",(0,r.kt)("a",{parentName:"p",href:"https://www.wikiwand.com/en/List_of_ECMAScript_engines"},"\u5176\u4ed6\u5f88\u591a Engine"),"\uff0c\u53ea\u8981\u7b26\u5408 ECMAScript \u5236\u5b9a\u7684\u6a19\u6e96\u5927\u5bb6\u90fd\u53ef\u4ee5\u958b\u767c\u81ea\u5df1\u7684 Javascript Engine."),(0,r.kt)("h2",{id:"memory-heap"},"Memory Heap"),(0,r.kt)("p",null,"\u4e3b\u8981\u6709\u4ee5\u4e0b\u529f\u80fd:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u5206\u914d\u8a18\u61b6\u9ad4\u7a7a\u9593\u7d66\u8b8a\u6578\u4f7f\u7528\uff0c\u5206\u914d\u597d\u4e4b\u5f8c\u6703\u5f97\u5230\u4e00\u500b\u4f4d\u5740"),(0,r.kt)("li",{parentName:"ol"},"\u5c07\u8b8a\u6578\u7684\u503c\u5beb\u9032\u914d\u7f6e\u597d\u7684\u8a18\u61b6\u9ad4\u7a7a\u9593"),(0,r.kt)("li",{parentName:"ol"},"\u4f7f\u7528\u4f4d\u5740\u5f9e\u8a18\u61b6\u9ad4\u7a7a\u9593\u8b80\u53d6\u8b8a\u6578\u7684\u503c"),(0,r.kt)("li",{parentName:"ol"},"\u91cb\u653e\u4e0d\u518d\u4f7f\u7528\u7684\u8a18\u61b6\u9ad4\u7a7a\u9593(Garbage Collection)")),(0,r.kt)("p",null,"\u8209\u4f8b\u4f86\u8aaa\uff0cMemory Heap \u5c31\u50cf\u662f\u4e00\u500b\u62bd\u5c5c\u6ac3\uff0c\u6bcf\u500b\u6709\u653e\u6771\u897f\u7684\u62bd\u5c5c\u90fd\u6703\u6709\u4e00\u500b\u7de8\u865f\uff0c\u7a0b\u5f0f\u6703\u7528\u9019\u500b\u7de8\u865f\u53bb\u627e\u6771\u897f\u3002"),(0,r.kt)("p",null,"\u62bd\u5c5c\u6ac3 \u2192Memory Heap"),(0,r.kt)("p",null,"\u62bd\u5c5c \u2192 \u8a18\u61b6\u9ad4\u7a7a\u9593"),(0,r.kt)("p",null,"\u6771\u897f \u2192 \u8b8a\u6578\u7684\u503c"),(0,r.kt)("p",null,"\u7de8\u865f \u2192 \u8a18\u61b6\u9ad4\u4f4d\u5740(reference)"),(0,r.kt)("h2",{id:"call-stack"},"Call Stack"),(0,r.kt)("p",null,"Stack \u662f\u4e00\u500b\u5148\u9032\u5f8c\u51fa(FILO, First In Last Out)\u985e\u4f3c\u7f50\u5b50\u7684\u7d50\u69cb\uff0c\u7576\u7a0b\u5f0f\u547c\u53eb\u51fd\u5f0f(Call function)\u6642\u6703\u628a\u51fd\u5f0f\u653e\u9032 stack \u4e2d\uff0c\u76f4\u5230\u51fd\u5f0f\u57f7\u884c\u7d50\u675f return \u5f8c\u518d\u5c07\u51fd\u5f0f\u5f9e stack \u4e2d\u53d6\u51fa\u3002"),(0,r.kt)("p",null,"Call Stack \u7684\u6700\u5e95\u5c64\u4e00\u5b9a\u6703\u6709\u4e00\u500b",(0,r.kt)("strong",{parentName:"p"},(0,r.kt)("a",{parentName:"strong",href:"https://medium.com/itsems-frontend/javascript-execution-context-and-call-stack-e36e7f77152e"},"Global Execution Context")),"\uff0c\u63d0\u4f9b\u5176\u4ed6\u51fd\u5f0f\u5b58\u53d6 global object \u4ee5\u53ca",(0,r.kt)("inlineCode",{parentName:"p"},"this"),"\u95dc\u9375\u5b57\u3002"),(0,r.kt)("p",null,"\u56e0\u70ba Javascript \u53ea\u6709\u4e00\u500b Call Stack \u7a0b\u5f0f\u4e2d\u6240\u6709\u7684\u4efb\u52d9\u90fd\u6703\u5728\u9019\u500b Stack \u4e2d\u57f7\u884c\uff0c\u6240\u4ee5\u88ab\u7a31\u70ba Single Thread\uff0c\u9019\u500b\u8a2d\u8a08\u8b93\u4ed6\u540c\u4e00\u6642\u9593\u53ea\u6709\u8fa6\u6cd5\u57f7\u884c\u4e00\u4ef6\u4efb\u52d9\uff0c\u7121\u6cd5\u540c\u6642\u57f7\u884c\u591a\u4ef6\u4efb\u52d9\uff0c\u4e5f\u5c31\u662f\u6240\u8b02\u7684 Synchronous\u3002"),(0,r.kt)("p",null,"Javascript \u96d6\u7136\u53ea\u6709\u4e00\u500b Engine \u5728\u57f7\u884c\u4efb\u52d9\uff0c\u4f46\u901a\u5e38\u80cc\u5f8c\u9084\u6709 Runtime \u5728\u975e\u540c\u6b65\u7684\u57f7\u884c\u4efb\u52d9\u3002"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"js-call-stack.png",src:a(5671).Z}),"\n",(0,r.kt)("a",{parentName:"p",href:"https://suprabhasupi.hashnode.dev/how-javascript-works"},"https://suprabhasupi.hashnode.dev/how-javascript-works")),(0,r.kt)("h2",{id:"javascript-runtime"},"Javascript Runtime"),(0,r.kt)("p",null,"Runtime \u6307\u7684\u662f\u5728\u57f7\u884c\u6642\u671f\u63d0\u4f9b Global Object \u7d66 JS Engine \u8b93\u5b83\u6709\u80fd\u529b\u8207\u57f7\u884c\u74b0\u5883\u4e92\u52d5\u3002"),(0,r.kt)("p",null,"\u5728 Browser \u74b0\u5883\u4e2d Runtime \u5c31\u662f Web APIs\uff0cJS Engine \u53ef\u4ee5\u900f\u904e",(0,r.kt)("inlineCode",{parentName:"p"},"window")," object \u4f86\u4f7f\u7528 Web APIs\uff0c\u900f\u904e Web APIs \u57f7\u884c\u975e\u540c\u6b65\u7684\u4efb\u52d9\uff0c\u4f8b\u5982\u64cd\u4f5c DOM, AJAX, setTimeout \u7b49\u3002"),(0,r.kt)("p",null,"\u5728 Node.js \u74b0\u5883\u4e2d Runtime \u5c31\u662f Global APIs\uff0cJS Engine \u53ef\u4ee5\u900f\u904e",(0,r.kt)("inlineCode",{parentName:"p"},"global")," object \u4f86\u4f7f\u7528\u5404\u7a2e built-in API\uff0c\u4f8b\u5982 Buffer, process, require \u7b49\u3002"),(0,r.kt)("h2",{id:"\u8a73\u7d30\u89e3\u91cb\u540c\u6b65\u8207\u975e\u540c\u6b65"},"\u8a73\u7d30\u89e3\u91cb\u540c\u6b65\u8207\u975e\u540c\u6b65"),(0,r.kt)("p",null,"\u540c\u6b65(Synchronous)\u6307\u7684\u662f\u7a0b\u5f0f\u78bc\u7684\u57f7\u884c\u9806\u5e8f\u662f\u7531\u4e0a\u5f80\u4e0b\u4e00\u884c\u4e00\u884c\u7684\u57f7\u884c\uff0c\u540c\u4e00\u6642\u9593\u53ea\u80fd\u505a\u4e00\u4ef6\u4e8b\uff0c\u4e5f\u5c31\u662f\u4e0a\u4e00\u884c\u7684\u7a0b\u5f0f\u5982\u679c\u6c92\u6709\u57f7\u884c\u5b8c\u5c31\u6703\u5361\u4f4f\u4e0b\u4e00\u884c\u7a0b\u5f0f\u7684\u57f7\u884c\u9020\u6210\u963b\u585e(blocking)\uff0c\u5c0e\u81f4\u5f8c\u9762\u7684\u7a0b\u5f0f\u90fd\u7121\u6cd5\u57f7\u884c\uff0c\u5982\u679c\u9047\u5230\u8907\u96dc\u7684\u6578\u5b78\u904b\u7b97\u6216\u662f\u9700\u8981\u5927\u91cf CPU \u904b\u7b97\u7684\u4efb\u52d9\u6642\u5c31\u6703\u56b4\u91cd\u5f71\u97ff\u7a0b\u5f0f\u7684\u904b\u4f5c\u3002"),(0,r.kt)("p",null,"\u975e\u540c\u6b65(Asynchronous)\u6307\u7684\u662f\u6703\u5148\u5c07\u5de5\u4f5c\u4e1f\u51fa\u53bb\u7d66\u5176\u4ed6\u57f7\u884c\u74b0\u5883(Runtime)\u8655\u7406\uff0c\u4e0d\u963b\u585e(non-blocking)\u5f8c\u7e8c\u7a0b\u5f0f\u7684\u57f7\u884c\uff0c\u8655\u7406\u5b8c\u6210\u5f8c\u518d\u5c07\u7d50\u679c\u50b3\u7d66\u56de\u8abf\u51fd\u5f0f(callback function)\uff0c\u7136\u5f8c\u7b49\u5f85 Event Loop\uff0c\u4f8b\u5982 AJAX \u6216\u662f\u8b80\u6a94\u5beb\u6a94\u9019\u7a2e\u5b58\u53d6\u5916\u90e8\u8cc7\u6599\u7684 I/O \u90fd\u662f\u5e38\u898b\u7684\u975e\u540c\u6b65\u884c\u70ba\u3002"),(0,r.kt)("h2",{id:"\u4e8b\u4ef6\u8ff4\u5708-event-loop-\u7684\u904b\u4f5c\u6d41\u7a0b"},"\u4e8b\u4ef6\u8ff4\u5708 Event Loop \u7684\u904b\u4f5c\u6d41\u7a0b"),(0,r.kt)("p",null,"\u4e86\u89e3\u4e86\u4ee5\u4e0a\u6a21\u7d44\u4e4b\u5f8c\uff0cEvent Loop \u4e5f\u6703\u5f88\u597d\u7406\u89e3\uff0c\u5176\u5be6\u5c31\u662f\u9019\u4e9b\u6a21\u7d44\u4e00\u8d77\u4e92\u52d5\u4e4b\u4e0b\u5f62\u6210\u7684\u7121\u9650\u8ff4\u5708\uff0c\u8ff4\u5708\u6d41\u7a0b\u5982\u4e0b"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Javascript engine \u57f7\u884c call stack \u4e2d\u7684\u4efb\u52d9\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u7576\u9047\u5230 Web APIs \u6216\u662f\u7121\u6cd5\u8655\u7406\u7684\u4efb\u52d9\u6642\u6703\u4ea4\u7d66 Javascript runtime \u57f7\u884c\uff0cJavascript runtime \u8655\u7406\u5b8c\u6210\u5f8c\u6703\u5c07\u8cc7\u6599\u4ea4\u7d66 callback function\uff0c\u4e26\u5c07 callback function \u653e\u9032 queue \u4e2d\uff0c\u5f62\u6210 Callback Queue\u3002"),(0,r.kt)("li",{parentName:"ol"},"Javascript runtime \u7b49\u5f85 call stack \u4e2d\u7684\u4efb\u52d9\u5168\u90e8\u57f7\u884c\u7d50\u675f\u8b8a\u6210\u7a7a\u7684\uff0c\u5f9e callback queue \u4e2d\u62c9\u53d6\u7b2c\u4e00\u500b\u4efb\u52d9\u653e\u9032 call stack\uff0c\u56de\u5230\u7b2c\u4e00\u6b65\u7e7c\u7e8c\u91cd\u8907\u5faa\u74b0\u4e0b\u53bb\u3002")),(0,r.kt)("p",null,"\u53ef\u4ee5\u53c3\u8003\u9019\u500b\u5f71\u7247"),(0,r.kt)("iframe",{width:"560",height:"315",src:"https://www.youtube.com/embed/N0Au8yc5IOw",title:"YouTube video player",frameBorder:"0",allow:"accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture",allowFullScreen:!0}),(0,r.kt)("h2",{id:"\u7d30\u8ac7-callback-queue"},"\u7d30\u8ac7 Callback Queue"),(0,r.kt)("p",null,"\u4e0a\u9762\u8aaa\u5230\u7684 Callback Queue \u662f\u5b58\u653e callback function \u5730\u65b9\uff0c\u4e5f\u6709\u5f88\u591a\u5225\u540d\u4f8b\u5982 Event Queue, Task Queue\u3002"),(0,r.kt)("p",null,"\u901a\u5e38\u5927\u90e8\u5206\u7684\u6587\u7ae0\u90fd\u53ea\u6703\u8aaa\u5230 Callback Queue \u5c31\u7d50\u675f\u4e86\uff0c\u4f46\u5be6\u969b\u4e0a\u4ed6\u53c8\u53ef\u4ee5\u88ab\u7d30\u5206\u70ba Macrotask Queue \u4ee5\u53ca Microtask Queue\uff0c\u5dee\u5225\u5728\u65bc queue \u4e2d\u5b58\u653e\u7684\u4efb\u52d9\u6709\u6240\u4e0d\u540c\u3002"),(0,r.kt)("h2",{id:"macrotask-queue"},"Macrotask Queue"),(0,r.kt)("p",null,"macrotask \u5305\u542b\uff1a"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"\u5f9e ",(0,r.kt)("inlineCode",{parentName:"li"},'<script src="...">')," \u5916\u90e8\u4e0b\u8f09\u7684 script"),(0,r.kt)("li",{parentName:"ul"},"DOM event handlers\uff0c\u4f8b\u5982 mousemove event \u7684 callback function handler"),(0,r.kt)("li",{parentName:"ul"},"\u5404\u7a2e Web APIs\uff0c\u4f8b\u5982 setTimeout \u7684 callback function"),(0,r.kt)("li",{parentName:"ul"},"ajax callback function")),(0,r.kt)("p",null,"macrotask \u5728\u57f7\u884c\u6642\u700f\u89bd\u5668\u4e0d\u6703\u6e32\u67d3(render)DOM\uff0c\u700f\u89bd\u5668\u6703\u88ab\u963b\u585e\u4f4f\uff0c\u4e5f\u5c31\u662f\u53ea\u57f7\u884c macrotask \u4e0d\u6703\u505a\u5176\u4ed6\u4e8b\u60c5\uff0c\u6709\u6642\u6211\u5011\u6703\u770b\u5230\u700f\u89bd\u5668\u8df3\u51fa\u9801\u9762\u6c92\u6709\u56de\u61c9\u7684\u8b66\u544a\uff0c\u53ef\u80fd\u5c31\u662f\u56e0\u70ba macrotask \u6709\u8907\u96dc\u904b\u7b97(CPU-hungry tasks)\u6216\u662f\u7a0b\u5f0f\u908f\u8f2f\u932f\u8aa4\u5c0e\u81f4\u7121\u9650\u8ff4\u5708\u767c\u751f\uff0c\u4f7f\u5f97\u5176\u4ed6\u4efb\u52d9\u7121\u6cd5\u88ab\u8655\u7406\u3002"),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"Screen_Shot_2021-05-16_at_10.37.11_PM.png",src:a(5329).Z}),"\n",(0,r.kt)("a",{parentName:"p",href:"https://javascript.info/event-loop"},"https://javascript.info/event-loop")),(0,r.kt)("h2",{id:"microtask-queue"},"Microtask Queue"),(0,r.kt)("p",null,"microtask \u5305\u542b:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"promise ",(0,r.kt)("inlineCode",{parentName:"li"},".then/catch/finally")," \u4e2d\u7684 callback function"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"queueMicrotask(func)")," \u4e2d\u7684 func")),(0,r.kt)("p",null,"\u6bcf\u500b macrotask \u57f7\u884c\u7d50\u675f\u5f8c\u6703\u5148\u5c07 microtask queue \u4e2d\u7684 task \u5168\u90e8\u57f7\u884c\u5b8c\uff0c\u624d\u6703\u7e7c\u7e8c\u57f7\u884c\u700f\u89bd\u5668\u6e32\u67d3\u8ddf\u5176\u4ed6 macrotask\u3002"),(0,r.kt)("p",null,"\u5c07 callback queue \u5206\u89e3\u6210 macrotask \u4ee5\u53ca microtask \u4e4b\u5f8c\uff0c\u4ed6\u5011\u5728 Event Loop \u4e2d\u8a73\u7d30\u7684\u904b\u4f5c\u6d41\u7a0b\u6703\u662f\u9019\u6a23\uff1a"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"\u5f9e macrotask queue \u4e2d\u62ff\u51fa\u4e00\u500b macrotask \u4e1f\u5230 call stack \u4e2d\u57f7\u884c\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u5c07 microtask queue \u4e2d\u5168\u90e8\u7684 task \u4f9d\u7167\u9806\u5e8f Dequeue \u5230 call stack \u4e2d\u57f7\u884c\u3002"),(0,r.kt)("li",{parentName:"ol"},"Browser render DOM\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u5982\u679c macrotask queue \u662f\u7a7a\u7684\uff0csleep \u76f4\u5230 macrotask \u518d\u6b21\u51fa\u73fe\u3002"),(0,r.kt)("li",{parentName:"ol"},"\u56de\u5230\u6b65\u9a5f 1\u3002")),(0,r.kt)("p",null,(0,r.kt)("img",{alt:"./2021-06-14-javascript-deep-dive-into-event-loop-assets/Screen_Shot_2021-05-17_at_12.55.38_AM.png",src:a(6008).Z}),(0,r.kt)("br",{parentName:"p"}),"\n",(0,r.kt)("a",{parentName:"p",href:"https://javascript.info/event-loop"},"https://javascript.info/event-loop")),(0,r.kt)("h2",{id:"test"},"Test"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-javascript"},"setTimeout(() => alert('timeout'));\n\nPromise.resolve().then(() => alert('promise'));\n\nalert('code');\n")),(0,r.kt)("p",null,"\u53ef\u4ee5\u5148\u60f3\u60f3\u8f38\u51fa\u7d50\u679c\uff0c\u518d\u8cbc\u5230 console \u4e2d\u57f7\u884c\u770b\u7b54\u6848\u662f\u4e0d\u662f\u8ddf\u81ea\u5df1\u60f3\u7684\u4e00\u6a23\uff0c\u5982\u679c\u4e00\u6a23\u7684\u8a71\u4ee3\u8868\u4f60\u5df2\u7d93\u4e86\u89e3\u4e8b\u4ef6\u8ff4\u5708\u56c9\uff01"),(0,r.kt)("p",null,"\u5982\u679c\u6709\u4efb\u4f55\u554f\u984c\u6216\u5efa\u8b70\u90fd\u975e\u5e38\u6b61\u8fce\u7559\u8a00\u8a0e\u8ad6\uff0c\u8b1d\u8b1d\uff01"),(0,r.kt)("h2",{id:"reference"},"Reference"),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://javascript.info/event-loop"},"https://javascript.info/event-loop")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://javascript.info/microtask-queue"},"https://javascript.info/microtask-queue")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://suprabhasupi.hashnode.dev/how-javascript-works"},"https://suprabhasupi.hashnode.dev/how-javascript-works")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://pjchender.blogspot.com/2017/08/javascript-learn-event-loop-stack-queue.html"},"https://pjchender.blogspot.com/2017/08/javascript-learn-event-loop-stack-queue.html")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://www.youtube.com/watch?v=8aGhZQkoFbQ&ab_channel=JSConf"},"https://www.youtube.com/watch?v=8aGhZQkoFbQ&ab_channel=JSConf")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Memory_Management"},"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Memory_Management")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://eyesofkids.gitbooks.io/javascript-start-from-es6/content/part4/eventloop.html"},"https://eyesofkids.gitbooks.io/javascript-start-from-es6/content/part4/eventloop.html")))}k.isMDXComponent=!0},5124:function(e,t,a){"use strict";t.Z=a.p+"assets/images/4PqiR6V-22acbce192e02bc09d7221c38082c2f8.png"},5329:function(e,t,a){"use strict";t.Z=a.p+"assets/images/Screen_Shot_2021-05-16_at_10.37.11_PM-82dd3d3de0ac10d80cccff54a783ea5e.png"},6008:function(e,t,a){"use strict";t.Z=a.p+"assets/images/Screen_Shot_2021-05-17_at_12.55.38_AM-6ebd3c9e3fe41d1f60883fda4dff857a.png"},5671:function(e,t,a){"use strict";t.Z=a.p+"assets/images/js-call-stack-dc991081d4b66d710932b193427678af.png"},4800:function(e,t,a){"use strict";t.Z=a.p+"assets/images/js-engine-c9d4b21208066e974fa3a538c0dd79c2.jpeg"},6604:function(e,t,a){"use strict";t.Z=a.p+"assets/images/js-event-loop-13affaeb1a6bd14d588f026d98154b29.png"}}]);