<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.3">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="Eric Deng Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="Eric Deng Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=G-YZ68LNP0FW"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-YZ68LNP0FW",{anonymize_ip:!0})</script><title data-react-helmet="true">One post tagged with &quot;ssg&quot; - Eric Deng</title><meta data-react-helmet="true" property="og:title" content="One post tagged with &quot;ssg&quot; - Eric Deng"><meta data-react-helmet="true" property="og:url" content="https://gcdeng.com/tags/ssg"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-react-helmet="true" name="keywords" content="seo,prerender,csr,ssr,ssg,prerender.io,frontend,web"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://gcdeng.com/tags/ssg"><link data-react-helmet="true" rel="alternate" href="https://gcdeng.com/tags/ssg" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://gcdeng.com/tags/ssg" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.f14cd0ec.css">
<link rel="preload" href="/assets/js/runtime~main.a0405f34.js" as="script">
<link rel="preload" href="/assets/js/main.006611e8.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Eric Deng</b></a><a class="navbar__item navbar__link" href="/about">About</a><a class="navbar__item navbar__link" href="/resume">Resume</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/gcdeng" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://www.linkedin.com/in/gcdeng/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">🌜</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">🌞</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/logo.png" alt="My Site Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Eric Deng</b></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/about">About</a></li><li class="menu__list-item"><a class="menu__link" href="/resume">Resume</a></li><li class="menu__list-item"><a href="https://github.com/gcdeng" target="_blank" rel="noopener noreferrer" class="menu__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="menu__list-item"><a href="https://www.linkedin.com/in/gcdeng/" target="_blank" rel="noopener noreferrer" class="menu__link"><span>LinkedIn<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-tags-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/solve-seo-problems-with-prerenderio">CSR SPA的SEO救星 - Prerender.io 原理介紹與使用教學</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/script-tag-async-defer-attributes">[前端優化系列] 使用async, defer屬性加速網頁載入時間</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/five-ways-to-defend-against-CSRF-attacks">[資安系列] 防禦CSRF攻擊的五種方法</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/javascript-deep-dive-into-event-loop">[Javascript] 深入了解事件迴圈(Event Loop)，Macrotask跟Microtask是什麼？</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/javascript-mutable-vs-immutable-objects">[Javascript] Mutable vs Immutable Objects</a></li></ul></nav></aside><main class="col col--7"><header class="margin-bottom--xl"><h1>One post tagged with &quot;ssg&quot;</h1><a href="/tags">View All Tags</a></header><article class="margin-bottom--xl"><header><h2 class="blogPostTitle_GeHD"><a href="/solve-seo-problems-with-prerenderio">CSR SPA的SEO救星 - Prerender.io 原理介紹與使用教學</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2021-11-07T00:00:00.000Z">November 7, 2021</time> · 3 min read</div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="/about"><img src="/img/ericdeng.jpg" alt="Eric Deng"></a><div class="avatar__intro"><div class="avatar__name"><a href="/about">Eric Deng</a></div><small class="avatar__subtitle"></small></div></div></header><div class="markdown"><p>Client-Side Rendering (CSR) Single Page Application (SPA) 最常遇到的問題就是 SEO，解決這個問題的方法有很多種，其中一種獲得 Google 推薦的方法是 Prerender.io，這篇文章將會介紹它的運作原理以及如何開始導入使用。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="開始之前，先聊聊-csr-的-seo-問題"></a>開始之前，先聊聊 CSR 的 SEO 問題<a class="hash-link" href="#開始之前，先聊聊-csr-的-seo-問題" title="Direct link to heading">#</a></h2><p>Client-Side Rendering (CSR) 是過去幾年流行的前端開發方式，瀏覽器會收到一個 body 裡只有根元件以及引入打包好的 JS 的 HTML，解析 HTML 後開始下載及執行 JS 將內容渲染進根元件中，大部分的運算資源會集中在瀏覽器上，而最大的問題是做 SEO 的爬蟲並不會等待 AJAX 跟 JS 渲染好內容才開始蒐集資料，他只會看到 HTML 中一個空空的根元件，沒有資料可以給他做 Index，雖然 Google Search 後來也有<a href="https://developers.google.com/search/docs/advanced/javascript/javascript-seo-basics" target="_blank" rel="noopener noreferrer">新的爬蟲機制</a>解決這個問題，但爬蟲也有<a href="https://prerender.io/crawl-budget-seo/" target="_blank" rel="noopener noreferrer">資源預算</a>(Crawl Budget)限制，CSR 需要花費大量爬蟲運算資源，導致 Index 會需要很多時間甚至有些頁面也無法做 Index，於是開始有人提出很多事先渲染(pre-rendering)好靜態 HTML 再送給 client 的解法，以下列舉幾種：</p><ol><li>Pre-build 或稱 Static Site Generator (SSG)，是在 build-time 準備好每個路由(Route)需要的資料並建立出完整的靜態 HTML，server 收到請求時直接回傳已經建立好的 HTML，常見的工具包含<a href="https://github.com/stereobooster/react-snap" target="_blank" rel="noopener noreferrer">react-snap</a>，<a href="https://www.11ty.dev/" target="_blank" rel="noopener noreferrer">Eleventy</a>，這個方法的優點包含可以在 CDN cache HTML 縮短請求回傳時間以及<a href="https://web.dev/fcp/" target="_blank" rel="noopener noreferrer">First Contentful Paint (FCP)</a>時間，缺點則是因為是在 build-time 產生 HTML，每次有內容變動都要重 build，對於內容變動頻率高的網站會很麻煩，也會延長 build 的時間。</li><li>Server-Side Rendering (SSR)，相對於 SSG 來說它則是在 run-time 建立好 HTML，當 server 收到某個路由的請求後開始準備需要的資料並建立好 HTML 回傳給 client，解決了 SSG 的問題同時繼承其優點，但也有它本身的的問題，就是會提升開發複雜度，以及現有的 CSR 專案難以轉換成 SSR 架構，常見的工具框架包含 React 的<a href="https://nextjs.org/" target="_blank" rel="noopener noreferrer">Next.js</a>，Vue 的<a href="https://nuxtjs.org/" target="_blank" rel="noopener noreferrer">Nuxt.js</a>。（不過這類框架還是有很多很香的特色）</li><li>Prerender.io</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="prerenderio-運作原理---dynamic-rendering"></a>Prerender.io 運作原理 - Dynamic Rendering<a class="hash-link" href="#prerenderio-運作原理---dynamic-rendering" title="Direct link to heading">#</a></h2><p><img alt="prerenderio.svg" src="/assets/images/prerenderio-4326b21667af1dbb3dee8d54ec24d01f.svg"></p><p><a href="https://prerender.io/" target="_blank" rel="noopener noreferrer">Prerender.io</a>運作流程是當前端的 web server 收到請求時去辨識這個請求是從瀏覽器還是從爬蟲發出的，如果是瀏覽器就依照原本的 CSR 機制，如果是爬蟲才需要做 prerender，會委託 Prerender.io cloud service 幫我們渲染出靜態 HTML 再回傳給 web server 然後再回給爬蟲，這樣的渲染方式稱為<a href="https://developers.google.com/search/docs/advanced/javascript/dynamic-rendering" target="_blank" rel="noopener noreferrer">Dynamic Rendering</a>。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="辨識爬蟲的方法"></a>辨識爬蟲的方法<a class="hash-link" href="#辨識爬蟲的方法" title="Direct link to heading">#</a></h3><p>利用 request header 中 user-agent 的值，如果是 google search 的爬蟲會帶上 <code>googlebot</code> ，目前支援的爬蟲有這些：</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">prerender</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">crawlerUserAgents </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;googlebot&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;Yahoo! Slurp&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;bingbot&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;yandex&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;baiduspider&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;facebookexternalhit&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;twitterbot&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;rogerbot&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;linkedinbot&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;embedly&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;quora link preview&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;showyoubot&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;outbrain&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;pinterest/0.&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;developers.google.com/+/web/snippet&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;slackbot&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;vkShare&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;W3C_Validator&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;redditbot&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;Applebot&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;WhatsApp&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;flipboard&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;tumblr&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;bitlybot&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;SkypeUriPreview&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;nuzzel&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;Discordbot&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;Google Page Speed&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;Qwantify&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;pinterestbot&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;Bitrix link preview&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;XING-contenttabreceiver&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;Chrome-Lighthouse&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token string" style="color:#e3116c">&#x27;TelegramBot&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="爬蟲獲取靜態-html-的方法"></a>爬蟲獲取靜態 HTML 的方法<a class="hash-link" href="#爬蟲獲取靜態-html-的方法" title="Direct link to heading">#</a></h3><p>我們的 web server 要去打 Prerender.io 提供的 GET API 並帶上爬蟲請求的路由，Prerender.io 會開一個<a href="https://developers.google.com/web/updates/2017/04/headless-chrome" target="_blank" rel="noopener noreferrer">Headless Chrome</a>去跟我們的 server 請求該路由的資料來渲染 HTML，這段其實等同使用 Headless Chrome 在做 CSR，再透過 HTTP 分塊(chunk)傳輸從原本的 API 回傳渲染好的 HTML 給我們的 server，server 收到後再把 HTML 回覆給爬蟲的請求，因此爬蟲就可以收到渲染好的靜態 HTML 而且不包含 JS 檔案。</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">prerender</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function-variable function" style="color:#d73a49">plainResponse</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">response</span><span class="token parameter punctuation" style="color:#393A34">,</span><span class="token parameter"> callback</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token keyword" style="color:#00009f">var</span><span class="token plain"> content </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;data&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token parameter">chunk</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    content </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> chunk</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">on</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;end&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">function</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    response</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">body </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> content</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token function" style="color:#d73a49">callback</span><span class="token punctuation" style="color:#393A34">(</span><span class="token keyword" style="color:#00009f">null</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> response</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="如何開始使用"></a>如何開始使用<a class="hash-link" href="#如何開始使用" title="Direct link to heading">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="在-dev-環境測試"></a>在 Dev 環境測試<a class="hash-link" href="#在-dev-環境測試" title="Direct link to heading">#</a></h3><p>先在 local 跑一台<a href="https://github.com/prerender/prerender" target="_blank" rel="noopener noreferrer">Prerender Node Server</a>，假設開起來的 URL 是 <code>http://localhost:3000</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">git</span><span class="token plain"> clone https://github.com/prerender/prerender.git</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token builtin class-name">cd</span><span class="token plain"> prerender</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">node server.js</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>官方有提供多種語言的 open source server <a href="https://docs.prerender.io/article/12-middlewares" target="_blank" rel="noopener noreferrer">middleware</a>已經幫我們做好上述的 Dynamic Rendering，可以把它安裝進我們的前端 web server 中，如果你的 server 是 Node.js 的話可以用<a href="https://github.com/prerender/prerender-node" target="_blank" rel="noopener noreferrer">prerender-node</a></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">npm</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> prerender-node --save</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>引入 middleware</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">use</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;prerender-node&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>middleware 中會讀取環境變數 <code>process.env.PRERENDER_SERVICE_URL</code> 所以可以把它設為 <code>http://localhost:3000</code> ，或是直接設定 middleware 的 <code>prerenderServiceUrl</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">const</span><span class="token plain"> prerenderServiceUrl </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;http://localhost:3000&#x27;</span><span class="token punctuation" style="color:#393A34">;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">use</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;prerender-node&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;prerenderServiceUrl&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prerenderServiceUrl</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>執行 curl 或是使用 browser extension，例如<a href="https://chrome.google.com/webstore/detail/modheader/idgpnmonknjnojddfkpgkljpfnnfcklj?hl=zh-TW" target="_blank" rel="noopener noreferrer">ModHeader</a>，在 header 中加入 user-agent: <code>Googlebot</code>，去打你的 service 某個頁面路由，假設 <code>https://www.example.com/</code></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">curl</span><span class="token plain"> -A Googlebot https://www.example.com/</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>你的 server 收到請求後，middleware 如果判斷是爬蟲就會去打 GET <code>http://localhost:3000/https://www.example.com/</code> ，請求 Prerender Node Server 渲染 HTML，之後就可以收到一個完整渲染好沒有 script tag 的靜態 HTML。</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="在-stage-環境測試"></a>在 Stage 環境測試<a class="hash-link" href="#在-stage-環境測試" title="Direct link to heading">#</a></h3><p>在<a href="https://prerender.io/" target="_blank" rel="noopener noreferrer">Prerender.io</a>官網註冊新帳號拿到 token，middleware 中會讀取環境變數 <code>process.env.PRERENDER_TOKEN</code> 可以把他設定為你的 token，或是直接設定以下的 <code>prerenderToken</code>。</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly jsx"><pre tabindex="0" class="prism-code language-jsx codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">app</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">use</span><span class="token punctuation" style="color:#393A34">(</span><span class="token function" style="color:#d73a49">require</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;prerender-node&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token function" style="color:#d73a49">set</span><span class="token punctuation" style="color:#393A34">(</span><span class="token string" style="color:#e3116c">&#x27;prerenderToken&#x27;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;YOUR_TOKEN&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">;</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>通常 Stage server 不會對外公開，需要先設定白名單允許<a href="https://docs.prerender.io/article/22-ip-addresses" target="_blank" rel="noopener noreferrer">Prerender.io 的 IP</a>，讓他們的 cloud service 可以打進 Stage server 請求頁面資料，再照著一樣的方法帶著爬蟲的 user-agent 去打你的 service，middleware 會去 GET <code>https://service.prerender.io/https://www.example.com/</code> ，之後就可以看到 stage 環境下的 prerendered HTML，在官網的 Dashboard 上也可以看到爬蟲請求紀錄以及被 cache 的頁面。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="prerenderio-的優缺點"></a>Prerender.io 的優缺點<a class="hash-link" href="#prerenderio-的優缺點" title="Direct link to heading">#</a></h2><p>優點</p><ul><li>實作起來比其他解法更簡單快速，只要設定 server middleware。</li><li>任何現有 CSR 前端框架 React, Vue, Angular 都可以直接使用。</li><li>介面不錯的 Dashboard。</li><li>Cloud service 有 cache 機制，可以在 dashboard 上設定 cache 時間，如果有特別頁面需求也有提供建立跟清除 cache 的 API。</li></ul><p>缺點</p><ul><li><a href="https://prerender.io/pricing/" target="_blank" rel="noopener noreferrer">額外雲端服務成本</a>或是自己維運 Prerender Node Server 成本，不過這項對於任何 SSR 方式或多或少都會有。</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="總結"></a>總結<a class="hash-link" href="#總結" title="Direct link to heading">#</a></h2><p>這篇文章講解了 CSR 遇到的問題與 SSG、SSR、Prerender.io 三種解決方案，針對 Prerender.io 介紹它的運作原理 Dynamic Rendering、middleware 使用方式以及優缺點比較，整體來說我覺得 Prerender.io 是介於 SSG 與 SSR 之間解決 SEO 問題的折衷方案，如果是以下情境：</p><ol><li>具有一定規模的 CSR SPA 專案轉換 SSR 架構成本過高</li><li>網站內容變更頻率高</li><li>只想優化 SEO</li></ol><p>這些情況下 Prerender.io 會是個建議可以考慮的解法，還有其他更多細節也可以到他們的官方文件看看。</p><p>如果有任何問題或建議歡迎與我聯絡討論。</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="reference"></a>Reference<a class="hash-link" href="#reference" title="Direct link to heading">#</a></h2><p><a href="https://prerender.io/" target="_blank" rel="noopener noreferrer">Render Javascript With Search Engines in Mind | Prerender</a></p><p><a href="https://docs.prerender.io/" target="_blank" rel="noopener noreferrer">Prerender.io Knowledge Base</a></p><p><a href="https://github.com/prerender/prerender" target="_blank" rel="noopener noreferrer">https://github.com/prerender/prerender</a></p><p><a href="https://github.com/prerender/prerender-node" target="_blank" rel="noopener noreferrer">https://github.com/prerender/prerender-node</a></p><p><a href="https://developers.google.com/search/docs/advanced/javascript/dynamic-rendering" target="_blank" rel="noopener noreferrer">Dynamic Rendering | Google Search Central | Google Developers</a></p><p><a href="https://developers.google.com/search/docs/advanced/javascript/javascript-seo-basics" target="_blank" rel="noopener noreferrer">Understand JavaScript SEO Basics | Google Search Central</a></p><p><a href="https://prerender.io/crawl-budget-seo/" target="_blank" rel="noopener noreferrer">Crawl Budget Optimization | Improve Crawl Health | Prerender</a></p><p><a href="https://developers.google.com/web/updates/2017/04/headless-chrome" target="_blank" rel="noopener noreferrer">Getting Started with Headless Chrome | Web | Google Developers</a></p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><a class="margin-horiz--sm" href="/tags/seo">seo</a><a class="margin-horiz--sm" href="/tags/prerender">prerender</a><a class="margin-horiz--sm" href="/tags/csr">csr</a><a class="margin-horiz--sm" href="/tags/ssr">ssr</a><a class="margin-horiz--sm" href="/tags/ssg">ssg</a><a class="margin-horiz--sm" href="/tags/prerender-io">prerender.io</a><a class="margin-horiz--sm" href="/tags/frontend">frontend</a><a class="margin-horiz--sm" href="/tags/web">web</a></div><div class="col text--right"><a aria-label="Read more about CSR SPA的SEO救星 - Prerender.io 原理介紹與使用教學" href="/solve-seo-problems-with-prerenderio"><b>Read More</b></a></div></footer></article></main></div></div></div><footer class="footer"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright © 2021 Eric Deng. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.a0405f34.js"></script>
<script src="/assets/js/main.006611e8.js"></script>
</body>
</html>